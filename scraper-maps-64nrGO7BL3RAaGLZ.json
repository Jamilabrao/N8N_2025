{"createdAt":"2025-01-28T20:23:53.607Z","updatedAt":"2025-01-28T20:24:00.027Z","id":"64nrGO7BL3RAaGLZ","name":"scraper maps","active":false,"nodes":[{"parameters":{},"id":"f4daa492-8943-426d-8d5b-eced33997cce","name":"When clicking \"Execute Workflow\"","type":"n8n-nodes-base.manualTrigger","position":[-900,340],"typeVersion":1},{"parameters":{"mode":"runOnceForEachItem","jsCode":"let nextUrl\n\nif ($json && $json[\"serpapi_pagination\"] && $json[\"serpapi_pagination\"][\"next\"]) {\n    nextUrl = $json[\"serpapi_pagination\"][\"next\"];\n\n$input.item.json.start = nextUrl.split('&').find(param => param.startsWith('start=')).split('=')[1];\n}\n\n\nreturn $input.item;"},"id":"87d42426-3e5e-4adb-b21a-28dd923d52ec","name":"Extract next start value","type":"n8n-nodes-base.code","position":[280,40],"typeVersion":2},{"parameters":{"jsCode":"const allData = []\n\nlet counter = 0;\ndo {\n  try {\n    const items = $items(\"SERPAPI - Scrape Google Maps URL\", 0, counter).map(item => item.json.local_results);\n    allData.push.apply(allData, items);\n  } catch (error) {\n    return [{json: {allData}}];  \n  }\n\n  counter++;\n} while(true);\nreturn $input.all();"},"id":"ceb04a65-449f-4f11-8dd2-438bb8c80171","name":"Merge all values from SERPAPI","type":"n8n-nodes-base.code","position":[780,240],"typeVersion":2},{"parameters":{"jsCode":"console.log($input.all())\n\n\nconst data = $input.all()\n\nconsole.log(\"error\",data)\n\nfunction mergeData(data) {\n    let merged = [];\n    data.forEach(entry => {\n        for (const key in entry.json) {\n            merged.push(entry.json[key]);\n        }\n    });\n    return merged;\n}\n\nconst mergedData = mergeData(data);\nconsole.log(mergedData);\n\n\nreturn mergedData.filter(item => item !== null);"},"id":"e30b7ec3-9d1d-4da3-8601-1b361203422d","name":"Transform data in the right format","type":"n8n-nodes-base.code","position":[1300,240],"typeVersion":2},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"mode":"url","value":"https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit#gid=2023033319"},"sheetName":{"__rl":true,"mode":"list","value":2023033319,"cachedResultUrl":"https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit#gid=2023033319","cachedResultName":"Results"},"columns":{"value":{},"schema":[{"id":"position","type":"string","display":true,"required":false,"displayName":"position","defaultMatch":false,"canBeUsedToMatch":true},{"id":"title","type":"string","display":true,"required":false,"displayName":"title","defaultMatch":false,"canBeUsedToMatch":true},{"id":"phone","type":"string","display":true,"required":false,"displayName":"phone","defaultMatch":false,"canBeUsedToMatch":true},{"id":"website","type":"string","display":true,"required":false,"displayName":"website","defaultMatch":false,"canBeUsedToMatch":true},{"id":"rating","type":"string","display":true,"required":false,"displayName":"rating","defaultMatch":false,"canBeUsedToMatch":true},{"id":"reviews","type":"string","display":true,"required":false,"displayName":"reviews","defaultMatch":false,"canBeUsedToMatch":true},{"id":"place_id","type":"string","display":true,"removed":false,"required":false,"displayName":"place_id","defaultMatch":false,"canBeUsedToMatch":true},{"id":"data_id","type":"string","display":true,"required":false,"displayName":"data_id","defaultMatch":false,"canBeUsedToMatch":true},{"id":"data_cid","type":"string","display":true,"required":false,"displayName":"data_cid","defaultMatch":false,"canBeUsedToMatch":true},{"id":"reviews_link","type":"string","display":true,"required":false,"displayName":"reviews_link","defaultMatch":false,"canBeUsedToMatch":true},{"id":"photos_link","type":"string","display":true,"required":false,"displayName":"photos_link","defaultMatch":false,"canBeUsedToMatch":true},{"id":"gps_coordinates","type":"string","display":true,"required":false,"displayName":"gps_coordinates","defaultMatch":false,"canBeUsedToMatch":true},{"id":"place_id_search","type":"string","display":true,"required":false,"displayName":"place_id_search","defaultMatch":false,"canBeUsedToMatch":true},{"id":"provider_id","type":"string","display":true,"required":false,"displayName":"provider_id","defaultMatch":false,"canBeUsedToMatch":true},{"id":"price","type":"string","display":true,"required":false,"displayName":"price","defaultMatch":false,"canBeUsedToMatch":true},{"id":"type","type":"string","display":true,"required":false,"displayName":"type","defaultMatch":false,"canBeUsedToMatch":true},{"id":"types","type":"string","display":true,"required":false,"displayName":"types","defaultMatch":false,"canBeUsedToMatch":true},{"id":"address","type":"string","display":true,"required":false,"displayName":"address","defaultMatch":false,"canBeUsedToMatch":true},{"id":"open_state","type":"string","display":true,"required":false,"displayName":"open_state","defaultMatch":false,"canBeUsedToMatch":true},{"id":"hours","type":"string","display":true,"required":false,"displayName":"hours","defaultMatch":false,"canBeUsedToMatch":true},{"id":"operating_hours","type":"string","display":true,"required":false,"displayName":"operating_hours","defaultMatch":false,"canBeUsedToMatch":true},{"id":"description","type":"string","display":true,"required":false,"displayName":"description","defaultMatch":false,"canBeUsedToMatch":true},{"id":"service_options","type":"string","display":true,"required":false,"displayName":"service_options","defaultMatch":false,"canBeUsedToMatch":true},{"id":"order_online","type":"string","display":true,"required":false,"displayName":"order_online","defaultMatch":false,"canBeUsedToMatch":true},{"id":"thumbnail","type":"string","display":true,"required":false,"displayName":"thumbnail","defaultMatch":false,"canBeUsedToMatch":true},{"id":"editorial_reviews","type":"string","display":true,"required":false,"displayName":"editorial_reviews","defaultMatch":false,"canBeUsedToMatch":true},{"id":"unclaimed_listing","type":"string","display":true,"required":false,"displayName":"unclaimed_listing","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"autoMapInputData","matchingColumns":["place_id"]},"options":{"cellFormat":"RAW"}},"id":"34ac3b5a-a60f-4e53-a0b2-76cac32ee10f","name":"Add rows in Google Sheets","type":"n8n-nodes-base.googleSheets","position":[1680,240],"typeVersion":4.2},{"parameters":{"url":"https://serpapi.com/search.json","authentication":"predefinedCredentialType","nodeCredentialType":"serpApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"engine","value":"google_maps"},{"name":"q","value":"={{$json?.search_parameters?.q || $json.keyword }} "},{"name":"ll","value":"={{ $json?.search_parameters?.ll|| $json.geo }}"},{"name":"type","value":"search"},{"name":"start","value":"={{ $json.start|| 0 }}"}]},"options":{}},"id":"897b81f0-7d8d-441f-8a84-799cadcfc2b0","name":"SERPAPI - Scrape Google Maps URL","type":"n8n-nodes-base.httpRequest","position":[0,60],"typeVersion":4.1,"onError":"continueErrorOutput"},{"parameters":{"operation":"removeDuplicates","compare":"selectedFields","fieldsToCompare":"place_id","options":{}},"id":"61249bb7-8a5a-41a0-a5fd-d0ef6c0b9c98","name":"Remove duplicate items","type":"n8n-nodes-base.itemLists","position":[1500,240],"typeVersion":3.1},{"parameters":{"fieldToSplitOut":"allData","options":{}},"id":"2497bd52-2df3-467a-9c3b-4cc77c8f5c01","name":"Split out items","type":"n8n-nodes-base.itemLists","position":[960,240],"typeVersion":3.1},{"parameters":{"conditions":{"string":[{"value1":"={{ $json[0] }}","operation":"isNotEmpty"}]}},"id":"14105656-105a-43fe-b3de-65564011fbbc","name":"Remove empty values","type":"n8n-nodes-base.filter","position":[1120,240],"typeVersion":1},{"parameters":{"documentId":{"__rl":true,"mode":"url","value":"https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit#gid=0"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit#gid=0","cachedResultName":"Add your search here"},"filtersUI":{"values":[{"lookupColumn":"Status"}]},"options":{}},"id":"cc955147-9724-4783-8f0b-a47d8e4063eb","name":"Google Sheets - Get searches  to scrap","type":"n8n-nodes-base.googleSheets","position":[-460,60],"typeVersion":4.2},{"parameters":{"fields":{"values":[{"name":"keyword","stringValue":"={{ $json.URL.match(/\\/search\\/(.*?)\\//)[1] }}"},{"name":"geo","stringValue":"={{ $json.URL.match(/(@[^\\/?]+)/)[1]}}"}]},"options":{}},"id":"c57ee2f5-80f3-459c-bb06-fe4a450ffdba","name":"Extract keyword and location from URL","type":"n8n-nodes-base.set","position":[-240,60],"typeVersion":3.2},{"parameters":{"content":"## Adjust frequency to your own needs","height":266.8807730722022,"width":312.2965981499806},"id":"ccdeab70-27fd-4153-ab0a-865b7948be3a","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-1000,-240],"typeVersion":1},{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"id":"d53a5109-7144-460b-a1e3-e1fe9a5cd768","name":"Run workflow every hours","type":"n8n-nodes-base.scheduleTrigger","position":[-880,-140],"typeVersion":1.1},{"parameters":{"content":"## Copy my template and connect it to n8n\n\nTemplate link: \n https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit?usp=sharing","height":511.2196121145973},"id":"bd44654c-06cb-4bf2-8b31-37eb04824d3e","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[-540,-240],"typeVersion":1},{"parameters":{"content":"## Add your SERPAPI API Key\n\nStart a free trial at serpapi.com and get your API key in \"Your account\" section","height":535.9388810024284},"id":"9a11c441-5af4-41c5-ac6a-f19023bb922f","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[-60,-280],"typeVersion":1},{"parameters":{"operation":"update","documentId":{"__rl":true,"mode":"url","value":"https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit#gid=0"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit#gid=0","cachedResultName":"Add your search url here"},"columns":{"value":{"URL":"={{ $('Google Sheets - Get searches  to scrap').first().json.URL }}","Status":"✅"},"schema":[{"id":"URL","type":"string","display":true,"removed":false,"required":false,"displayName":"URL","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Status","type":"string","display":true,"required":false,"displayName":"Status","defaultMatch":false,"canBeUsedToMatch":true},{"id":"row_number","type":"string","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"row_number","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["URL"]},"options":{}},"id":"4746eade-c25e-4454-8b90-cbc092f9e18d","name":"Update Status to Success","type":"n8n-nodes-base.googleSheets","position":[1860,240],"executeOnce":true,"typeVersion":4.2},{"parameters":{"operation":"update","documentId":{"__rl":true,"mode":"url","value":"https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit#gid=0"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/170osqaLBql9M-4RAH3_lBKR7ZMaQqyLUkAD-88xGuEQ/edit#gid=0","cachedResultName":"Add your search url here"},"columns":{"value":{"URL":"={{ $('Google Sheets - Get searches  to scrap').first().json.URL }}","Status":"❌"},"schema":[{"id":"URL","type":"string","display":true,"removed":false,"required":false,"displayName":"URL","defaultMatch":false,"canBeUsedToMatch":true},{"id":"Status","type":"string","display":true,"required":false,"displayName":"Status","defaultMatch":false,"canBeUsedToMatch":true},{"id":"row_number","type":"string","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"row_number","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["URL"]},"options":{}},"id":"30f099e0-5bff-45ec-a7e3-d6635bf1dec5","name":"Update Status to Error","type":"n8n-nodes-base.googleSheets","position":[280,180],"executeOnce":true,"typeVersion":4.2},{"parameters":{"content":"## Click on Execute Workflow to run the workflow manually","height":310.4703136043695,"width":312.2965981499806},"id":"e4b91253-cbec-46dd-a700-4e1a8406e4e9","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-1000,200],"typeVersion":1},{"parameters":{"conditions":{"number":[{"value1":"={{ $json.search_parameters.start }}","operation":"isNotEmpty"}],"string":[{"value1":"={{ $json.serpapi_pagination.next }}","operation":"isNotEmpty"}]}},"id":"f99e8a4f-60dd-407a-8c5b-17b3f1827ee3","name":"Continue IF Loop is complete","type":"n8n-nodes-base.if","position":[540,180],"typeVersion":1},{"parameters":{"content":"## Read Me\n\nThis workflow allows to scrape Google Maps data in an efficient way using SerpAPI. \n\nYou'll get all data from Gmaps at a cheaper cost than Google Maps API.\n\nAdd as input, your Google Maps search URL and you'll get a list of places with many data points such as:\n- phone number\n- website\n- rating\n- reviews\n- address\n\nAnd much more.\n\n\n**Full guide to implement the workflow is here**: \n\nhttps://lempire.notion.site/Scrape-Google-Maps-places-with-n8n-b7f1785c3d474e858b7ee61ad4c21136?pvs=4","height":532.3420004517685,"width":357.33341618921213},"id":"37f27abd-141c-4452-9a5e-4ee6082b4eaa","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[-1420,-240],"typeVersion":1}],"connections":{"Split out items":{"main":[[{"node":"Remove empty values","type":"main","index":0}]]},"Remove empty values":{"main":[[{"node":"Transform data in the right format","type":"main","index":0}]]},"Remove duplicate items":{"main":[[{"node":"Add rows in Google Sheets","type":"main","index":0}]]},"Extract next start value":{"main":[[{"node":"Continue IF Loop is complete","type":"main","index":0}]]},"Run workflow every hours":{"main":[[{"node":"Google Sheets - Get searches  to scrap","type":"main","index":0}]]},"Add rows in Google Sheets":{"main":[[{"node":"Update Status to Success","type":"main","index":0}]]},"Continue IF Loop is complete":{"main":[[{"node":"SERPAPI - Scrape Google Maps URL","type":"main","index":0}],[{"node":"Merge all values from SERPAPI","type":"main","index":0}]]},"Merge all values from SERPAPI":{"main":[[{"node":"Split out items","type":"main","index":0}]]},"SERPAPI - Scrape Google Maps URL":{"main":[[{"node":"Extract next start value","type":"main","index":0}],[{"node":"Update Status to Error","type":"main","index":0}]]},"When clicking \"Execute Workflow\"":{"main":[[{"node":"Google Sheets - Get searches  to scrap","type":"main","index":0}]]},"Transform data in the right format":{"main":[[{"node":"Remove duplicate items","type":"main","index":0}]]},"Extract keyword and location from URL":{"main":[[{"node":"SERPAPI - Scrape Google Maps URL","type":"main","index":0}]]},"Google Sheets - Get searches  to scrap":{"main":[[{"node":"Extract keyword and location from URL","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"7d7b2ad3-c6f2-4319-a7d7-fa10b4dc23bb","triggerCount":0,"tags":[]}
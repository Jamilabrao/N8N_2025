{"updatedAt":"2025-11-29T05:14:47.592Z","createdAt":"2025-11-28T16:20:04.997Z","id":"NZ55aGL0lAZSuNnw","name":"RESUMOCAST - JAMIL","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"b457632e-4ad3-4578-b42f-b17fbed5c026aaaaaaaaaaaaa","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[192,208],"id":"e1a0bec3-ae00-44fb-8bb1-8146a057bfc4","name":"Webhook","webhookId":"b457632e-4ad3-4578-b42f-b17fbed5c026"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"},"id":"4712475c-a813-4c27-9a0b-d2b7e463893d"}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5d8f3020-c7bc-4a70-a513-58ec5d816e53","leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"legenda","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Legenda"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"285e6ea9-c0ff-48ea-8d8c-36a0a5317ce4","leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"182ae83e-76c4-4306-9a65-bb5d6ae6c010","leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"stickerMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Sticker"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"991c0009-5cb5-46ca-8275-0be6bc50f09b","leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"imagem"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1632,160],"id":"5262fa24-ccec-466a-bc36-1064f54b7a9a","name":"Message Type"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"60e9095a-9300-4478-80f2-9716d72f5192","leftValue":"={{ $json.data.remoteJid }}","rightValue":"120363147410191858@g.us","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[1408,208],"id":"cb49b035-a585-40fa-be2b-3262e50e0e7f","name":"Group Filter"},{"parameters":{"rule":{"interval":[{"triggerAtHour":19,"triggerAtMinute":10}]}},"id":"9e397582-3821-45fd-9a9b-5fc65ab1c432","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[1200,864]},{"parameters":{"content":"# ü§ñResumidorTexto","height":500,"width":3760,"color":5},"type":"n8n-nodes-base.stickyNote","position":[1152,752],"typeVersion":1,"id":"dad06951-f77b-4844-8168-ef25f4b891b8","name":"Sticky Note2"},{"parameters":{"promptType":"define","text":"={{ $json.formattedMessage }}","options":{"systemMessage":"=Voc√™ √© um assistente respons√°vel por gerar um **Resumo do Dia** das √∫ltimas 24 horas de mensagens trocadas no grupo **\"F.IA ADV - Alunos Curso\"**, com linguagem amig√°vel, motivadora e inspiradora. Siga o formato abaixo, preenchendo cada parte entre colchetes com os dados reais:\n\n‚úçÔ∏èüî• *Resumo do Dia - F.IA ADV - Alunos Curso* üî•\n_Data: {{ $now.format('DD/MM') }} ‚Ä¢ Hor√°rio: {{ $now.format('HH:mm') }}_\n\n#üìå *O que rolou hoje?*\n* *[T√≠tulo do T√≥pico 01]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 02]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 03]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 04]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 05]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 06]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 07]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 08]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 09]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n* *[T√≠tulo do T√≥pico 10]* ‚Äì [Breve descri√ß√£o objetiva do que ocorreu]\n\n#üèÖ *Destaques do Grupo*\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n* [Nome ou Telefone] / [N√∫mero de mensagens] ‚Äì [Contribui√ß√£o mais relevante]\n\n#üèÜ *Membro Destaque do Dia* eleja **o participante que mais se engajou** no per√≠odo (quem enviou o maior n√∫mero de mensagens e participou ativamente das discuss√µes).\n* [Nome ou Telefone] / [N√∫mero de mensagens]\n\n**A seguir**, escreva uma mensagem motivacional direcionada a esse membro destaque.\n\n#ü§ù *Networking & Colabora√ß√£o*\n* [Nome] trouxe‚Ä¶\n* [Nome] ajudou com‚Ä¶\n\n#üîé *Links Importantes*\n* [Descri√ß√£o do link] ‚Äì [URL]\n* Se n√£o houver links, escreva: ‚ÄúNenhum link compartilhado.‚Äù\n\n#üôå *Agradecimentos*\n* Agradecemos a [Nomes] pelas intera√ß√µes produtivas!\n\n#üì£ *Lembretes & An√∫ncios*\n* [Breve lembrete ou an√∫ncio]\n\n---\n*Fechamento Interativo:*\nIncentive a continuidade da conversa com perguntas abertas, por exemplo:\n`[Nome], o que achou do t√≥pico X?`\n`Pessoal, quem quer compartilhar mais insights sobre Y?`\n\n---\n**Regras finais:**\n- Use **asteriscos** para negrito e _underscores_ para it√°lico (sem Markdown complexo).\n- Insira apenas temas discutidos no grupo, com enfase em cumpricidade, uni√£o, desenvolvimento pessoal, autoconhecimento e crescimento pessoal.\n- M√°ximo de 2.500 caracteres no total.\n- Empregue emojis para tornar o texto mais leve e convidativo.\n\n**‚ùå Aten√ß√£o:** As instru√ß√µes acima s√£o **metadados** para voc√™, **n√£o** devem aparecer no resumo final."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[2480,832],"id":"d379d272-097c-4755-b6d6-5dbc465f4700","name":"AI Agent"},{"parameters":{"model":"gpt-4o","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[2400,1088],"id":"3d977919-9165-4451-9682-f7faa8bea536","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"jsCode":"// Inicializa um array para armazenar as mensagens formatadas\nlet history = [];\n\n// Itera sobre todos os itens de entrada\nfor (const item of $input.all()) {\n    // Verifica se os campos necess√°rios existem e atribui valores padr√£o caso estejam ausentes\n    let hora = item.json.data| \"Hora n√£o informada\"; // Hora padr√£o caso n√£o seja encontrada\n    let nome = item.json.user_id || item.json.phone || \"Usu√°rio n√£o identificado\"; // Usa telefone caso o nome esteja ausente\n    let mensagem = item.json.message_type || \"Mensagem vazia\"; // Mensagem padr√£o caso n√£o seja encontrada\n\n    // Formata a mensagem no formato desejado\n    let formattedMessage = `${hora} - ${nome}: ${mensagem}`;\n\n    // Adiciona a mensagem formatada ao array de hist√≥rico\n    history.push(formattedMessage);\n}\n\n// Ordena o array de hist√≥rico em ordem cronol√≥gica\nhistory.sort((a, b) => {\n    // Extrai as horas das mensagens\n    let timeA = a.split(' - ')[0];\n    let timeB = b.split(' - ')[0];\n\n    // Verifica se as horas s√£o v√°lidas\n    if (timeA === \"Hora n√£o informada\" || timeB === \"Hora n√£o informada\") {\n        return 0; // Mant√©m a ordem caso as horas sejam inv√°lidas\n    }\n\n    // Converte as horas para objetos Date para compara√ß√£o\n    let dateA = new Date(`1970-01-01T${timeA}:00`);\n    let dateB = new Date(`1970-01-01T${timeB}:00`);\n\n    return dateA - dateB;\n});\n\n// Retorna o hist√≥rico formatado como uma √∫nica string com quebra de linha entre as mensagens\nlet result = history.join('\\n');\n\n// Retorna um array contendo um √∫nico objeto com a string de resultado\nreturn [{ formattedMessage: result }];"},"id":"eee115d0-d23c-4958-bd26-1bc6906b9bee","name":"Format Message","type":"n8n-nodes-base.code","typeVersion":2,"position":[2240,832]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4c8c18a0-38fe-46d6-b452-cb141a80bfff","leftValue":"={{ $('Supabase1').item.json.data }}","rightValue":"={{ $today }}","operator":{"type":"dateTime","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[2032,832],"id":"efbb57d5-2db3-4265-9448-5a951f2b71d5","name":"Today Filter "},{"parameters":{"content":"# Insere Mensagens no Banco de dados","height":900,"width":3760,"color":4},"type":"n8n-nodes-base.stickyNote","position":[1152,-160],"typeVersion":1,"id":"f45e85d1-0180-4c79-a357-768f8d4f12ec","name":"Sticky Note3"},{"parameters":{"tableId":"chat_messages_pauloadv","fieldsUi":{"fieldValues":[{"fieldId":"name","fieldValue":"={{ $json.data.pushName }}"},{"fieldId":"whatsapp","fieldValue":"={{ $json.data.participant }}"},{"fieldId":"mensagem","fieldValue":"={{ $json.data.text }}"},{"fieldId":"data","fieldValue":"={{ $json.data.date }}"},{"fieldId":"hora","fieldValue":"={{ $json.data.hour }}"},{"fieldId":"name","fieldValue":"={{ $('Data Handler').item.json.data.pushName }}"},{"fieldId":"whatsapp","fieldValue":"={{ $('Data Handler').item.json.data.participant }}"},{"fieldId":"data","fieldValue":"={{ $('Data Handler').item.json.data.date }}"},{"fieldId":"hora","fieldValue":"={{ $('Data Handler').item.json.data.hour }}"},{"fieldId":"transcricao_audio","fieldValue":"={{ $json.body.transcricao_audio }} "},{"fieldId":"sticker","fieldValue":"={{ $json.body.sticker }}"},{"fieldId":"transcricao_img","fieldValue":"={{ $json.body.descricao_imagem }}"},{"fieldId":"legenda_imagem","fieldValue":"={{ $('Data Handler').item.json.data.legenda }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3520,-144],"id":"62c01f69-8bc1-4e97-975b-599c303583c9","name":"Supabase","credentials":{"supabaseApi":{"id":"337Z7ndUMMaF8CZx","name":"Supabase ZAP FINANCEIRO"}}},{"parameters":{"operation":"getAll","tableId":"chat_messages_pauloadv","returnAll":true,"filterType":"none"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1504,864],"id":"dbaedf12-7a14-4edd-9353-5c662e052392","name":"Supabase1","credentials":{"supabaseApi":{"id":"337Z7ndUMMaF8CZx","name":"Supabase ZAP FINANCEIRO"}}},{"parameters":{"assignments":{"assignments":[{"id":"cee73d0a-677e-437e-b4c7-da21a95656df","name":"created_at","value":"={{ $json.created_at }}","type":"string"},{"id":"e20a4fd8-ef6e-4fbe-a0b5-c937d0e8cf3e","name":"user_id","value":"={{ $json.name }}","type":"string"},{"id":"672b692b-348b-4646-a484-1ade71c550dd","name":"phone","value":"={{ $json.whatsapp }}","type":"string"},{"id":"4586a4e1-c507-4042-97d5-d00efa676aed","name":"message_type","value":"={{ $json.mensagem }}","type":"string"},{"id":"2c4a3f1f-eabe-454b-9a3d-dd7842378dac","name":"data","value":"={{ $json.data }}","type":"string"},{"id":"c8ed58e6-0c03-402a-9cde-b244333aa8b9","name":"hora","value":"={{ $json.hora }}","type":"string"},{"id":"df2fce9f-bd0f-478a-9cc1-c515d6bc55ea","name":"id","value":"={{ $json.id }}","type":"number"},{"id":"57f3bfba-986d-4522-8427-76b74b3237b2","name":"message_transcricao","value":"={{ $json.transcricao_audio }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1744,864],"id":"7c7257da-d320-4706-8b9e-220e6a723d22","name":"Edit Fields"},{"parameters":{"method":"POST","url":"https://app.funciona.ai/message/sendText/5583996300681222","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"A49A6ECB1BD5-45FA-99BF-EE50C6ED9BD0ABCDEA"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"5569996300681232"},{"name":"text","value":"={{ $json.output }}"}]},"options":{"redirect":{"redirect":{}}}},"id":"36a7613b-57da-4f1f-ae89-976b1a381799","name":"HTTP Request1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2832,832]},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1712,2624],"id":"0653186f-b923-42ff-810f-6d13c2a029d4","name":"No Operation, do nothing3"},{"parameters":{"method":"POST","url":"={{ $('Webhook').item.json.body.server_url }}/message/sendText/{{ $('Webhook').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Webhook').item.json.body.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Webhook').item.json.body.data.key.remoteJid }}"},{"name":"text","value":"=> ü§ñ *_Transcri√ß√£o do √°udio_* üëá\n\n{{ $json.text }}\n\n> Transcrito com *IA* por _https://speech.dichat.com.br/go_\n\n(_Se eu n√£o puder ouvir agora, em breve leio e respondo_)"},{"name":"linkPreview","value":"={{ false }}"}]},"options":{}},"id":"56ec1386-baeb-434d-9727-7c0324157c2b","name":"Enviar transcri√ß√£o4","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3232,2688]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4f7d7983-e5a9-4486-925a-a0d60957d388","leftValue":"={{ $json.text.length }}","rightValue":300,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"id":"94db98d9-9d3c-43f4-91ae-c48812a63945","name":"If4","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2864,2448]},{"parameters":{"method":"POST","url":"={{ $('Webhook').item.json.body.server_url }}/message/sendText/{{ $('Webhook').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Webhook').item.json.body.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Webhook').item.json.body.data.key.remoteJid }}"},{"name":"text","value":"=> üß† *_Resumo Inteligente do √°udio_*:\n\n{{ $json.text }}\n\n> ü§ñ *√Åudio Completo* üëá\n\n{{ $('OpenAI').item.json.text }}\n\n> Transcrito com *IA* por _https://speech.dichat.com.br/go_\n\n(_Se eu n√£o puder ouvir agora, em breve leio e respondo_)"},{"name":"linkPreview","value":"={{ false }}"}]},"options":{}},"id":"59449b55-3f28-4b18-803b-48e74420a055","name":"Enviar transcri√ß√£o5","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3632,2320]},{"parameters":{"promptType":"define","text":"=Dado o seguinte contexto:\n- <message>{{ $('OpenAI').item.json.text }}</message>\n\nRetorne apenas o Resumo da Mensagem","messages":{"messageValues":[{"message":"=## Tarefa\n\nVoc√™ √© um sistema de transcri√ß√£o de √°udio. Transcreva com precis√£o o conte√∫do falado do √°udio fornecido. Mantenha a pontua√ß√£o correta e identifique claramente as pausas e entona√ß√µes. Retorne apenas o texto transcrito, sem explica√ß√µes adicionais.\n"}]}},"id":"22153d15-dd5d-405e-b735-c0622b98abe2","name":"Resumo2","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[3200,2320]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"43b5f761-c6b5-4dc5-a324-91023fe117e8","leftValue":"={{ $json.body.data.messageType }}","rightValue":"reactionMessage","operator":{"type":"string","operation":"equals"}},{"id":"d639fb9d-4909-4a47-a22d-d8c274c9d5b9","leftValue":"={{ $('Webhook').item.json.body.data.message.reactionMessage.text }}","rightValue":"ü§ñ","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"1f905908-fe68-48f7-8134-88e34ddadcd3","leftValue":"={{ $json.body.data.key.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"id":"9c9272eb-434b-4c9d-a1b1-a8139b6f992d","name":"Emoji Gatilho1","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1424,2448]},{"parameters":{"assignments":{"assignments":[{"id":"5512d170-a538-4322-9f5c-e078aed752f7","name":"remoteJid","value":"={{ $json.body.data.key.remoteJid }}","type":"string"},{"id":"56ece6ca-d821-45f9-8060-b39d38bf7536","name":"pushName","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"2e48526f-d1af-4aa8-aba2-96ce14bf6670","name":"date_time","value":"={{ $json.body.date_time }}","type":"string"},{"id":"509e070d-e4f0-47c7-ba28-dfd471dfd98c","name":"apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"be7dba92-a204-4818-8d83-736492c485d5","name":"server_url","value":"={{ $json.body.server_url }}","type":"string"},{"id":"daa22b30-2d23-4505-bd1f-0f7e537bbd01","name":"audioMessage_base64","value":"={{ $json.body.data.message.base64 }}","type":"string"},{"id":"baf35516-8f30-454b-b3f0-c4005480209c","name":"instance","value":"={{ $json.body.instance }}","type":"string"},{"id":"11b9ed3c-8905-4da4-a0e9-7c3a3eccfb16","name":"seconds","value":"={{ $json.body.data.message.audioMessage.seconds }}","type":"number"},{"id":"b8886370-b6be-4605-8f59-aced94e91d28","name":"message.key.id","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"7a34fe43-97da-4e98-b396-d09503971c36","name":"body.data.messageType","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"d325d1b0-e3b1-46d5-b73b-50a245bf6229","name":"body.data.message.reactionMessage.key.id","value":"={{ $json.body.data.message.reactionMessage.key.id }}","type":"string"},{"id":"f7c31a75-cf78-4271-8872-c43ef183be27","name":"body.data.key.fromMe","value":"={{ $json.body.data.key.fromMe }}","type":"boolean"}]},"options":{}},"id":"0561c245-7007-4e24-9b5d-d5ed1fdbace5","name":"Data handler1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1200,2448]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"72fbd513-8527-418b-a03c-605984fe59a7","leftValue":"={{ $json.error.status }}","rightValue":400,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2000,2432],"id":"43b11e49-860c-40ec-99a8-5745d8045e93","name":"If5"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2208,2160],"id":"6b3efeba-efa7-4509-bf49-94fdbdeb22cb","name":"No Operation, do nothing4"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2640,2448],"id":"38a44c1b-dba6-4324-b466-5f367d9b520f","name":"OpenAI","alwaysOutputData":false,"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[2448,2448],"id":"ce64671b-d9f6-4572-9601-8fdbd7cc9d94","name":"Convert to File3","alwaysOutputData":true},{"parameters":{"method":"POST","url":"={{ $json.server_url }}/chat/getBase64FromMediaMessage/{{ $json.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"apikey","value":"={{ $json.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $json.body.data.message.reactionMessage.key.id }}\"\n    }\n  },\n  \"convertToMp4\": true\n} ","options":{}},"id":"7852532b-e71d-46c8-969e-4b625b8d2a67","name":"getBase1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1728,2432],"alwaysOutputData":false,"onError":"continueRegularOutput"},{"parameters":{"assignments":{"assignments":[{"id":"ad88578f-6a25-4243-a2b1-db664137671b","name":"base64","value":"={{ $json.base64  || $('userData').item.json.audioMessage_base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2224,2448],"id":"c4003c2e-e491-49a6-bb46-9ff1e42b3924","name":"base1"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{"temperature":0}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[3184,2528],"id":"cecb1323-5276-4d50-b826-09cf572814cc","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"content":"# ü§ñDispeech - Manual","height":820,"width":3760,"color":6},"type":"n8n-nodes-base.stickyNote","position":[1152,2064],"typeVersion":1,"id":"c05c325a-780e-40a1-92af-93f570926f28","name":"Sticky Note"},{"parameters":{"content":"# Webhook Supremo","height":980,"width":1100},"type":"n8n-nodes-base.stickyNote","position":[0,-160],"typeVersion":1,"id":"b07ec0cd-b673-40cc-8ede-e869075e3390","name":"Sticky Note4"},{"parameters":{"method":"POST","url":"https://api.groq.com/openai/v1/audio/transcriptions","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"model","value":"whisper-large-v3-turbo"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"id":"5a3c6f22-82cd-4999-8805-a92a49788540","name":"grok","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2864,208]},{"parameters":{"assignments":{"assignments":[{"id":"98c8f678-ffeb-46d1-923c-9fc12e5d05eb","name":"base64","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"id":"7043b380-d6d8-4653-86f9-d386f6c0cfdf","name":"audio","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2208,208]},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[2544,208],"id":"c797c814-e209-429d-b5be-bc6cf13d6533","name":"Convert to File1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"},"id":"4712475c-a813-4c27-9a0b-d2b7e463893d"}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1840,-128],"id":"b6ddc672-cc01-4d77-ba49-c486a35211e6","name":"Message Type1"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"285e6ea9-c0ff-48ea-8d8c-36a0a5317ce4","leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1840,208],"id":"96a88909-9075-4a4b-a811-79b26144bbdc","name":"Message Type2"},{"parameters":{"assignments":{"assignments":[{"id":"c4eec23b-7c64-49a5-b5ac-83fb1cba12b8","name":"data.text","value":"={{ $json.body.data.message.conversation }}","type":"string"},{"id":"0d85de35-5de2-4b9e-acab-9e69405cb222","name":"data.messageType","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"87bdddfb-353d-4f6a-9dad-78183034fc49","name":"data.mediaUrl","value":"={{ $json.body.data.message.audioMessage.url }}","type":"string"},{"id":"9d9806b8-b41d-4930-b8a5-0584397ec7d5","name":"data.participant","value":"={{ $json.body.data.key.participant.replace('@s.whatsapp.net', '') }}","type":"string"},{"id":"137983ae-7394-4933-aa27-08ef771e7e4a","name":"data.pushName","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"46b43be0-ea97-411c-865c-a2f15370f112","name":"data.remoteJid","value":"={{ $json.body.data.key.remoteJid }}","type":"string"},{"id":"7a4b5748-8e26-4e82-99ab-c7029177e1cb","name":"evo.instance","value":"={{ $json.body.instance }}","type":"string"},{"id":"d4e660eb-01db-4949-91ac-81bfdd78bccc","name":"evo.server_url","value":"={{ $json.body.server_url }}","type":"string"},{"id":"2e6caccf-ba56-4743-bd90-99245d2037a2","name":"evo.apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"76c211ac-443c-4176-81c6-8e378ff2bff4","name":"data.date","value":"={{ $today.format('yyyy-MM-dd') }} ","type":"string"},{"id":"ec7a8c0d-fe5c-40b5-b204-d50599145f80","name":"data.hour","value":"={{ $now.format('TT') }}","type":"string"},{"id":"b6045ea4-bec0-45f7-9d47-8d2ba4ad63d8","name":"data.sticker","value":"={{ $json.body.data.message.stickerMessage.url }}","type":"string"},{"id":"bc5691b3-b7e4-49b5-9cd8-ee50891083df","name":"data.imagem","value":"={{ $json.body.data.message.imageMessage }}","type":"string"},{"id":"36aaefef-f54a-4fb3-b9f4-09b37ee67d49","name":"data.legenda","value":"={{ $json.body.data.message.imageMessage.caption }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1200,208],"id":"62cc1a23-1e1e-4e33-8c83-bf8990b7005e","name":"Data Handler"},{"parameters":{"assignments":{"assignments":[{"id":"7b6cf1a4-97f2-46cb-a401-91524cf2dde8","name":"base64","value":"={{ $('Webhook').item.json.body.data.message.imageMessage.jpegThumbnail }}","type":"string"}]},"options":{}},"id":"b615801e-d096-4ed2-97df-92362d2dd10a","name":"IMAGENS","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2224,592]},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"=Voc√™ √© um agente especializado em descrever imagens para o WhatsApp. Ao receber qualquer imagem (foto, sticker ou ilustra√ß√£o), sua √∫nica tarefa √© enviar ao n√≥ de sa√≠da **uma descri√ß√£o visual completa**, seguida de qualquer texto presente nela, sem coment√°rios extras ou an√°lises de contexto externo.\n\nRegras:\n1. Analise todos os elementos visuais: objetos, pessoas, cores, formas, texturas, ambiente e a√ß√µes.\n2. Descreva em frases curtas, em portugu√™s claro, iniciando com ‚Äúum‚Ä¶‚Äù ou ‚Äúuma‚Ä¶‚Äù.\n3. **Se houver texto na imagem**, liste-o ao final da descri√ß√£o precedido por ‚ÄúTexto na imagem: ‚Äò‚Ä¶‚Äô‚Äù.\n4. N√£o adicione interpreta√ß√µes subjetivas (emo√ß√µes, inten√ß√µes) nem recomenda√ß√µes.\n5. N√£o inclua metadados (tamanho, formato, data) ou instru√ß√µes de uso.\n6. Retorne **apenas** a descri√ß√£o e o texto encontrado, nada mais.\n\n‚Äî  \n**Exemplos de sa√≠da:**  \n\n**Exemplo 1 (foto com texto)**  \nImagem: fachada de uma padaria com letreiro iluminado ‚ÄúP√£o & Cia‚Äù  \n\n**Exemplo 2 (foto sem texto)**  \nImagem: imagem de um panda abra√ßando um bambu \n\n**Exemplo 3 (banner com texto longo)**  \nImagem: banner de evento em parque com ‚ÄúFestival de M√∫sica ao Vivo ‚Äì Dia 15/08‚Äù\n\n**Exemplo 4 (foto de produto com logo)**  \nImagem: embalagem branca de caf√© com logo ‚ÄúGr√£o Dourado‚Äù e selo ‚Äú100% Ar√°bica‚Äù \n\n\n","inputType":"base64","options":{}},"id":"8251853c-2438-4eae-ac39-5e4518545c1e","name":"OpenAI IMAGEM","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[2864,592],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[2560,592],"id":"02e4982f-86fa-4443-b7ca-53b47a7f302d","name":"Convert to File"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"285e6ea9-c0ff-48ea-8d8c-36a0a5317ce4","leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"stickerMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Sticker"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1840,384],"id":"7800f5b2-1f88-46fe-93b1-660537498bea","name":"Message Type3"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"285e6ea9-c0ff-48ea-8d8c-36a0a5317ce4","leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Imagem"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1840,592],"id":"c85d5435-4327-434b-acd7-de066563779e","name":"Message Type4"},{"parameters":{"assignments":{"assignments":[{"id":"7b6cf1a4-97f2-46cb-a401-91524cf2dde8","name":"base64","value":"={{ $('Webhook').item.json.body.data.message.base64 }}","type":"string"}]},"options":{}},"id":"1c14d66b-5965-4617-b483-aa39ba6dbf0f","name":"IMAGENS1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2208,384]},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"=Voc√™ √© um agente de transcri√ß√£o de stickers do WhatsApp. Ao receber um sticker, sua √∫nica tarefa √© enviar ao n√≥ de sa√≠da **exatamente** o que voc√™ transcreveu ou descreveu, sem nenhum coment√°rio extra.\n\nRegras:\n1. **Se o sticker contiver texto leg√≠vel**, extraia e retorne **somente** esse texto (pontua√ß√£o, emojis e mai√∫sculas/min√∫sculas inclusos).\n2. **Se n√£o houver texto leg√≠vel**, retorne **somente** uma breve descri√ß√£o do que aparece no sticker (ex.: ‚Äúcachorro branco correndo no parque‚Äù ou ‚Äúemoji de cora√ß√£o vermelho brilhante‚Äù).\n3. **N√£o** adicione explica√ß√µes, tradu√ß√µes, instru√ß√µes ou coment√°rios ‚Äî apenas o texto extra√≠do ou a descri√ß√£o.\n4. Responda **sempre** em portugu√™s.\n\n‚Äî  \n**Exemplo 1 (com texto):**  \nSticker: ‚ÄúBom dia! ‚òÄÔ∏è‚Äù  \n\n**Exemplo 2 (sem texto):**  \nSticker: imagem de um gatinho dormindo em uma almofada  \n","inputType":"base64","options":{}},"id":"74c7598d-002b-46f0-93b4-625505c909b2","name":"OpenAI IMAGEM1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[2864,384],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[2544,384],"id":"3daa5b4f-ce0f-408b-8602-ebad85d90a08","name":"Convert to File2"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"},"id":"4712475c-a813-4c27-9a0b-d2b7e463893d"}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1840,48],"id":"a5471646-c050-4c89-a9a2-8d37521a1270","name":"Message Type5"},{"parameters":{"assignments":{"assignments":[{"id":"fe801d46-6e9f-42a5-a949-056014d07895","name":"body.descricao_imagem","value":"={{ $json.content }}","type":"string"}]},"options":{}},"id":"cb742e8c-93b9-4065-a54f-7612954b5b33","name":"Edit Fields - Descri√ß√£o IMG","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3168,592]},{"parameters":{"assignments":{"assignments":[{"id":"fe801d46-6e9f-42a5-a949-056014d07895","name":"body.sticker","value":"={{ $json.content }}","type":"string"}]},"options":{}},"id":"6a7a4cd9-fbfb-48e4-ac39-c90f098303e9","name":"Edit Fields - Descricao Stickers","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3168,384]},{"parameters":{"assignments":{"assignments":[{"id":"fe801d46-6e9f-42a5-a949-056014d07895","name":"body.transcricao_audio","value":"={{ $json.text }}","type":"string"}]},"options":{}},"id":"bcbb9fde-c91d-483d-a721-c092ad751603","name":"Edit Fields - Transcricao Audio","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3168,208]},{"parameters":{"rule":{"interval":[{"triggerAtHour":19,"triggerAtMinute":10}]}},"id":"70c7315b-292f-44f0-9841-b5c68fdc94db","name":"Schedule Trigger1","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[1200,1568]},{"parameters":{"promptType":"define","text":"=Data de hoje: {{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ \n   $now.hour.toString().padStart(2,'0') }}:{{ \n   $now.minute.toString().padStart(2,'0') }}\n\nMensagens (campo data): \n{{$json.data}}\n","options":{"systemMessage":"=Voc√™ √© um agente respons√°vel por criar um **Resumo das √∫ltimas 24 horas** das mensagens trocadas no grupo **\"F.IA ADV - Alunos Curso\"**, referente ao dia **{{ $now.format('dd/MM/yyyy') }}**. Apresente o resumo em formato de di√°logo de podcast em portugu√™s do Brasil, alternando falas entre Speaker 1 e Speaker 2, com tom amig√°vel, descontra√≠do e entusiasmado, abuse da sua criatividade de modo que chave aten√ß√£o e retenha a audi√™ncia, se for necess√°rio utilize a estrat√©gia de AIDA e n√£o utilize emojis. utilizando **exclusivamente** o JSON completo abaixo como fonte:\n\n```json\n{{ JSON.stringify($json.data, null, 2) }}\n\nCada objeto desse array tem estes campos:\n- `created_at` (timestamp da mensagem)  \n- `user_id` (nome ou identificador do autor)  \n- `phone`  \n- `message_type`  \n- `data` (texto da mensagem)  \n- `hora` (hor√°rio)\n\nRegras de formata√ß√£o\n\nO resumo gerado deve ser feito no seguinte formato:\nDialogo natural em portugues do Brasil com emo√ß√£o na entona√ß√£o entre 2 narradores em formato de podcast, com linguagem natural e entusiasmada, como se fosse uma fofoca entre amigos. A Abertura do texto sempre ser√° a express√£o \"Ol√° Grupo Suite Helpers VIP! Bora come√ßar o ZapResumoCast de hoje?\".\n\nSpeaker 1: Ol√° Grupo F.IA ADV - Alunos Curso! Bora come√ßar o ZapResumoCast de hoje?\n\nCada fala deve corresponder ao resumo de uma √∫nica mensagem (campo data), mencionando quem falou (user_id) e o t√≥pico principal.\n\nN√£o copie texto literal do campo data; extraia apenas a ess√™ncia do que foi dito.\n\nUse exatamente uma quebra de linha entre falas, obedecendo este modelo:\nSpeaker 1: Apresenta/comenta [resumo da mensagem 1]\nSpeaker 2: Faz breve coment√°rio do [resumo da mensagem 1] e Apresenta/comenta [resumo da mensagem 2]\nSpeaker 1: Faz breve coment√°rio do [resumo da mensagem 2] e Apresenta/Comenta [resumo da mensagem 3]\n‚Ä¶\n\n5. N√£o inclua metadados, instru√ß√µes ou coment√°rios ‚Äî **retorne somente** o di√°logo de resumo.\n\n#### Prompt de Usu√°rio\n```text\nData de hoje: {{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ \n   $now.hour.toString().padStart(2,'0') }}:{{ $now.minute.toString().padStart(2,'0') }}\n\nConte√∫do a resumir (campo data):\n```json\n{{ JSON.stringify($json.data, null, 2) }}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[2352,1568],"id":"eee040c8-812e-4978-9e30-406469be8844","name":"AI Agent1"},{"parameters":{"model":"gpt-4o","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[2352,1824],"id":"fffdd95d-686d-40b4-a4c3-9092f16acb87","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"jsCode":"// VERS√ÉO COM DEBUG\nconst textoOriginal = $input.first().json.output || '';\n\nconsole.log('Tamanho do texto original:', textoOriginal.length);\nconsole.log('Primeiros 100 caracteres:', textoOriginal.substring(0, 100));\nconsole.log('√öltimos 100 caracteres:', textoOriginal.substring(textoOriginal.length - 100));\n\nconst prefixo = \"O Dialogo deve ser apresentado em formato de podcast com linguagem natural e entusiasmada, como se fosse uma fofoca entre amigos.\\\\n\";\nconst textoFormatado = textoOriginal.trim().replace(/\\n/g, '\\\\n\\\\n').replace(/\"/g, '\\\\\"');\nconst resultado = prefixo + textoFormatado;\n\nreturn [{\n  json: {\n    textoFormatado: resultado,\n    tamanhoOriginal: textoOriginal.length,\n    tamanhoFinal: resultado.length\n  }\n}];"},"id":"2fb972f4-c6e8-4798-a315-06d6ba9be19e","name":"Format Message1","type":"n8n-nodes-base.code","typeVersion":2,"position":[2944,1568]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4c8c18a0-38fe-46d6-b452-cb141a80bfff","leftValue":"={{ $('Supabase2').item.json.data }}","rightValue":"={{ $today }}","operator":{"type":"dateTime","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[1872,1568],"id":"088d79ec-c645-4afb-ac91-0f90c022f788","name":"Today Filter 1"},{"parameters":{"operation":"getAll","tableId":"chat_messages_pauloadv","returnAll":true,"filterType":"none"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1440,1568],"id":"22dd85b0-b493-4f52-90b2-aee08394f598","name":"Supabase2","credentials":{"supabaseApi":{"id":"337Z7ndUMMaF8CZx","name":"Supabase ZAP FINANCEIRO"}}},{"parameters":{"assignments":{"assignments":[{"id":"cee73d0a-677e-437e-b4c7-da21a95656df","name":"created_at","value":"={{ $json.created_at }}","type":"string"},{"id":"e20a4fd8-ef6e-4fbe-a0b5-c937d0e8cf3e","name":"user_id","value":"={{ $json.name }}","type":"string"},{"id":"672b692b-348b-4646-a484-1ade71c550dd","name":"phone","value":"={{ $json.whatsapp }}","type":"string"},{"id":"4586a4e1-c507-4042-97d5-d00efa676aed","name":"message_type","value":"={{ $json.mensagem }}","type":"string"},{"id":"2c4a3f1f-eabe-454b-9a3d-dd7842378dac","name":"data","value":"={{ $json.data }}","type":"string"},{"id":"c8ed58e6-0c03-402a-9cde-b244333aa8b9","name":"hora","value":"={{ $json.hora }}","type":"string"},{"id":"df2fce9f-bd0f-478a-9cc1-c515d6bc55ea","name":"id","value":"={{ $json.id }}","type":"number"},{"id":"57f3bfba-986d-4522-8427-76b74b3237b2","name":"message_transcricao","value":"={{ $json.transcricao_audio }}","type":"string"},{"id":"d617cafc-e2d2-41c4-a33e-ae5aba99cdc4","name":"sticker","value":"={{ $json.sticker }}","type":"string"},{"id":"b003de25-81bb-4faa-9198-10bd47be8b7f","name":"transcricao_img","value":"={{ $json.transcricao_img }}","type":"string"},{"id":"e20f86d4-5f31-4f36-81ca-a83ba76feb3b","name":"legenda_imagem","value":"={{ $json.legenda_imagem }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1664,1568],"id":"96b12a0a-7ff0-4e41-a68c-eb684b28d0da","name":"Edit Fields1"},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[3168,1568],"id":"1e90cc51-d52d-42db-bf12-ac23558fd027","name":"Wait","webhookId":"f4e93fc0-5acd-4381-bd2a-963be41fac04"},{"parameters":{"jsCode":"// Pegando os dados da requisi√ß√£o HTTP anterior\nconst audioChunks = items.map(item => {\n  const part = item.json.candidates[0].content.parts.find(p => p.inlineData);\n  return Buffer.from(part.inlineData.data, 'base64');\n});\n\n// Concatenar todos os buffers (se houver mais de um chunk)\nconst audioBuffer = Buffer.concat(audioChunks);\n\n// Criando um cabe√ßalho WAV simples (pode ser removido se quiser s√≥ mp3)\nfunction createWavHeader(buffer) {\n  const header = Buffer.alloc(44);\n  const dataLength = buffer.length;\n  header.write('RIFF', 0);\n  header.writeUInt32LE(dataLength + 36, 4);\n  header.write('WAVE', 8);\n  header.write('fmt ', 12);\n  header.writeUInt32LE(16, 16);\n  header.writeUInt16LE(1, 20);\n  header.writeUInt16LE(1, 22);\n  header.writeUInt32LE(24000, 24); // Sample Rate\n  header.writeUInt32LE(24000 * 2, 28);\n  header.writeUInt16LE(2, 32);\n  header.writeUInt16LE(16, 34);\n  header.write('data', 36);\n  header.writeUInt32LE(dataLength, 40);\n  return header;\n}\n\n// Montando o arquivo WAV (pode remover se quiser manter mp3 direto)\nconst header = createWavHeader(audioBuffer);\nconst wavBuffer = Buffer.concat([header, audioBuffer]);\n\n// Retornando o arquivo no formato bin√°rio do n8n\nreturn [\n  {\n    binary: {\n      data: {\n        data: wavBuffer.toString('base64'),\n        mimeType: 'audio/wav',\n        fileName: 'gemini_output.wav',\n      },\n    },\n  },\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3712,1568],"id":"cf14de5d-20ab-4fbd-8f3d-c6942ce7489d","name":"Trata e Converte"},{"parameters":{"method":"POST","url":"https://www.docspal.com/api/convert","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"key","value":"1197b9b21d455555e48582e8b8bad789e36411a9712e11b287f5b420617d71df"},{"name":"to-format","value":"mp3"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{"redirect":{"redirect":{}},"timeout":600000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4000,1568],"id":"445f7277-80a4-438c-956c-99d0ca878c4d","name":"Converte WAV p MP3"},{"parameters":{"jsCode":"// Converte a string JSON (que est√° em data) em objeto real\nconst raw = $json.data;\nconst parsed = JSON.parse(raw);\n\n// Retorna s√≥ a parte √∫til para os pr√≥ximos n√≥s\nreturn [\n  {\n    json: {\n      url: parsed.output.url\n    }\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4304,1568],"id":"7760d834-95a1-4619-acad-efe2d5fd9597","name":"Extrair URL do MP3"},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:streamGenerateContent","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"AIzaSyCOAL-EWiQ_xKi5XZiNf58ZlPS3ycJouJM"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"contents\": [\n    {\n      \"role\": \"user\",\n      \"parts\": [\n        {\n          \"text\": \"{{ $json.textoFormatado }}\"\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"responseModalities\": [\n      \"audio\"\n    ],\n    \"temperature\": 1,\n    \"speechConfig\": {\n      \"multiSpeakerVoiceConfig\": {\n        \"speakerVoiceConfigs\": [\n          {\n            \"speaker\": \"Speaker 1\",\n            \"voiceConfig\": {\n              \"prebuiltVoiceConfig\": {\n                \"voiceName\": \"Kore\"\n              }\n            }\n          },\n          {\n            \"speaker\": \"Speaker 2\",\n            \"voiceConfig\": {\n              \"prebuiltVoiceConfig\": {\n                \"voiceName\": \"Orus\"\n              }\n            }\n          }\n        ]\n      }\n    }\n  }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3440,1568],"id":"7f6e99ef-1948-458f-98c7-4546fbb10080","name":"HTTP Request2","notesInFlow":false},{"parameters":{},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[4528,1568],"id":"b4081b0c-6521-4077-bf47-e78778d092eb","name":"Resumo p/ Adm","credentials":{}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"id":"fc7632bf-d540-4c92-9b97-81724148c2f1","name":"Agregar Todas Mensagens1","type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[2112,1568]},{"parameters":{"amount":30},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2720,1568],"id":"5bf7d136-acb0-40b2-b209-2e564376da51","name":"Wait1","webhookId":"fd62c549-f959-4b54-8df1-cf44640bb682"},{"parameters":{"content":"# ü§ñZapResumoCast","height":820,"width":3760,"color":3},"type":"n8n-nodes-base.stickyNote","position":[1152,1248],"typeVersion":1,"id":"a99af1cc-d09e-462d-b183-9d59d5d6e360","name":"Sticky Note1"}],"connections":{"Webhook":{"main":[[{"node":"Data handler1","type":"main","index":0},{"node":"Data Handler","type":"main","index":0}]]},"Message Type":{"main":[[{"node":"Message Type1","type":"main","index":0}],[{"node":"Message Type5","type":"main","index":0}],[{"node":"Message Type2","type":"main","index":0}],[{"node":"Message Type3","type":"main","index":0}],[{"node":"Message Type4","type":"main","index":0}]]},"Group Filter":{"main":[[{"node":"Message Type","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Supabase1","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"HTTP Request1","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Format Message":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Today Filter ":{"main":[[{"node":"Format Message","type":"main","index":0}]]},"Supabase1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Today Filter ","type":"main","index":0}]]},"If4":{"main":[[{"node":"Resumo2","type":"main","index":0}],[{"node":"Enviar transcri√ß√£o4","type":"main","index":0}]]},"Resumo2":{"main":[[{"node":"Enviar transcri√ß√£o5","type":"main","index":0}]]},"Emoji Gatilho1":{"main":[[{"node":"getBase1","type":"main","index":0}],[{"node":"No Operation, do nothing3","type":"main","index":0}]]},"Data handler1":{"main":[[{"node":"Emoji Gatilho1","type":"main","index":0}]]},"If5":{"main":[[{"node":"No Operation, do nothing4","type":"main","index":0}],[{"node":"base1","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"If4","type":"main","index":0}]]},"Convert to File3":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"getBase1":{"main":[[{"node":"If5","type":"main","index":0}]]},"base1":{"main":[[{"node":"Convert to File3","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Resumo2","type":"ai_languageModel","index":0}]]},"grok":{"main":[[{"node":"Edit Fields - Transcricao Audio","type":"main","index":0}]]},"audio":{"main":[[{"node":"Convert to File1","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"grok","type":"main","index":0}]]},"Message Type2":{"main":[[{"node":"audio","type":"main","index":0}]]},"Message Type1":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Data Handler":{"main":[[{"node":"Group Filter","type":"main","index":0}]]},"IMAGENS":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"OpenAI IMAGEM":{"main":[[{"node":"Edit Fields - Descri√ß√£o IMG","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"OpenAI IMAGEM","type":"main","index":0}]]},"Message Type3":{"main":[[{"node":"IMAGENS1","type":"main","index":0}]]},"Message Type4":{"main":[[{"node":"IMAGENS","type":"main","index":0}]]},"IMAGENS1":{"main":[[{"node":"Convert to File2","type":"main","index":0}]]},"OpenAI IMAGEM1":{"main":[[{"node":"Edit Fields - Descricao Stickers","type":"main","index":0}]]},"Convert to File2":{"main":[[{"node":"OpenAI IMAGEM1","type":"main","index":0}]]},"Message Type5":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Edit Fields - Descri√ß√£o IMG":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Edit Fields - Descricao Stickers":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Edit Fields - Transcricao Audio":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"Supabase2","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Format Message1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Today Filter 1":{"main":[[{"node":"Agregar Todas Mensagens1","type":"main","index":0}]]},"Supabase2":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"Today Filter 1","type":"main","index":0}]]},"Trata e Converte":{"main":[[{"node":"Converte WAV p MP3","type":"main","index":0}]]},"Converte WAV p MP3":{"main":[[{"node":"Extrair URL do MP3","type":"main","index":0}]]},"HTTP Request2":{"main":[[{"node":"Trata e Converte","type":"main","index":0}]]},"Wait":{"main":[[{"node":"HTTP Request2","type":"main","index":0}]]},"Agregar Todas Mensagens1":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Format Message1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"86ac062a-cbcf-49a3-bd2c-0f143e9545a0","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-28T16:20:04.997Z","createdAt":"2025-11-28T16:20:04.997Z","role":"workflow:owner","workflowId":"NZ55aGL0lAZSuNnw","projectId":"86fLtGJ4RKYxddia"}],"activeVersion":null,"tags":[]}
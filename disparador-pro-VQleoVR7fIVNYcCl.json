{"createdAt":"2025-08-13T15:31:30.028Z","updatedAt":"2025-08-14T19:25:49.087Z","id":"VQleoVR7fIVNYcCl","name":"DISPARADOR PRO","active":false,"isArchived":false,"nodes":[{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Conectar WhatsApp</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            color: white;\n            min-height: 100vh;\n            margin: 0;\n            padding: 0;\n        }\n\n        .app-layout {\n            display: flex;\n            min-height: 100vh;\n        }\n\n        /* Sidebar */\n        .sidebar {\n            width: 70px;\n            background: rgba(0, 0, 0, 0.3);\n            backdrop-filter: blur(10px);\n            border-right: 1px solid rgba(255, 255, 255, 0.1);\n            transition: all 0.3s ease;\n            position: relative;\n            z-index: 1000;\n        }\n\n        .sidebar:hover {\n            width: 250px;\n        }\n\n        .sidebar-header {\n            padding: 20px;\n            text-align: center;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .sidebar-logo {\n            font-size: 1.5rem;\n            font-weight: 600;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n            white-space: nowrap;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .sidebar-logo {\n            opacity: 1;\n        }\n\n        .sidebar-menu {\n            padding: 20px 0;\n        }\n\n        .menu-item {\n            display: flex;\n            align-items: center;\n            padding: 15px 20px;\n            color: #ccc;\n            text-decoration: none;\n            transition: all 0.3s ease;\n            position: relative;\n            white-space: nowrap;\n        }\n\n        .menu-item:hover {\n            background: rgba(37, 211, 102, 0.1);\n            color: #25d366;\n        }\n\n        .menu-item.active {\n            background: rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            border-right: 3px solid #25d366;\n        }\n\n        .menu-icon {\n            font-size: 1.2rem;\n            width: 30px;\n            text-align: center;\n            flex-shrink: 0;\n        }\n\n        .menu-text {\n            margin-left: 15px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .menu-text {\n            opacity: 1;\n        }\n\n        /* Main content */\n        .main-content {\n            flex: 1;\n            padding: 20px;\n            overflow-x: auto;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            min-height: 100vh;\n        }\n\n        .container {\n            width: 100%;\n            height: 100%;\n            display: flex;\n            gap: 60px;\n            align-items: stretch;\n            justify-content: center;\n            max-width: none;\n        }\n\n        .left-section {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            min-height: 70vh;\n        }\n\n        .right-section {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            min-height: 70vh;\n        }\n\n        .header {\n            text-align: center;\n            margin-bottom: 30px;\n        }\n\n        .header h1 {\n            font-size: 2.5rem;\n            font-weight: 600;\n            margin-bottom: 15px;\n        }\n\n        .header p {\n            color: #888;\n            font-size: 1rem;\n            line-height: 1.5;\n        }\n\n        .qr-section {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            padding: 40px;\n            text-align: center;\n            backdrop-filter: blur(10px);\n        }\n\n        .qr-section h2 {\n            font-size: 1.3rem;\n            margin-bottom: 30px;\n            color: #fff;\n        }\n\n        .input-group {\n            margin-bottom: 25px;\n        }\n\n        .input-group input {\n            width: 100%;\n            padding: 15px;\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            color: white;\n            font-size: 1rem;\n            outline: none;\n            transition: all 0.3s ease;\n        }\n\n        .input-group input::placeholder {\n            color: #888;\n        }\n\n        .input-group input:focus {\n            border-color: #25d366;\n            box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.2);\n        }\n\n        .generate-btn {\n            width: 100%;\n            padding: 15px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-size: 1rem;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            margin-bottom: 25px;\n        }\n\n        .generate-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);\n        }\n\n        .generate-btn:disabled {\n            background: #444;\n            cursor: not-allowed;\n            transform: none;\n            box-shadow: none;\n        }\n\n        .qr-display {\n            display: none;\n            flex-direction: column;\n            align-items: center;\n            gap: 20px;\n        }\n\n        .qr-display.show {\n            display: flex;\n        }\n\n        .qr-code {\n            width: 250px;\n            height: 250px;\n            border: 2px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            background: white;\n            padding: 10px;\n        }\n\n        .qr-code img {\n            width: 100%;\n            height: 100%;\n            object-fit: contain;\n        }\n\n        .refresh-btn {\n            background: rgba(255, 255, 255, 0.1);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            color: white;\n            padding: 10px 20px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 0.9rem;\n            transition: all 0.3s ease;\n        }\n\n        .refresh-btn:hover {\n            background: rgba(255, 255, 255, 0.2);\n        }\n\n        .refresh-btn:disabled {\n            background: #444;\n            cursor: not-allowed;\n        }\n\n        .timer {\n            color: #25d366;\n            font-size: 0.9rem;\n            margin-top: 10px;\n        }\n\n        .instructions {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            padding: 30px;\n            backdrop-filter: blur(10px);\n        }\n\n        .instructions h3 {\n            color: #25d366;\n            margin-bottom: 20px;\n            font-size: 1.2rem;\n        }\n\n        .step {\n            display: flex;\n            align-items: flex-start;\n            gap: 15px;\n            margin-bottom: 20px;\n            padding: 15px;\n            background: rgba(255, 255, 255, 0.02);\n            border-radius: 8px;\n        }\n\n        .step-number {\n            background: #25d366;\n            color: white;\n            width: 28px;\n            height: 28px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: bold;\n            font-size: 0.9rem;\n            flex-shrink: 0;\n        }\n\n        .step-content h4 {\n            color: #fff;\n            margin-bottom: 5px;\n            font-size: 1rem;\n        }\n\n        .step-content p {\n            color: #888;\n            font-size: 0.9rem;\n            line-height: 1.4;\n        }\n\n        .loading {\n            display: none;\n            align-items: center;\n            justify-content: center;\n            gap: 10px;\n            color: #25d366;\n            margin: 20px 0;\n        }\n\n        .loading.show {\n            display: flex;\n        }\n\n        .spinner {\n            width: 20px;\n            height: 20px;\n            border: 2px solid rgba(37, 211, 102, 0.3);\n            border-top: 2px solid #25d366;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n\n        .error {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n            padding: 15px;\n            border-radius: 8px;\n            margin: 15px 0;\n            display: none;\n        }\n\n        .error.show {\n            display: block;\n        }\n\n        .connection-status {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            color: #25d366;\n            padding: 15px;\n            border-radius: 8px;\n            margin: 15px 0;\n            display: none;\n        }\n\n        .connection-status.show {\n            display: block;\n        }\n\n        @media (max-width: 768px) {\n            .container {\n                flex-direction: column;\n                gap: 30px;\n            }\n            \n            .header h1 {\n                font-size: 2rem;\n            }\n            \n            .qr-section, .instructions {\n                padding: 25px;\n            }\n\n            .sidebar {\n                width: 60px;\n            }\n\n            .sidebar:hover {\n                width: 200px;\n            }\n\n            .main-content {\n                padding: 15px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"app-layout\">\n        <!-- Main Content -->\n        <div class=\"main-content\">\n            <div class=\"container\">\n                <div class=\"left-section\">\n                    <div class=\"header\">\n                        <h1>Conectar WhatsApp</h1>\n                        <p>Escaneie o QR Code ou use o código de pareamento para conectar sua conta do WhatsApp à Evolution API.</p>\n                    </div>\n\n                    <div class=\"qr-section\">\n                        <h2>Escaneie o QR Code</h2>\n                        \n                        <div class=\"form-section\" id=\"formSection\">\n                            <div class=\"input-group\">\n                                <input type=\"text\" id=\"instanceName\" placeholder=\"Digite o nome da conexão\" maxlength=\"50\">\n                            </div>\n                            <button class=\"generate-btn\" id=\"generateBtn\">Gerar QR Code</button>\n                        </div>\n\n                        <div class=\"loading\" id=\"loading\">\n                            <div class=\"spinner\"></div>\n                            <span>Gerando QR Code...</span>\n                        </div>\n\n                        <div class=\"error\" id=\"error\">\n                            <span id=\"errorMessage\"></span>\n                        </div>\n\n                        <div class=\"connection-status\" id=\"connectionStatus\">\n                            <span id=\"statusMessage\"></span>\n                        </div>\n\n                        <div class=\"qr-display\" id=\"qrDisplay\">\n                            <div class=\"qr-code\">\n                                <img id=\"qrImage\" src=\"\" alt=\"QR Code\">\n                            </div>\n                            <button class=\"refresh-btn\" id=\"refreshBtn\">🔄 Gerar Novamente</button>\n                            <div class=\"timer\" id=\"timer\">Expira em 29 segundos</div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"right-section\">\n                    <div class=\"instructions\">\n                        <h3>Como conectar</h3>\n                        \n                        <div class=\"step\">\n                            <div class=\"step-number\">1</div>\n                            <div class=\"step-content\">\n                                <h4>Abra o WhatsApp no seu celular</h4>\n                                <p>Certifique-se de que você está usando a versão mais recente do aplicativo.</p>\n                            </div>\n                        </div>\n\n                        <div class=\"step\">\n                            <div class=\"step-number\">2</div>\n                            <div class=\"step-content\">\n                                <h4>Acesse as configurações</h4>\n                                <p>Toque em <strong>Configurações → Dispositivos conectados</strong></p>\n                            </div>\n                        </div>\n\n                        <div class=\"step\">\n                            <div class=\"step-number\">3</div>\n                            <div class=\"step-content\">\n                                <h4>Escolha um método de conexão</h4>\n                                <p>📱 Toque em <strong>Conectar um dispositivo</strong> e escaneie o QR Code</p>\n                                <p style=\"margin-top: 8px;\"><strong>OU</strong></p>\n                                <p style=\"margin-top: 8px;\">📱 Toque em <strong>Conectar um dispositivo</strong> e digite o código de pareamento</p>\n                            </div>\n                        </div>\n\n                        <div class=\"step\">\n                            <div class=\"step-number\">4</div>\n                            <div class=\"step-content\">\n                                <h4>Aguarde a Conexão</h4>\n                                <p>Após escanear o QR Code ou inserir o código, aguarde a confirmação da conexão.</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Elementos do DOM\n        const instanceNameInput = document.getElementById('instanceName');\n        const generateBtn = document.getElementById('generateBtn');\n        const loading = document.getElementById('loading');\n        const error = document.getElementById('error');\n        const errorMessage = document.getElementById('errorMessage');\n        const connectionStatus = document.getElementById('connectionStatus');\n        const statusMessage = document.getElementById('statusMessage');\n        const qrDisplay = document.getElementById('qrDisplay');\n        const qrImage = document.getElementById('qrImage');\n        const refreshBtn = document.getElementById('refreshBtn');\n        const timer = document.getElementById('timer');\n        const formSection = document.getElementById('formSection');\n\n        // Variáveis globais\n        let timerInterval;\n        let connectionCheckInterval;\n        let timeLeft = 29;\n        let currentInstanceName = '';\n\n        // Função para gerar sufixo aleatório\n        function generateRandomSuffix() {\n            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n            return Array.from({length: 6}, () => chars[Math.floor(Math.random() * chars.length)]).join('');\n        }\n\n        // Função para mostrar erros\n        function showError(message) {\n            console.log('Mostrando erro:', message);\n            errorMessage.textContent = message;\n            error.classList.add('show');\n            connectionStatus.classList.remove('show');\n            setTimeout(() => {\n                error.classList.remove('show');\n            }, 5000);\n        }\n\n        // Função para mostrar status\n        function showStatus(message) {\n            console.log('Mostrando status:', message);\n            statusMessage.textContent = message;\n            connectionStatus.classList.add('show');\n            error.classList.remove('show');\n        }\n\n        // Função para iniciar timer\n        function startTimer() {\n            timeLeft = 29;\n            timerInterval = setInterval(() => {\n                timer.textContent = `Expira em ${timeLeft} segundos`;\n                timeLeft--;\n                \n                if (timeLeft < 0) {\n                    clearInterval(timerInterval);\n                    timer.textContent = 'QR Code expirado';\n                    timer.style.color = '#ff3b30';\n                }\n            }, 1000);\n        }\n\n        // Função para resetar timer\n        function resetTimer() {\n            if (timerInterval) {\n                clearInterval(timerInterval);\n            }\n            if (connectionCheckInterval) {\n                clearInterval(connectionCheckInterval);\n            }\n            timer.style.color = '#25d366';\n        }\n\n        // Função para verificar estado da conexão\n        async function checkConnectionState() {\n            try {\n                console.log('Verificando estado da conexão para:', currentInstanceName);\n                const response = await fetch(`https://whatsapi.typebot.pro/instance/connectionState/${currentInstanceName}`, {\n                    method: 'GET',\n                    headers: {\n                        'apikey': 'b4d71f9c38e3ac12a6b08e4b6d53aa90'\n                    }\n                });\n\n                const data = await response.json();\n                console.log('Estado da conexão:', data);\n                \n                if (data.instance && data.instance.status === 'open') {\n                    // Conexão estabelecida com sucesso\n                    clearInterval(connectionCheckInterval);\n                    resetTimer();\n                    \n                    // Mostrar mensagem de sucesso\n                    timer.textContent = '✅ Conectado com sucesso!';\n                    timer.style.color = '#34c759';\n                    showStatus('✅ WhatsApp conectado com sucesso! Salvando dados...');\n                    \n                    // Salvar foto do perfil antes de redirecionar\n                    try {\n                        console.log('Salvando foto do perfil...');\n                        const savePhotoResponse = await fetch('https://n8n.typebot.pro/webhook/salvarfoto', {\n                            method: 'POST',\n                            headers: {\n                                'Content-Type': 'application/json'\n                            },\n                            body: JSON.stringify({\n                                instanceName: currentInstanceName\n                            })\n                        });\n\n                        if (!savePhotoResponse.ok) {\n                            console.error('Erro ao salvar foto:', await savePhotoResponse.text());\n                            // Continua mesmo se falhar ao salvar a foto\n                        } else {\n                            console.log('Foto salva com sucesso');\n                        }\n                        \n                    } catch (photoError) {\n                        console.error('Erro na requisição para salvar foto:', photoError);\n                        // Continua mesmo se falhar ao salvar a foto\n                    }\n                    \n                    // Redirecionar após salvar (ou tentar salvar) a foto\n                    showStatus('✅ WhatsApp conectado com sucesso! Redirecionando...');\n                    setTimeout(() => {\n                        // Redirecionar para página de conexões\n                        window.location.href = 'https://n8n.typebot.pro/webhook/conexoes';\n                    }, 1500);\n                }\n            } catch (err) {\n                console.error('Erro ao verificar estado da conexão:', err);\n            }\n        }\n\n        // Função para iniciar verificação de conexão\n        function startConnectionCheck() {\n            console.log('Iniciando verificação de conexão');\n            connectionCheckInterval = setInterval(checkConnectionState, 5000);\n        }\n\n        // Função principal para gerar QR Code\n        async function generateQRCode() {\n            console.log('Iniciando geração de QR Code');\n            \n            const instanceBaseName = instanceNameInput.value.trim();\n            \n            if (!instanceBaseName) {\n                showError('Por favor, digite o nome da conexão');\n                return;\n            }\n\n            console.log('Processando requisição para instância:', instanceBaseName);\n\n            // Reset states\n            error.classList.remove('show');\n            connectionStatus.classList.remove('show');\n            qrDisplay.classList.remove('show');\n            resetTimer();\n\n            // Show loading\n            loading.classList.add('show');\n            generateBtn.disabled = true;\n\n            try {\n                console.log('Fazendo requisição para criar conexão');\n                const response = await fetch('https://n8n.typebot.pro/webhook/criarconexaoback', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        instanceName: instanceBaseName\n                    })\n                });\n\n                console.log('Status da resposta:', response.status);\n                const data = await response.json();\n                console.log('Dados recebidos:', data);\n\n                if (!response.ok) {\n                    throw new Error(data.message || 'Erro ao gerar QR Code');\n                }\n\n                if (data.qrcode && data.instanceName) {\n                    console.log('QR Code recebido, exibindo');\n                    \n                    // Armazenar o nome da instância retornado pela API\n                    currentInstanceName = data.instanceName;\n                    \n                    // Show QR Code\n                    qrImage.src = data.qrcode;\n                    \n                    qrDisplay.classList.add('show');\n                    formSection.style.display = 'none';\n                    startTimer();\n                    startConnectionCheck();\n                    showStatus('QR Code gerado! Escaneie com seu WhatsApp.');\n                } else {\n                    throw new Error('QR Code ou instanceName não foi retornado pela API');\n                }\n\n            } catch (err) {\n                console.error('Erro:', err);\n                showError(err.message || 'Erro ao conectar com a API');\n            } finally {\n                loading.classList.remove('show');\n                generateBtn.disabled = false;\n            }\n        }\n\n        // Função para refresh do QR Code\n        async function refreshQRCode() {\n            console.log('Fazendo refresh do QR Code');\n            \n            if (!currentInstanceName) {\n                showError('Nome da instância não encontrado');\n                return;\n            }\n\n            // Reset states\n            error.classList.remove('show');\n            connectionStatus.classList.remove('show');\n            resetTimer();\n\n            // Show loading\n            loading.classList.add('show');\n            refreshBtn.disabled = true;\n\n            try {\n                console.log('Fazendo requisição para reconectar');\n                const response = await fetch(`https://whatsapi.typebot.pro/instance/connect/${currentInstanceName}`, {\n                    method: 'GET',\n                    headers: {\n                        'apikey': 'b4d71f9c38e3ac12a6b08e4b6d53aa90'\n                    }\n                });\n\n                const data = await response.json();\n                console.log('Dados do refresh:', data);\n\n                if (!response.ok) {\n                    throw new Error(data.message || 'Erro ao gerar novo QR Code');\n                }\n\n                if (data.qrcode && data.qrcode.base64) {\n                    // Update QR Code\n                    qrImage.src = data.qrcode.base64;\n                    startTimer();\n                    startConnectionCheck();\n                    showStatus('Novo QR Code gerado! Escaneie com seu WhatsApp.');\n                } else {\n                    throw new Error('QR Code não foi retornado pela API');\n                }\n\n            } catch (err) {\n                console.error('Erro:', err);\n                showError(err.message || 'Erro ao gerar novo QR Code');\n            } finally {\n                loading.classList.remove('show');\n                refreshBtn.disabled = false;\n            }\n        }\n\n        // Event listeners\n        generateBtn.addEventListener('click', function(e) {\n            e.preventDefault();\n            console.log('Botão clicado');\n            generateQRCode();\n        });\n\n        refreshBtn.addEventListener('click', function(e) {\n            e.preventDefault();\n            console.log('Botão refresh clicado');\n            refreshQRCode();\n        });\n\n        instanceNameInput.addEventListener('keypress', function(e) {\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                generateQRCode();\n            }\n        });\n\n        // Auto focus no input\n        instanceNameInput.focus();\n        \n        console.log('Script carregado com sucesso');\n    </script>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-6528,-1232],"id":"6fe9db5f-b029-4f5b-8096-c6ac5107aec6","name":"HTML"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-6304,-1232],"id":"4d73874a-937a-42a3-8259-0b8d1f95d711","name":"Respond to Webhook1"},{"parameters":{"path":"disparos-individuais","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6768,-672],"id":"1eac0b5e-1821-4216-aceb-c7b0e62f5aca","name":"Webhook","webhookId":"bffe6be0-84a5-4250-8695-636b89e17afd"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Disparos de Mensagens</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            color: white;\n            min-height: 100vh;\n            margin: 0;\n            padding: 0;\n        }\n\n        .app-layout {\n            display: flex;\n            min-height: 100vh;\n        }\n\n        /* Sidebar */\n        .sidebar {\n            width: 70px;\n            background: rgba(0, 0, 0, 0.3);\n            backdrop-filter: blur(10px);\n            border-right: 1px solid rgba(255, 255, 255, 0.1);\n            transition: all 0.3s ease;\n            position: relative;\n            z-index: 1000;\n        }\n\n        .sidebar:hover {\n            width: 250px;\n        }\n\n        .sidebar-header {\n            padding: 20px;\n            text-align: center;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .sidebar-logo {\n            font-size: 1.5rem;\n            font-weight: 600;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n            white-space: nowrap;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .sidebar-logo {\n            opacity: 1;\n        }\n\n        .sidebar-menu {\n            padding: 20px 0;\n        }\n\n        .menu-item {\n            display: flex;\n            align-items: center;\n            padding: 15px 20px;\n            color: #ccc;\n            text-decoration: none;\n            transition: all 0.3s ease;\n            position: relative;\n            white-space: nowrap;\n        }\n\n        .menu-item:hover {\n            background: rgba(37, 211, 102, 0.1);\n            color: #25d366;\n        }\n\n        .menu-item.active {\n            background: rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            border-right: 3px solid #25d366;\n        }\n\n        .menu-icon {\n            font-size: 1.2rem;\n            width: 30px;\n            text-align: center;\n            flex-shrink: 0;\n        }\n\n        .menu-text {\n            margin-left: 15px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .menu-text {\n            opacity: 1;\n        }\n\n        /* Main content */\n        .main-content-wrapper {\n            flex: 1;\n            padding: 20px;\n            overflow-x: auto;\n        }\n\n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n        }\n\n        .header {\n            margin-bottom: 40px;\n        }\n\n        .header-info h1 {\n            font-size: 2.5rem;\n            font-weight: 600;\n            margin-bottom: 10px;\n            color: white;\n        }\n\n        .header-info p {\n            color: #888;\n            font-size: 1.1rem;\n        }\n\n        .main-content {\n            display: grid;\n            grid-template-columns: 1fr 400px;\n            gap: 40px;\n        }\n\n        .form-container {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 16px;\n            padding: 40px;\n            backdrop-filter: blur(10px);\n        }\n\n        .form-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin-bottom: 30px;\n        }\n\n        .form-group {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .form-group.full-width {\n            grid-column: 1 / -1;\n        }\n\n        .form-group label {\n            color: #fff;\n            font-weight: 500;\n            margin-bottom: 8px;\n            font-size: 0.95rem;\n        }\n\n        .form-group input,\n        .form-group textarea {\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            padding: 12px 15px;\n            color: white;\n            font-size: 1rem;\n            outline: none;\n            transition: all 0.3s ease;\n        }\n\n        .form-group input:focus,\n        .form-group textarea:focus {\n            border-color: #25d366;\n            box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.2);\n        }\n\n        .form-group input::placeholder,\n        .form-group textarea::placeholder {\n            color: #888;\n        }\n\n        .form-group textarea {\n            resize: vertical;\n            min-height: 100px;\n        }\n\n        .messages-section {\n            margin-bottom: 30px;\n        }\n\n        .message-item {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 15px;\n        }\n\n        .message-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 15px;\n        }\n\n        .message-title {\n            color: #25d366;\n            font-size: 0.9rem;\n            font-weight: 600;\n        }\n\n        .remove-message {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n            padding: 5px 10px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 0.8rem;\n            transition: all 0.3s ease;\n        }\n\n        .remove-message:hover {\n            background: rgba(255, 59, 48, 0.2);\n        }\n\n        .media-upload {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 10px;\n            margin-top: 15px;\n        }\n\n        .media-preview-section {\n            margin-top: 15px;\n        }\n\n        .media-selected {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            padding: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n\n        .media-info-display {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .media-icon-display {\n            font-size: 1.2rem;\n        }\n\n        .media-name-display {\n            color: #fff;\n            font-weight: 500;\n        }\n\n        .media-size-display {\n            color: #888;\n            font-size: 0.9rem;\n        }\n\n        .remove-media-btn {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n            padding: 5px 8px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 0.9rem;\n            transition: all 0.3s ease;\n        }\n\n        .remove-media-btn:hover {\n            background: rgba(255, 59, 48, 0.2);\n        }\n\n        .media-btn {\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            padding: 12px 8px;\n            color: white;\n            cursor: pointer;\n            text-align: center;\n            font-size: 0.8rem;\n            transition: all 0.3s ease;\n            position: relative;\n        }\n\n        .media-btn:hover {\n            background: rgba(37, 211, 102, 0.1);\n            border-color: #25d366;\n        }\n\n        .media-btn input[type=\"file\"] {\n            position: absolute;\n            opacity: 0;\n            width: 100%;\n            height: 100%;\n            cursor: pointer;\n        }\n\n        .media-btn.active {\n            background: rgba(37, 211, 102, 0.2);\n            border-color: #25d366;\n            color: #25d366;\n        }\n\n        .add-message-btn {\n            width: 100%;\n            padding: 15px;\n            background: rgba(37, 211, 102, 0.1);\n            border: 2px dashed rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            color: #25d366;\n            font-size: 1rem;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            margin-bottom: 20px;\n        }\n\n        .add-message-btn:hover {\n            background: rgba(37, 211, 102, 0.2);\n            border-color: #25d366;\n        }\n\n        .time-range {\n            display: flex;\n            gap: 20px;\n            align-items: center;\n        }\n\n        .time-input {\n            flex: 1;\n        }\n\n        .time-separator {\n            color: #888;\n            font-weight: 500;\n            font-size: 0.9rem;\n            padding: 0 5px;\n        }\n\n        .file-upload {\n            position: relative;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            padding: 30px;\n            border: 2px dashed rgba(255, 255, 255, 0.3);\n            border-radius: 12px;\n            background: rgba(255, 255, 255, 0.02);\n            transition: all 0.3s ease;\n            cursor: pointer;\n        }\n\n        .file-upload:hover {\n            border-color: #25d366;\n            background: rgba(37, 211, 102, 0.05);\n        }\n\n        .file-upload.dragover {\n            border-color: #25d366;\n            background: rgba(37, 211, 102, 0.1);\n        }\n\n        .file-upload input[type=\"file\"] {\n            position: absolute;\n            opacity: 0;\n            width: 100%;\n            height: 100%;\n            cursor: pointer;\n        }\n\n        .file-upload-content {\n            text-align: center;\n            pointer-events: none;\n        }\n\n        .file-upload-icon {\n            font-size: 3rem;\n            color: #25d366;\n            margin-bottom: 15px;\n        }\n\n        .file-upload-text {\n            color: #fff;\n            font-size: 1.1rem;\n            margin-bottom: 5px;\n        }\n\n        .file-upload-hint {\n            color: #888;\n            font-size: 0.9rem;\n        }\n\n        .file-info {\n            display: none;\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            padding: 15px;\n            margin-top: 15px;\n        }\n\n        .file-info.show {\n            display: block;\n        }\n\n        .file-info-content {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n\n        .file-details {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .file-icon {\n            color: #25d366;\n            font-size: 1.2rem;\n        }\n\n        .file-name {\n            color: #fff;\n            font-weight: 500;\n        }\n\n        .contact-count {\n            color: #25d366;\n            font-size: 0.9rem;\n        }\n\n        .remove-file {\n            background: none;\n            border: none;\n            color: #ff3b30;\n            cursor: pointer;\n            font-size: 1.2rem;\n            padding: 5px;\n            border-radius: 4px;\n            transition: all 0.3s ease;\n        }\n\n        .remove-file:hover {\n            background: rgba(255, 59, 48, 0.1);\n        }\n\n        .dispatch-btn {\n            width: 100%;\n            padding: 18px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border: none;\n            border-radius: 12px;\n            color: white;\n            font-size: 1.1rem;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            margin-top: 20px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 10px;\n        }\n\n        .dispatch-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 12px 30px rgba(37, 211, 102, 0.4);\n        }\n\n        .dispatch-btn:disabled {\n            background: #444;\n            cursor: not-allowed;\n            transform: none;\n            box-shadow: none;\n        }\n\n        .loading-connections {\n            text-align: center;\n            padding: 40px 20px;\n            color: #888;\n        }\n\n        .loading-spinner-large {\n            width: 40px;\n            height: 40px;\n            border: 3px solid rgba(37, 211, 102, 0.3);\n            border-top: 3px solid #25d366;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin: 0 auto 15px;\n        }\n\n        .connections-section {\n            margin-bottom: 30px;\n        }\n\n        .connections-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n            gap: 12px;\n            margin-top: 15px;\n        }\n\n        .connection-card {\n            background: rgba(255, 255, 255, 0.03);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 8px;\n            padding: 16px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            position: relative;\n            min-height: 80px;\n        }\n\n        .connection-card:hover {\n            border-color: rgba(37, 211, 102, 0.4);\n            background: rgba(37, 211, 102, 0.05);\n            transform: translateY(-1px);\n        }\n\n        .connection-card.selected {\n            border-color: #25d366;\n            background: rgba(37, 211, 102, 0.1);\n            box-shadow: 0 0 0 1px rgba(37, 211, 102, 0.2);\n        }\n\n        .connection-card.selected::before {\n            content: '✓';\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            background: #25d366;\n            color: white;\n            width: 18px;\n            height: 18px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 0.7rem;\n            font-weight: bold;\n        }\n\n        .connection-header {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            position: relative;\n            padding-right: 30px;\n        }\n\n        .connection-avatar {\n            width: 36px;\n            height: 36px;\n            border-radius: 50%;\n            background: #25d366;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: bold;\n            font-size: 1rem;\n            flex-shrink: 0;\n        }\n\n        .connection-avatar img {\n            width: 100%;\n            height: 100%;\n            border-radius: 50%;\n            object-fit: cover;\n        }\n\n        .connection-info {\n            flex: 1;\n            min-width: 0;\n        }\n\n        .connection-name {\n            color: #fff;\n            font-size: 0.95rem;\n            font-weight: 600;\n            margin-bottom: 4px;\n            line-height: 1.2;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n\n        .connection-phone {\n            color: #888;\n            font-size: 0.8rem;\n            font-weight: 400;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n\n        .connection-status-pill {\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            padding: 2px 8px;\n            border-radius: 10px;\n            font-size: 0.65rem;\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 0.3px;\n            line-height: 1;\n        }\n\n        .connection-status-pill.connected {\n            background: rgba(52, 199, 89, 0.15);\n            color: #34c759;\n            border: 1px solid rgba(52, 199, 89, 0.3);\n        }\n\n        .connection-status-pill.disconnected {\n            background: rgba(255, 59, 48, 0.15);\n            color: #ff3b30;\n            border: 1px solid rgba(255, 59, 48, 0.3);\n        }\n\n        .connections-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin-bottom: 6px;\n        }\n\n        .refresh-connections-btn-small {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            padding: 4px 8px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 0.75rem;\n            transition: all 0.3s ease;\n        }\n\n        .refresh-connections-btn-small:hover {\n            background: rgba(37, 211, 102, 0.2);\n            transform: rotate(180deg);\n        }\n\n        .connections-selected {\n            background: rgba(37, 211, 102, 0.08);\n            border: 1px solid rgba(37, 211, 102, 0.2);\n            border-radius: 6px;\n            padding: 12px;\n            margin-top: 12px;\n            display: none;\n            font-size: 0.9rem;\n        }\n\n        .connections-selected.show {\n            display: block;\n        }\n\n        .no-connections {\n            text-align: center;\n            padding: 40px 20px;\n            color: #888;\n            border: 2px dashed rgba(255, 255, 255, 0.2);\n            border-radius: 12px;\n        }\n\n        .refresh-connections-btn {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            color: #25d366;\n            padding: 8px 12px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 0.9rem;\n            margin-left: 10px;\n            transition: all 0.3s ease;\n        }\n\n        .refresh-connections-btn:hover {\n            background: rgba(37, 211, 102, 0.2);\n            transform: rotate(180deg);\n        }\n\n        .refresh-connections-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        .dispatch-btn.loading .loading-spinner {\n            display: block;\n        }\n\n        .success-message,\n        .error-message {\n            padding: 15px 20px;\n            border-radius: 8px;\n            margin: 20px 0;\n            display: none;\n        }\n\n        .success-message {\n            background: rgba(52, 199, 89, 0.1);\n            border: 1px solid rgba(52, 199, 89, 0.3);\n            color: #34c759;\n        }\n\n        .error-message {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n        }\n\n        .success-message.show,\n        .error-message.show {\n            display: block;\n        }\n\n        .stats {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 20px;\n            margin-top: 30px;\n        }\n\n        .stat-card {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n        }\n\n        .stat-value {\n            font-size: 1.5rem;\n            font-weight: 600;\n            color: #25d366;\n            margin-bottom: 5px;\n        }\n\n        .stat-label {\n            color: #888;\n            font-size: 0.8rem;\n        }\n\n        /* Phone Preview */\n        .phone-preview {\n            position: sticky;\n            top: 20px;\n        }\n\n        .phone-container {\n            width: 350px;\n            height: 700px;\n            background: #000;\n            border-radius: 35px;\n            padding: 20px 15px;\n            position: relative;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n        }\n\n        .phone-screen {\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(135deg, #e5ddd5 0%, #d1c7b8 100%);\n            border-radius: 25px;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .whatsapp-header {\n            background: #075e54;\n            height: 60px;\n            display: flex;\n            align-items: center;\n            padding: 0 16px;\n            gap: 12px;\n        }\n\n        .contact-avatar {\n            width: 40px;\n            height: 40px;\n            background: #25d366;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: bold;\n            font-size: 1.2rem;\n        }\n\n        .contact-info {\n            flex: 1;\n        }\n\n        .contact-name {\n            color: white;\n            font-size: 1rem;\n            font-weight: 500;\n        }\n\n        .contact-status {\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 0.8rem;\n        }\n\n        .chat-area {\n            flex: 1;\n            padding: 20px 16px;\n            overflow-y: auto;\n            height: calc(100% - 60px);\n            display: flex;\n            flex-direction: column;\n        }\n\n        .no-messages {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: #666;\n            font-style: italic;\n            text-align: center;\n        }\n\n        .message-bubble {\n            background: #dcf8c6;\n            border-radius: 8px;\n            padding: 8px 12px;\n            margin-bottom: 15px;\n            max-width: 80%;\n            margin-left: auto;\n            position: relative;\n            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n        }\n\n        .message-bubble:after {\n            content: '';\n            position: absolute;\n            top: 8px;\n            right: -8px;\n            width: 0;\n            height: 0;\n            border-left: 8px solid #dcf8c6;\n            border-top: 8px solid transparent;\n            border-bottom: 8px solid transparent;\n        }\n\n        .message-text {\n            color: #303030;\n            font-size: 0.9rem;\n            line-height: 1.4;\n            word-wrap: break-word;\n        }\n\n        .message-time {\n            color: #667781;\n            font-size: 0.7rem;\n            text-align: right;\n            margin-top: 4px;\n        }\n\n        .media-preview-whatsapp {\n            margin-bottom: 8px;\n            border-radius: 8px;\n            overflow: hidden;\n            max-width: 200px;\n        }\n\n        .image-preview-whatsapp {\n            width: 100%;\n            height: auto;\n            max-height: 150px;\n            object-fit: cover;\n            border-radius: 8px;\n        }\n\n        .video-preview-whatsapp {\n            width: 100%;\n            height: auto;\n            max-height: 150px;\n            border-radius: 8px;\n        }\n\n        .video-overlay {\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin-top: -75px;\n            margin-bottom: 75px;\n            pointer-events: none;\n        }\n\n        .play-button {\n            background: rgba(0, 0, 0, 0.6);\n            color: white;\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 1.2rem;\n        }\n\n        .audio-preview-whatsapp {\n            background: rgba(0, 0, 0, 0.1);\n            padding: 12px;\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin-bottom: 8px;\n            max-width: 250px;\n        }\n\n        .audio-icon {\n            font-size: 1.5rem;\n            color: #075e54;\n        }\n\n        .audio-info {\n            flex: 1;\n        }\n\n        .audio-name {\n            font-size: 0.9rem;\n            font-weight: 500;\n            color: #303030;\n            margin-bottom: 2px;\n        }\n\n        .audio-duration {\n            font-size: 0.8rem;\n            color: #667781;\n        }\n\n        .audio-controls {\n            display: none;\n        }\n\n        .document-preview-whatsapp {\n            background: rgba(0, 0, 0, 0.1);\n            padding: 12px;\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin-bottom: 8px;\n            max-width: 250px;\n            cursor: pointer;\n            transition: background 0.2s ease;\n        }\n\n        .document-preview-whatsapp:hover {\n            background: rgba(0, 0, 0, 0.15);\n        }\n\n        .document-icon {\n            font-size: 1.5rem;\n            color: #075e54;\n        }\n\n        .document-info {\n            flex: 1;\n        }\n\n        .document-name {\n            font-size: 0.9rem;\n            font-weight: 500;\n            color: #303030;\n            margin-bottom: 2px;\n            word-break: break-word;\n        }\n\n        .document-size {\n            font-size: 0.8rem;\n            color: #667781;\n        }\n\n        /* Seleção de dias da semana */\n        .days-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n            gap: 12px;\n            margin-bottom: 15px;\n        }\n\n        .day-item {\n            background: rgba(255, 255, 255, 0.05);\n            border: 2px solid rgba(255, 255, 255, 0.2);\n            border-radius: 12px;\n            padding: 16px 12px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            position: relative;\n            user-select: none;\n        }\n\n        .day-item:hover {\n            border-color: rgba(37, 211, 102, 0.5);\n            background: rgba(37, 211, 102, 0.08);\n        }\n\n        .day-item.selected {\n            border-color: #25d366;\n            background: rgba(37, 211, 102, 0.15);\n            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.2);\n        }\n\n        .day-item.selected::before {\n            content: '✓';\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            background: #25d366;\n            color: white;\n            width: 18px;\n            height: 18px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 0.7rem;\n            font-weight: bold;\n        }\n\n        .day-name {\n            display: block;\n            color: #fff;\n            font-size: 0.9rem;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n        .day-short {\n            display: block;\n            color: #888;\n            font-size: 0.75rem;\n            font-weight: 500;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        .day-item.selected .day-name {\n            color: #25d366;\n        }\n\n        .day-item.selected .day-short {\n            color: #25d366;\n        }\n\n        .days-selected {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            padding: 12px 16px;\n            margin-top: 10px;\n        }\n\n        .selected-days-text {\n            color: #25d366;\n            font-weight: 600;\n            font-size: 0.9rem;\n        }\n\n        @media (max-width: 768px) {\n            .days-grid {\n                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));\n                gap: 8px;\n            }\n            \n            .day-item {\n                padding: 12px 8px;\n            }\n            \n            .day-name {\n                font-size: 0.8rem;\n            }\n            \n            .day-short {\n                font-size: 0.7rem;\n            }\n        }\n\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n\n        /* Loading spinner para botões */\n        .loading-spinner-small {\n            width: 16px;\n            height: 16px;\n            border: 2px solid rgba(37, 211, 102, 0.3);\n            border-top: 2px solid #25d366;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            display: inline-block;\n            margin-left: 8px;\n        }\n\n        @media (max-width: 1200px) {\n            .main-content {\n                grid-template-columns: 1fr;\n                gap: 30px;\n            }\n\n            .phone-preview {\n                position: static;\n                display: flex;\n                justify-content: center;\n            }\n\n            .phone-container {\n                width: 300px;\n                height: 600px;\n            }\n\n            .sidebar {\n                width: 60px;\n            }\n\n            .sidebar:hover {\n                width: 200px;\n            }\n        }\n\n        @media (max-width: 768px) {\n            .form-grid {\n                grid-template-columns: 1fr;\n                gap: 20px;\n            }\n\n            .time-range {\n                flex-direction: column;\n                gap: 10px;\n            }\n\n            .time-separator {\n                display: none;\n            }\n\n            .header-info h1 {\n                font-size: 2rem;\n            }\n\n            .form-container {\n                padding: 25px;\n            }\n\n            .media-upload {\n                grid-template-columns: repeat(2, 1fr);\n            }\n\n            .sidebar {\n                width: 60px;\n            }\n\n            .sidebar:hover {\n                width: 180px;\n            }\n\n            .main-content-wrapper {\n                padding: 15px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"app-layout\">\n        <!-- Main Content -->\n        <div class=\"main-content-wrapper\">\n            <div class=\"container\">\n                <div class=\"header\">\n                    <div class=\"header-info\">\n                        <h1>Disparos de Mensagens</h1>\n                        <p>Configure e envie mensagens personalizadas para seus contatos</p>\n                    </div>\n                </div>\n\n                <div class=\"main-content\">\n                    <div class=\"form-container\">\n                        <form id=\"dispatchForm\">\n                            <div class=\"connections-section\">\n                                <div class=\"connections-header\">\n                                    <label>Conexões disponíveis *</label>\n                                    <button type=\"button\" class=\"refresh-connections-btn-small\" onclick=\"loadConnections()\" title=\"Atualizar conexões\">\n                                        🔄\n                                    </button>\n                                </div>\n                                <p style=\"color: #888; font-size: 0.9rem; margin-bottom: 15px;\">\n                                    Selecione uma ou mais conexões para o disparo. O sistema alternará entre as conexões selecionadas.\n                                </p>\n                                <div id=\"connectionsContainer\">\n                                    <div class=\"loading-connections\">\n                                        <div class=\"loading-spinner-large\"></div>\n                                        <p>Buscando conexões...</p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"messages-section\">\n                                <label>Mensagens a serem enviadas *</label>\n                                <p style=\"color: #888; font-size: 0.9rem; margin-bottom: 15px;\">\n                                    Crie variações de mensagens. O sistema enviará apenas 1 mensagem por contato (escolhida aleatoriamente entre as variações).\n                                </p>\n                                <div id=\"messagesContainer\">\n                                    <!-- Mensagens serão adicionadas aqui dinamicamente -->\n                                </div>\n                                <button type=\"button\" class=\"add-message-btn\" id=\"addMessageBtn\">\n                                    ➕ Adicionar Mensagem\n                                </button>\n                            </div>\n\n                            <div class=\"form-grid\">\n                                <div class=\"form-group\">\n                                    <label for=\"interval\">Intervalo entre mensagens (segundos) *</label>\n                                    <input type=\"number\" id=\"interval\" name=\"interval\" placeholder=\"Ex: 5\" min=\"1\" max=\"300\" value=\"5\" required>\n                                </div>\n\n                                <div class=\"form-group\">\n                                    <label>Horário de envio *</label>\n                                    <div class=\"time-range\">\n                                        <div class=\"time-input\">\n                                            <input type=\"time\" id=\"startTime\" name=\"startTime\" value=\"08:00\" required>\n                                        </div>\n                                        <span class=\"time-separator\">às</span>\n                                        <div class=\"time-input\">\n                                            <input type=\"time\" id=\"endTime\" name=\"endTime\" value=\"18:00\" required>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class=\"form-group full-width\">\n                                    <label>Dias da semana para envio *</label>\n                                    <p style=\"color: #888; font-size: 0.9rem; margin-bottom: 15px;\">\n                                        Selecione os dias da semana em que deseja enviar as mensagens.\n                                    </p>\n                                    <div class=\"days-grid\">\n                                        <div class=\"day-item\" data-day=\"1\" onclick=\"toggleDay(this)\">\n                                            <span class=\"day-name\">Segunda</span>\n                                            <span class=\"day-short\">SEG</span>\n                                        </div>\n                                        <div class=\"day-item\" data-day=\"2\" onclick=\"toggleDay(this)\">\n                                            <span class=\"day-name\">Terça</span>\n                                            <span class=\"day-short\">TER</span>\n                                        </div>\n                                        <div class=\"day-item\" data-day=\"3\" onclick=\"toggleDay(this)\">\n                                            <span class=\"day-name\">Quarta</span>\n                                            <span class=\"day-short\">QUA</span>\n                                        </div>\n                                        <div class=\"day-item\" data-day=\"4\" onclick=\"toggleDay(this)\">\n                                            <span class=\"day-name\">Quinta</span>\n                                            <span class=\"day-short\">QUI</span>\n                                        </div>\n                                        <div class=\"day-item\" data-day=\"5\" onclick=\"toggleDay(this)\">\n                                            <span class=\"day-name\">Sexta</span>\n                                            <span class=\"day-short\">SEX</span>\n                                        </div>\n                                        <div class=\"day-item\" data-day=\"6\" onclick=\"toggleDay(this)\">\n                                            <span class=\"day-name\">Sábado</span>\n                                            <span class=\"day-short\">SAB</span>\n                                        </div>\n                                        <div class=\"day-item\" data-day=\"0\" onclick=\"toggleDay(this)\">\n                                            <span class=\"day-name\">Domingo</span>\n                                            <span class=\"day-short\">DOM</span>\n                                        </div>\n                                    </div>\n                                    <div class=\"days-selected\" id=\"daysSelected\">\n                                        <span class=\"selected-days-text\">Nenhum dia selecionado</span>\n                                    </div>\n                                </div>\n\n                                <div class=\"form-group full-width\">\n                                    <label>Arquivo CSV com contatos *</label>\n                                    <div class=\"file-upload\" id=\"fileUpload\">\n                                        <input type=\"file\" id=\"csvFile\" accept=\".csv\" required>\n                                        <div class=\"file-upload-content\">\n                                            <div class=\"file-upload-icon\">📁</div>\n                                            <div class=\"file-upload-text\">Clique ou arraste um arquivo CSV</div>\n                                            <div class=\"file-upload-hint\">Arquivo CSV com uma coluna de telefones (primeira linha será ignorada)</div>\n                                        </div>\n                                    </div>\n                                    <div class=\"file-info\" id=\"fileInfo\">\n                                        <div class=\"file-info-content\">\n                                            <div class=\"file-details\">\n                                                <span class=\"file-icon\">📄</span>\n                                                <span class=\"file-name\" id=\"fileName\"></span>\n                                                <span class=\"contact-count\" id=\"contactCount\"></span>\n                                            </div>\n                                            <button type=\"button\" class=\"remove-file\" id=\"removeFile\">✕</button>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <button type=\"submit\" class=\"dispatch-btn\" id=\"dispatchBtn\">\n                                <div class=\"loading-spinner\"></div>\n                                <span id=\"btnText\">🚀 Iniciar Disparo</span>\n                            </button>\n                        </form>\n\n                        <div class=\"success-message\" id=\"successMessage\"></div>\n                        <div class=\"error-message\" id=\"errorMessage\"></div>\n\n                        <div class=\"stats\" id=\"stats\" style=\"display: none;\">\n                            <div class=\"stat-card\">\n                                <div class=\"stat-value\" id=\"totalContacts\">0</div>\n                                <div class=\"stat-label\">Total de Contatos</div>\n                            </div>\n                            <div class=\"stat-card\">\n                                <div class=\"stat-value\" id=\"totalMessages\">0</div>\n                                <div class=\"stat-label\">Variações de Mensagem</div>\n                            </div>\n                            <div class=\"stat-card\">\n                                <div class=\"stat-value\" id=\"totalConnections\">0</div>\n                                <div class=\"stat-label\">Conexões Selecionadas</div>\n                            </div>\n                            <div class=\"stat-card\">\n                                <div class=\"stat-value\" id=\"estimatedTime\">0min</div>\n                                <div class=\"stat-label\">Tempo Estimado</div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"phone-preview\">\n                        <div class=\"phone-container\">\n                            <div class=\"phone-screen\">\n                                <div class=\"whatsapp-header\">\n                                    <div class=\"contact-avatar\">C</div>\n                                    <div class=\"contact-info\">\n                                        <div class=\"contact-name\">Contato</div>\n                                        <div class=\"contact-status\">online</div>\n                                    </div>\n                                </div>\n                                <div class=\"chat-area\" id=\"chatArea\">\n                                    <div class=\"no-messages\">\n                                        Digite uma mensagem para ver o preview\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Form elements\n        const form = document.getElementById('dispatchForm');\n        const messagesContainer = document.getElementById('messagesContainer');\n        const addMessageBtn = document.getElementById('addMessageBtn');\n        const fileUpload = document.getElementById('fileUpload');\n        const csvFile = document.getElementById('csvFile');\n        const fileInfo = document.getElementById('fileInfo');\n        const fileName = document.getElementById('fileName');\n        const contactCount = document.getElementById('contactCount');\n        const removeFile = document.getElementById('removeFile');\n        const dispatchBtn = document.getElementById('dispatchBtn');\n        const btnText = document.getElementById('btnText');\n        const successMessage = document.getElementById('successMessage');\n        const errorMessage = document.getElementById('errorMessage');\n        const stats = document.getElementById('stats');\n        const chatArea = document.getElementById('chatArea');\n\n        // Global variables\n        let messages = [];\n        let contacts = [];\n        let connections = [];\n        let selectedConnections = [];\n        let selectedDays = [];\n        let messageCounter = 0;\n\n        // 🗓️ Função para alternar seleção de dias (GLOBAL)\n        function toggleDay(dayElement) {\n            const dayValue = parseInt(dayElement.getAttribute('data-day'));\n            \n            console.log('🗓️ Clicou no dia:', dayValue);\n            \n            if (dayElement.classList.contains('selected')) {\n                // Remove da seleção\n                dayElement.classList.remove('selected');\n                const index = selectedDays.indexOf(dayValue);\n                if (index > -1) {\n                    selectedDays.splice(index, 1);\n                }\n                console.log('❌ Dia removido:', dayValue, 'Lista atual:', selectedDays);\n            } else {\n                // Adiciona à seleção\n                dayElement.classList.add('selected');\n                selectedDays.push(dayValue);\n                console.log('✅ Dia adicionado:', dayValue, 'Lista atual:', selectedDays);\n            }\n            \n            updateSelectedDaysDisplay();\n        }\n\n        // 📊 Atualiza exibição dos dias selecionados\n        function updateSelectedDaysDisplay() {\n            const selectedDaysDiv = document.getElementById('daysSelected');\n            const daysText = document.querySelector('.selected-days-text');\n            \n            if (!daysText) {\n                console.log('⚠️ Elemento selected-days-text não encontrado');\n                return;\n            }\n            \n            if (selectedDays.length === 0) {\n                daysText.textContent = 'Nenhum dia selecionado';\n                return;\n            }\n            \n            const dayNames = {\n                0: 'Domingo',\n                1: 'Segunda',\n                2: 'Terça', \n                3: 'Quarta',\n                4: 'Quinta',\n                5: 'Sexta',\n                6: 'Sábado'\n            };\n            \n            // Ordena os dias (Segunda a Domingo)\n            const sortedDays = [...selectedDays].sort((a, b) => {\n                const order = [1, 2, 3, 4, 5, 6, 0]; // Segunda a Domingo\n                return order.indexOf(a) - order.indexOf(b);\n            });\n            \n            const selectedNames = sortedDays.map(day => dayNames[day]);\n            \n            if (selectedDays.length === 7) {\n                daysText.textContent = 'Todos os dias da semana';\n            } else if (selectedDays.length === 5 && !selectedDays.includes(0) && !selectedDays.includes(6)) {\n                daysText.textContent = 'Dias úteis (Segunda a Sexta)';\n            } else if (selectedDays.length === 2 && selectedDays.includes(0) && selectedDays.includes(6)) {\n                daysText.textContent = 'Finais de semana';\n            } else {\n                daysText.textContent = selectedNames.join(', ');\n            }\n            \n            console.log('📊 Texto atualizado:', daysText.textContent);\n        }\n\n        // Initialize page\n        console.log('🚀 Iniciando inicialização da página...');\n        \n        // Aguarda o DOM estar pronto antes de inicializar\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', init);\n        } else {\n            init();\n        }\n\n        async function init() {\n            console.log('🚀 Função init() chamada');\n            \n            try {\n                // Aguarda o DOM estar totalmente carregado\n                console.log('⏳ Aguardando DOM...');\n                await new Promise(resolve => {\n                    if (document.readyState === 'loading') {\n                        document.addEventListener('DOMContentLoaded', resolve);\n                    } else {\n                        resolve();\n                    }\n                });\n                console.log('✅ DOM carregado');\n                \n                // Load connections first\n                console.log('📡 Chamando loadConnections()...');\n                await loadConnections();\n                console.log('✅ loadConnections() finalizada');\n                \n                // Initialize with one message\n                console.log('📝 Adicionando primeira mensagem...');\n                addMessage();\n                console.log('✅ Inicialização completa');\n            } catch (error) {\n                console.error('❌ Erro na inicialização:', error);\n            }\n        }\n\n        // 🔗 Função para carregar conexões\n        async function loadConnections() {\n            console.log('📡 === INÍCIO loadConnections() ===');\n            \n            // Mostra loading\n            const container = document.getElementById('connectionsContainer');\n            if (!container) {\n                console.error('❌ Container connectionsContainer não encontrado!');\n                return;\n            }\n            \n            console.log('🔄 Definindo HTML de loading...');\n            container.innerHTML = `\n                <div class=\"loading-connections\">\n                    <div class=\"loading-spinner-large\"></div>\n                    <p>Buscando conexões...</p>\n                </div>\n            `;\n            \n            // Desabilita botão de refresh\n            const refreshBtn = document.querySelector('.refresh-connections-btn');\n            if (refreshBtn) {\n                refreshBtn.disabled = true;\n                console.log('🔄 Botão refresh desabilitado');\n            } else {\n                console.log('⚠️ Botão refresh não encontrado ainda');\n            }\n            \n            updateConnectionStatus('Carregando conexões...');\n            \n            try {\n                console.log('📡 Fazendo fetch para:', 'https://n8n.typebot.pro/webhook/listarconexoes');\n                \n                // Faz requisição para listar conexões\n                const response = await fetch('https://n8n.typebot.pro/webhook/listarconexoes', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({})\n                });\n\n                console.log('📡 Resposta recebida - Status:', response.status);\n                console.log('📡 Resposta recebida - OK:', response.ok);\n\n                if (!response.ok) {\n                    const errorText = await response.text();\n                    console.error('❌ Erro na resposta:', errorText);\n                    throw new Error(`Erro na requisição: ${response.status} - ${errorText}`);\n                }\n\n                const data = await response.json();\n                console.log('✅ Dados recebidos (RAW):', data);\n                console.log('✅ Tipo dos dados:', typeof data);\n                console.log('✅ É array?', Array.isArray(data));\n\n                // Reset das conexões selecionadas\n                selectedConnections = [];\n\n                // Processa as conexões - estrutura corrigida baseada nos logs\n                console.log('🔍 Verificando estrutura dos dados...');\n                \n                let rawConnections = [];\n                \n                if (data && data.Conexoes && Array.isArray(data.Conexoes)) {\n                    // Estrutura: { Conexoes: [...] }\n                    rawConnections = data.Conexoes;\n                    console.log('✅ Estrutura tipo 1: data.Conexoes encontrada');\n                } else if (data && Array.isArray(data) && data.length > 0 && data[0].Conexoes && Array.isArray(data[0].Conexoes)) {\n                    // Estrutura: [{ Conexoes: [...] }]\n                    rawConnections = data[0].Conexoes;\n                    console.log('✅ Estrutura tipo 2: data[0].Conexoes encontrada');\n                } else if (Array.isArray(data)) {\n                    // Estrutura: [...]\n                    rawConnections = data;\n                    console.log('✅ Estrutura tipo 3: array direto encontrada');\n                } else {\n                    console.log('⚠️ Estrutura não reconhecida:', data);\n                    rawConnections = [];\n                }\n\n                console.log('📊 Conexões brutas encontradas:', rawConnections.length);\n\n                // 🔴 VALIDAÇÃO ROBUSTA - Filtra apenas conexões válidas\n                connections = rawConnections.filter(connection => {\n                    // Verifica se é um objeto válido\n                    if (!connection || typeof connection !== 'object') {\n                        console.log('❌ Conexão inválida (não é objeto):', connection);\n                        return false;\n                    }\n\n                    // Verifica se tem propriedades essenciais\n                    const hasValidName = connection.NomeConexao || connection.nomeConexao || connection.name;\n                    const hasValidInstance = connection.instanceName || connection.instance_name;\n                    const hasValidId = connection.id !== undefined && connection.id !== null;\n\n                    if (!hasValidName || !hasValidInstance || !hasValidId) {\n                        console.log('❌ Conexão sem propriedades essenciais:', {\n                            id: connection.id,\n                            name: hasValidName,\n                            instance: hasValidInstance,\n                            connection: connection\n                        });\n                        return false;\n                    }\n\n                    console.log('✅ Conexão válida encontrada:', {\n                        id: connection.id,\n                        name: connection.NomeConexao || connection.nomeConexao || connection.name,\n                        instance: connection.instanceName || connection.instance_name\n                    });\n\n                    return true;\n                });\n\n                console.log(`✅ Conexões válidas filtradas: ${connections.length} de ${rawConnections.length} conexões`);\n\n                if (connections.length > 0) {\n                    console.log('✅ Primeira conexão válida processada:', connections[0]);\n                    \n                    // Verifica status de cada conexão\n                    console.log('🔍 Verificando status das conexões...');\n                    await checkConnectionsStatus();\n                    \n                    renderConnections();\n                    updateConnectionStatus(`${connections.length} conexões encontradas`);\n                } else {\n                    console.log('⚠️ Nenhuma conexão válida encontrada após filtragem');\n                    renderNoConnections();\n                    updateConnectionStatus('Nenhuma conexão válida encontrada');\n                }\n\n            } catch (error) {\n                console.error('❌ ERRO COMPLETO:', error);\n                console.error('❌ Stack trace:', error.stack);\n                showError(`Erro ao carregar conexões: ${error.message}`);\n                renderConnectionError();\n                updateConnectionStatus('Erro ao carregar conexões');\n            } finally {\n                // Reabilita botão de refresh\n                const refreshBtn = document.querySelector('.refresh-connections-btn');\n                if (refreshBtn) {\n                    refreshBtn.disabled = false;\n                    console.log('🔄 Botão refresh reabilitado');\n                }\n                console.log('📡 === FIM loadConnections() ===');\n            }\n        }\n\n        // 🔍 Verifica status de conexão de todas as instâncias com validação robusta\n        async function checkConnectionsStatus() {\n            console.log('🔍 === INÍCIO verificação de status ===');\n            \n            const baseUrl = 'https://whatsapi.typebot.pro';\n            const apiKey = 'b4d71f9c38e3ac12a6b08e4b6d53aa90';\n            \n            const promises = connections.map(async (connection, index) => {\n                try {\n                    // 🔴 VALIDAÇÃO ROBUSTA - Verifica se tem instanceName válido\n                    const instanceName = connection.instanceName || connection.instance_name;\n                    const connectionName = connection.NomeConexao || connection.nomeConexao || connection.name || `Conexão ${index + 1}`;\n                    \n                    if (!instanceName || typeof instanceName !== 'string' || instanceName.trim() === '') {\n                        console.log(`⚠️ Conexão ${connectionName} sem instanceName válido:`, instanceName);\n                        connection.connectionStatus = null;\n                        connection.isConnected = false;\n                        return;\n                    }\n                    \n                    console.log(`🔍 Verificando status da conexão ${index + 1}/${connections.length}: ${connectionName} (${instanceName})`);\n                    \n                    const response = await fetch(`${baseUrl}/instance/connectionState/${instanceName}`, {\n                        method: 'GET',\n                        headers: {\n                            'apikey': apiKey\n                        }\n                    });\n                    \n                    console.log(`📡 Status resposta para ${connectionName}:`, response.status);\n                    \n                    if (response.ok) {\n                        const statusData = await response.json();\n                        console.log(`✅ Status data para ${connectionName}:`, statusData);\n                        \n                        // Atualiza o status da conexão baseado na resposta\n                        connection.connectionStatus = statusData;\n                        \n                        // 🔴 VALIDAÇÃO ROBUSTA - Verifica múltiplos caminhos para o estado\n                        let actualState = null;\n                        \n                        if (statusData && typeof statusData === 'object') {\n                            // Tenta diferentes caminhos para encontrar o estado\n                            actualState = statusData.instance?.state || \n                                         statusData.state || \n                                         statusData.status || \n                                         statusData.connectionState;\n                        }\n                        \n                        connection.isConnected = actualState === 'open' || actualState === 'connected';\n                        \n                        console.log(`📊 Status interpretado para ${connectionName}:`, {\n                            fullResponse: statusData,\n                            instanceState: statusData?.instance?.state,\n                            directState: statusData?.state,\n                            actualState: actualState,\n                            isConnected: connection.isConnected\n                        });\n                        \n                    } else {\n                        console.log(`❌ Erro ao verificar ${connectionName}: ${response.status}`);\n                        connection.connectionStatus = null;\n                        connection.isConnected = false;\n                    }\n                    \n                } catch (error) {\n                    const connectionName = connection?.NomeConexao || connection?.nomeConexao || connection?.name || 'Conexão desconhecida';\n                    console.error(`❌ Erro na verificação de ${connectionName}:`, error);\n                    connection.connectionStatus = null;\n                    connection.isConnected = false;\n                }\n            });\n            \n            // Aguarda todas as verificações\n            await Promise.all(promises);\n            console.log('✅ Verificação de status concluída para todas as conexões');\n            console.log('🔍 === FIM verificação de status ===');\n        }\n\n        // 🎨 Renderiza as conexões com validação robusta\n        function renderConnections() {\n            const container = document.getElementById('connectionsContainer');\n            \n            if (connections.length === 0) {\n                renderNoConnections();\n                return;\n            }\n\n            let html = '<div class=\"connections-grid\">';\n            \n            connections.forEach(connection => {\n                // 🔴 VALIDAÇÃO ROBUSTA - Múltiplos fallbacks para propriedades\n                \n                // Nome da conexão com fallbacks\n                const connectionName = connection.NomeConexao || connection.nomeConexao || connection.name || 'Conexão sem nome';\n                \n                // Avatar com validação segura\n                let avatar;\n                if (connection.FotoPerfil && typeof connection.FotoPerfil === 'string') {\n                    avatar = `<img src=\"${connection.FotoPerfil}\" alt=\"${connectionName}\">`;\n                } else if (connectionName && typeof connectionName === 'string' && connectionName.length > 0) {\n                    avatar = connectionName.charAt(0).toUpperCase();\n                } else {\n                    avatar = '?'; // Fallback final\n                }\n                \n                // Telefone com fallback seguro\n                const phoneDisplay = connection.Telefone || connection.telefone || connection.phone || 'Indisponível';\n                \n                // Instance name com fallback\n                const instanceName = connection.instanceName || connection.instance_name || 'unknown';\n                \n                // ID com validação\n                const connectionId = connection.id !== undefined && connection.id !== null ? connection.id : 'unknown';\n                \n                // Status com validação robusta\n                let statusIcon, statusClass;\n                \n                console.log(`🔍 Determinando status para ${connectionName}:`, {\n                    isConnected: connection.isConnected,\n                    hasApikey: !!connection.Apikey,\n                    connectionStatus: connection.connectionStatus\n                });\n                \n                if (connection.isConnected === true) {\n                    statusIcon = '✓';\n                    statusClass = 'connected';\n                } else if (connection.isConnected === false) {\n                    statusIcon = '✗';\n                    statusClass = 'disconnected';\n                } else {\n                    // Fallback para o método antigo (Apikey)\n                    const hasApikey = connection.Apikey && typeof connection.Apikey === 'string' && connection.Apikey.length > 0;\n                    statusIcon = hasApikey ? '✓' : '✗';\n                    statusClass = hasApikey ? 'connected' : 'disconnected';\n                    console.log(`🔄 Usando fallback para ${connectionName}: ${statusClass}`);\n                }\n\n                // Só renderiza se tiver dados mínimos válidos\n                if (connectionId !== 'unknown' && connectionName !== 'Conexão sem nome') {\n                    html += `\n                        <div class=\"connection-card\" onclick=\"toggleConnection(${connectionId})\" data-connection-id=\"${connectionId}\">\n                            <div class=\"connection-header\">\n                                <div class=\"connection-avatar\">\n                                    ${avatar}\n                                </div>\n                                <div class=\"connection-info\">\n                                    <div class=\"connection-name\">${connectionName}</div>\n                                    <div class=\"connection-phone\">${phoneDisplay}</div>\n                                </div>\n                                <div class=\"connection-status-pill ${statusClass}\">${statusIcon}</div>\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    console.log('⚠️ Conexão pulada por dados insuficientes:', {\n                        id: connectionId,\n                        name: connectionName,\n                        connection: connection\n                    });\n                }\n            });\n\n            html += '</div>';\n            html += `\n                <div class=\"connections-selected\" id=\"connectionsSelected\">\n                    <div class=\"selected-count\" id=\"selectedCount\">0 conexões selecionadas</div>\n                </div>\n            `;\n\n            // Verifica se alguma conexão foi realmente renderizada\n            const validConnectionsCount = html.split('connection-card').length - 1;\n            \n            if (validConnectionsCount === 0) {\n                console.log('⚠️ Nenhuma conexão válida para renderizar');\n                renderNoConnections();\n                return;\n            }\n\n            container.innerHTML = html;\n            console.log(`✅ ${validConnectionsCount} conexões renderizadas com sucesso`);\n        }\n\n        // 🚫 Renderiza quando não há conexões\n        function renderNoConnections() {\n            const container = document.getElementById('connectionsContainer');\n            container.innerHTML = `\n                <div class=\"no-connections\">\n                    <h3>❌ Nenhuma conexão encontrada</h3>\n                    <p>Você não possui conexões configuradas no sistema.</p>\n                    <p>É necessário ter pelo menos uma conexão ativa para fazer disparos individuais.</p>\n                    <br>\n                    <button type=\"button\" class=\"add-message-btn\" onclick=\"window.location.href='https://n8n.typebot.pro/webhook/conectar'\">\n                        🔗 Criar Nova Conexão\n                    </button>\n                </div>\n            `;\n        }\n\n        // ⚠️ Renderiza erro de conexão\n        function renderConnectionError() {\n            const container = document.getElementById('connectionsContainer');\n            container.innerHTML = `\n                <div class=\"no-connections\">\n                    <h3>Erro ao carregar conexões</h3>\n                    <p>Não foi possível carregar suas conexões. Tente novamente.</p>\n                    <br>\n                    <button type=\"button\" class=\"add-message-btn\" onclick=\"loadConnections()\">\n                        🔄 Tentar Novamente\n                    </button>\n                </div>\n            `;\n        }\n\n        // 🔄 Alterna seleção de conexão\n        function toggleConnection(connectionId) {\n            const card = document.querySelector(`[data-connection-id=\"${connectionId}\"]`);\n            const index = selectedConnections.indexOf(connectionId);\n            \n            if (index === -1) {\n                // Adiciona à seleção\n                selectedConnections.push(connectionId);\n                card.classList.add('selected');\n            } else {\n                // Remove da seleção\n                selectedConnections.splice(index, 1);\n                card.classList.remove('selected');\n            }\n            \n            updateSelectedCount();\n            updateStats();\n        }\n\n        // 📊 Atualiza contador de selecionadas\n        function updateSelectedCount() {\n            const selectedDiv = document.getElementById('connectionsSelected');\n            const countDiv = document.getElementById('selectedCount');\n            \n            if (selectedConnections.length > 0) {\n                selectedDiv.classList.add('show');\n                countDiv.textContent = `${selectedConnections.length} conexão${selectedConnections.length !== 1 ? 'ões' : ''} selecionada${selectedConnections.length !== 1 ? 's' : ''}`;\n            } else {\n                selectedDiv.classList.remove('show');\n            }\n        }\n\n        // 🔄 Atualiza status das conexões\n        function updateConnectionStatus(status) {\n            // Status agora é mostrado apenas nos logs, não na interface\n            console.log('📊 Status das conexões:', status);\n        }\n\n        // Event listeners\n        addMessageBtn.addEventListener('click', addMessage);\n        csvFile.addEventListener('change', handleFileUpload);\n        removeFile.addEventListener('click', removeFileHandler);\n        form.addEventListener('submit', handleSubmit);\n\n        // Drag and drop functionality\n        fileUpload.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            fileUpload.classList.add('dragover');\n        });\n\n        fileUpload.addEventListener('dragleave', () => {\n            fileUpload.classList.remove('dragover');\n        });\n\n        fileUpload.addEventListener('drop', (e) => {\n            e.preventDefault();\n            fileUpload.classList.remove('dragover');\n            const files = e.dataTransfer.files;\n            if (files.length > 0 && files[0].type === 'text/csv') {\n                csvFile.files = files;\n                handleFileUpload();\n            }\n        });\n\n        // Functions\n        function addMessage() {\n            messageCounter++;\n            const messageDiv = document.createElement('div');\n            messageDiv.className = 'message-item';\n            messageDiv.innerHTML = `\n                <div class=\"message-header\">\n                    <span class=\"message-title\">Mensagem ${messageCounter}</span>\n                    <button type=\"button\" class=\"remove-message\" onclick=\"removeMessage(this)\">\n                        Remover\n                    </button>\n                </div>\n                <div class=\"form-group\">\n                    <label>Texto da mensagem *</label>\n                    <textarea name=\"message\" placeholder=\"Digite sua mensagem aqui...\" required oninput=\"updatePreview()\"></textarea>\n                </div>\n                <div class=\"media-upload\">\n                    <div class=\"media-btn\" onclick=\"selectMedia(this, 'image')\">\n                        <input type=\"file\" accept=\"image/*\" onchange=\"handleMediaUpload(this, 'image')\">\n                        📷 Imagem\n                    </div>\n                    <div class=\"media-btn\" onclick=\"selectMedia(this, 'video')\">\n                        <input type=\"file\" accept=\"video/*\" onchange=\"handleMediaUpload(this, 'video')\">\n                        🎥 Vídeo\n                    </div>\n                    <div class=\"media-btn\" onclick=\"selectMedia(this, 'audio')\">\n                        <input type=\"file\" accept=\"audio/*\" onchange=\"handleMediaUpload(this, 'audio')\">\n                        🎵 Áudio\n                    </div>\n                    <div class=\"media-btn\" onclick=\"selectMedia(this, 'document')\">\n                        <input type=\"file\" accept=\".pdf,.doc,.docx,.txt\" onchange=\"handleMediaUpload(this, 'document')\">\n                        📄 Documento\n                    </div>\n                </div>\n                <div class=\"media-preview-section\"></div>\n            `;\n            messagesContainer.appendChild(messageDiv);\n            updateStats();\n            updatePreview();\n        }\n\n        function removeMessage(button) {\n            if (messagesContainer.children.length > 1) {\n                button.closest('.message-item').remove();\n                updateStats();\n                updatePreview();\n            } else {\n                showError('Deve haver pelo menos uma mensagem.');\n            }\n        }\n\n        function selectMedia(button, type) {\n            const input = button.querySelector('input[type=\"file\"]');\n            input.click();\n        }\n\n        function handleMediaUpload(input, type) {\n            const file = input.files[0];\n            if (!file) return;\n\n            const messageItem = input.closest('.message-item');\n            const previewSection = messageItem.querySelector('.media-preview-section');\n            const mediaBtn = input.closest('.media-btn');\n\n            // Clear previous media\n            previewSection.innerHTML = '';\n            messageItem.querySelectorAll('.media-btn').forEach(btn => btn.classList.remove('active'));\n\n            // Mark button as active\n            mediaBtn.classList.add('active');\n\n            // Show media info\n            const mediaInfo = document.createElement('div');\n            mediaInfo.className = 'media-selected';\n            \n            let icon;\n            switch(type) {\n                case 'image': icon = '📷'; break;\n                case 'video': icon = '🎥'; break;\n                case 'audio': icon = '🎵'; break;\n                case 'document': icon = '📄'; break;\n            }\n\n            mediaInfo.innerHTML = `\n                <div class=\"media-info-display\">\n                    <span class=\"media-icon-display\">${icon}</span>\n                    <div>\n                        <div class=\"media-name-display\">${file.name}</div>\n                        <div class=\"media-size-display\">${formatFileSize(file.size)}</div>\n                    </div>\n                </div>\n                <button type=\"button\" class=\"remove-media-btn\" onclick=\"removeMedia(this)\">✕</button>\n            `;\n\n            previewSection.appendChild(mediaInfo);\n            updatePreview();\n        }\n\n        function removeMedia(button) {\n            const messageItem = button.closest('.message-item');\n            const previewSection = messageItem.querySelector('.media-preview-section');\n            previewSection.innerHTML = '';\n            messageItem.querySelectorAll('.media-btn').forEach(btn => btn.classList.remove('active'));\n            messageItem.querySelectorAll('input[type=\"file\"]').forEach(input => input.value = '');\n            updatePreview();\n        }\n\n        function formatFileSize(bytes) {\n            if (bytes === 0) return '0 Bytes';\n            const k = 1024;\n            const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n            const i = Math.floor(Math.log(bytes) / Math.log(k));\n            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n        }\n\n        function handleFileUpload() {\n            const file = csvFile.files[0];\n            if (!file) return;\n\n            const reader = new FileReader();\n            reader.onload = function(e) {\n                try {\n                    const csv = e.target.result;\n                    const lines = csv.split('\\n').filter(line => line.trim());\n                    \n                    // Skip header row\n                    const phoneNumbers = lines.slice(1).map(line => {\n                        const phone = line.split(',')[0].trim();\n                        return phone.replace(/[^\\d]/g, ''); // Remove non-digits\n                    }).filter(phone => phone.length >= 10); // Basic validation\n\n                    contacts = phoneNumbers;\n                    \n                    fileName.textContent = file.name;\n                    contactCount.textContent = `${contacts.length} contatos`;\n                    fileInfo.classList.add('show');\n                    \n                    updateStats();\n                    showSuccess(`Arquivo carregado com sucesso! ${contacts.length} contatos encontrados.`);\n                } catch (error) {\n                    showError('Erro ao processar arquivo CSV. Verifique o formato.');\n                }\n            };\n            reader.readAsText(file);\n        }\n\n        function removeFileHandler() {\n            csvFile.value = '';\n            contacts = [];\n            fileInfo.classList.remove('show');\n            updateStats();\n        }\n\n        function updatePreview() {\n            const messageItems = messagesContainer.querySelectorAll('.message-item');\n            const chatArea = document.getElementById('chatArea');\n            \n            // Clear previous messages\n            chatArea.innerHTML = '';\n\n            if (messageItems.length === 0) {\n                chatArea.innerHTML = '<div class=\"no-messages\">Digite uma mensagem para ver o preview</div>';\n                return;\n            }\n\n            // Show preview of each message variation\n            messageItems.forEach((item, index) => {\n                const textarea = item.querySelector('textarea');\n                const text = textarea.value.trim();\n                const mediaInputs = item.querySelectorAll('input[type=\"file\"]');\n                \n                // Encontra mídia selecionada\n                let selectedMedia = null;\n                for (let input of mediaInputs) {\n                    if (input.files.length > 0) {\n                        const parentBtn = input.closest('.media-btn');\n                        if (parentBtn.classList.contains('active')) {\n                            const file = input.files[0];\n                            let mediaType = null;\n                            \n                            if (parentBtn.textContent.includes('Imagem')) mediaType = 'image';\n                            else if (parentBtn.textContent.includes('Vídeo')) mediaType = 'video';\n                            else if (parentBtn.textContent.includes('Áudio')) mediaType = 'audio';\n                            else if (parentBtn.textContent.includes('Documento')) mediaType = 'document';\n                            \n                            selectedMedia = { file, type: mediaType };\n                            break;\n                        }\n                    }\n                }\n\n                if (text || selectedMedia) {\n                    const messageDiv = document.createElement('div');\n                    messageDiv.className = 'message-bubble';\n                    \n                    let content = '';\n                    \n                    // Add media preview\n                    if (selectedMedia) {\n                        content += createMediaPreview(selectedMedia);\n                    }\n                    \n                    // Add text content\n                    if (text) {\n                        content += `<div class=\"message-text\">${text}</div>`;\n                    }\n                    \n                    content += `<div class=\"message-time\">${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</div>`;\n                    \n                    messageDiv.innerHTML = content;\n                    chatArea.appendChild(messageDiv);\n                }\n            });\n\n            if (chatArea.children.length === 0) {\n                chatArea.innerHTML = '<div class=\"no-messages\">Digite uma mensagem para ver o preview</div>';\n            }\n        }\n\n        function createMediaPreview(media) {\n            const { file, type } = media;\n            const fileName = file.name;\n            const fileSize = formatFileSize(file.size);\n            \n            switch (type) {\n                case 'image':\n                    const imageUrl = URL.createObjectURL(file);\n                    return `\n                        <div class=\"media-preview-whatsapp\">\n                            <img src=\"${imageUrl}\" alt=\"${fileName}\" class=\"image-preview-whatsapp\" onload=\"URL.revokeObjectURL(this.src)\">\n                        </div>\n                    `;\n                    \n                case 'video':\n                    const videoUrl = URL.createObjectURL(file);\n                    return `\n                        <div class=\"media-preview-whatsapp\">\n                            <video class=\"video-preview-whatsapp\" controls>\n                                <source src=\"${videoUrl}\" type=\"${file.type}\">\n                            </video>\n                            <div class=\"video-overlay\">\n                                <div class=\"play-button\">▶</div>\n                            </div>\n                        </div>\n                    `;\n                    \n                case 'audio':\n                    const audioUrl = URL.createObjectURL(file);\n                    return `\n                        <div class=\"audio-preview-whatsapp\">\n                            <div class=\"audio-icon\">🎵</div>\n                            <div class=\"audio-info\">\n                                <div class=\"audio-name\">${fileName}</div>\n                                <div class=\"audio-duration\">${fileSize}</div>\n                            </div>\n                            <audio controls class=\"audio-controls\">\n                                <source src=\"${audioUrl}\" type=\"${file.type}\">\n                            </audio>\n                        </div>\n                    `;\n                    \n                case 'document':\n                    return `\n                        <div class=\"document-preview-whatsapp\">\n                            <div class=\"document-icon\">📎</div>\n                            <div class=\"document-info\">\n                                <div class=\"document-name\">${fileName}</div>\n                                <div class=\"document-size\">${fileSize}</div>\n                            </div>\n                        </div>\n                    `;\n                    \n                default:\n                    return '';\n            }\n        }\n\n                function updateStats() {\n            const messageCount = messagesContainer.children.length;\n            const contactsCount = contacts.length;\n            const connectionsCount = selectedConnections.length;\n            const interval = parseInt(document.getElementById('interval').value) || 5;\n            \n            // Update stats\n            document.getElementById('totalMessages').textContent = messageCount;\n            document.getElementById('totalContacts').textContent = contactsCount;\n            document.getElementById('totalConnections').textContent = connectionsCount;\n            \n            // Calculate estimated time\n            const totalSeconds = contactsCount * interval;\n            const minutes = Math.ceil(totalSeconds / 60);\n            document.getElementById('estimatedTime').textContent = `${minutes}min`;\n            \n            // Show stats if there are contacts or messages\n            stats.style.display = (contactsCount > 0 || messageCount > 0 || connectionsCount > 0) ? 'grid' : 'none';\n        }\n\n        function showSuccess(message) {\n            successMessage.textContent = message;\n            successMessage.classList.add('show');\n            errorMessage.classList.remove('show');\n            setTimeout(() => {\n                successMessage.classList.remove('show');\n            }, 5000);\n        }\n\n        function showError(message) {\n            errorMessage.textContent = message;\n            errorMessage.classList.add('show');\n            successMessage.classList.remove('show');\n            setTimeout(() => {\n                errorMessage.classList.remove('show');\n            }, 5000);\n        }\n\n        async function handleSubmit(e) {\n            e.preventDefault();\n            \n            // Validate form\n            if (selectedConnections.length === 0) {\n                showError('Selecione pelo menos uma conexão.');\n                return;\n            }\n            \n            if (messagesContainer.children.length === 0) {\n                showError('Adicione pelo menos uma mensagem.');\n                return;\n            }\n            \n            if (contacts.length === 0) {\n                showError('Carregue um arquivo CSV com contatos.');\n                return;\n            }\n            \n            if (selectedDays.length === 0) {\n                showError('Selecione pelo menos um dia da semana.');\n                return;\n            }\n            \n            // Collect messages\n            const messageItems = messagesContainer.querySelectorAll('.message-item');\n            messages = Array.from(messageItems).map(item => {\n                const text = item.querySelector('textarea').value.trim();\n                const mediaInput = Array.from(item.querySelectorAll('input[type=\"file\"]')).find(input => input.files.length > 0 && input.closest('.media-btn').classList.contains('active'));\n                let media = null;\n                \n                if (mediaInput) {\n                    const file = mediaInput.files[0];\n                    let mediaType = null;\n                    if (mediaInput.closest('.media-btn').textContent.includes('Imagem')) mediaType = 'image';\n                    else if (mediaInput.closest('.media-btn').textContent.includes('Vídeo')) mediaType = 'video';\n                    else if (mediaInput.closest('.media-btn').textContent.includes('Áudio')) mediaType = 'audio';\n                    else if (mediaInput.closest('.media-btn').textContent.includes('Documento')) mediaType = 'document';\n                    \n                    media = { file, type: mediaType };\n                }\n                \n                return { text, media };\n            });\n            \n            // Collect form data\n            const interval = parseInt(document.getElementById('interval').value) || 5;\n            const startTime = document.getElementById('startTime').value;\n            const endTime = document.getElementById('endTime').value;\n            \n            // Disable button and show loading\n            dispatchBtn.disabled = true;\n            btnText.textContent = 'Enviando...';\n            dispatchBtn.querySelector('.loading-spinner').style.display = 'block';\n            \n            try {\n                // Prepare payload\n                const payload = {\n                    connections: selectedConnections,\n                    messages,\n                    contacts,\n                    interval,\n                    startTime,\n                    endTime,\n                    days: selectedDays\n                };\n                \n                console.log('📡 Enviando payload:', payload);\n                \n                // Send to API\n                const response = await fetch('https://n8n.typebot.pro/webhook/db56b0fb-cc58-4d51-8755-d7e04ccaa120', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify(payload)\n                });\n                \n                if (!response.ok) {\n                    throw new Error(`Erro na requisição: ${response.status}`);\n                }\n                \n                const result = await response.json();\n                console.log('✅ Resposta da API:', result);\n                \n                showSuccess('Disparo iniciado com sucesso!');\n                \n                // Reset form\n                form.reset();\n                messagesContainer.innerHTML = '';\n                fileInfo.classList.remove('show');\n                contacts = [];\n                selectedConnections = [];\n                selectedDays = [];\n                document.querySelectorAll('.connection-card').forEach(card => card.classList.remove('selected'));\n                document.querySelectorAll('.day-item').forEach(day => day.classList.remove('selected'));\n                updateSelectedDaysDisplay();\n                updateSelectedCount();\n                updateStats();\n                addMessage();\n                \n            } catch (error) {\n                console.error('❌ Erro ao iniciar disparo:', error);\n                showError(`Erro ao iniciar disparo: ${error.message}`);\n            } finally {\n                dispatchBtn.disabled = false;\n                btnText.textContent = '🚀 Iniciar Disparo';\n                dispatchBtn.querySelector('.loading-spinner').style.display = 'none';\n            }\n        }\n\n        // Initialize with one message\n        addMessage();\n    </script>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-6544,-672],"id":"6eb89c1a-8b07-4fce-ae36-0175e89571e9","name":"HTML1"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-6320,-672],"id":"25601a6c-eba8-490e-a1f3-6ffb573a2da7","name":"Respond to Webhook"},{"parameters":{"path":"conectar","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6752,-1232],"id":"710007ea-c773-43ff-a2b9-25a36cd1e4b0","name":"CRIAR CONEXAO","webhookId":"bffe6be0-84a5-4250-8695-636b89e17afd"},{"parameters":{"content":"## Criar conexão","height":260,"width":760,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-6832,-1328],"typeVersion":1,"id":"a4b0c8a0-8449-4e25-aa82-6f5e8369755f","name":"Sticky Note"},{"parameters":{"content":"## Tela de disparo","height":260,"width":760,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-6832,-768],"typeVersion":1,"id":"421ecd61-5a55-4f05-9968-f7890d631a2a","name":"Sticky Note1"},{"parameters":{"httpMethod":"POST","path":"verificar-login","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5776,-2784],"id":"420805e8-c14b-40bc-a7da-177166419c1c","name":"VERIFICAR LOGIN","webhookId":"76823ad5-23f1-41ef-9087-61bedea2556d"},{"parameters":{"content":"## Tela de login\n","height":260,"width":760,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-7024,-3776],"typeVersion":1,"id":"cc791929-dc44-419d-97cf-4dfd3c7140a4","name":"Sticky Note5"},{"parameters":{"path":"LOGIN","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6960,-3680],"id":"241d0f8e-a6c7-4a19-a89e-9da1ece250dc","name":"LOGIN","webhookId":"44ef5672-bb5e-47cb-8c16-50d5ffb78a8c"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Login - EnviaZap</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            color: white;\n            min-height: 100vh;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            padding: 20px;\n        }\n\n        .login-container {\n            max-width: 450px;\n            width: 100%;\n        }\n\n        .header {\n            text-align: center;\n            margin-bottom: 40px;\n        }\n\n        .logo {\n            width: 80px;\n            height: 80px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border-radius: 20px;\n            display: none;\n            align-items: center;\n            justify-content: center;\n            margin: 0 auto 20px;\n            font-size: 2.5rem;\n        }\n\n        .header h1 {\n            font-size: 2.5rem;\n            font-weight: 600;\n            margin-bottom: 10px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n        }\n\n        .header p {\n            color: #888;\n            font-size: 1rem;\n            line-height: 1.5;\n        }\n\n        .login-form {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 16px;\n            padding: 40px;\n            backdrop-filter: blur(10px);\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n        }\n\n        .form-group {\n            margin-bottom: 25px;\n        }\n\n        .form-group label {\n            color: #fff;\n            font-weight: 500;\n            margin-bottom: 8px;\n            font-size: 0.95rem;\n            display: block;\n        }\n\n        .form-group input {\n            width: 100%;\n            padding: 15px;\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            color: white;\n            font-size: 1rem;\n            outline: none;\n            transition: all 0.3s ease;\n        }\n\n        .form-group input::placeholder {\n            color: #888;\n        }\n\n        .form-group input:focus {\n            border-color: #25d366;\n            box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.2);\n        }\n\n        .form-group input:invalid {\n            border-color: rgba(255, 59, 48, 0.5);\n        }\n\n        .password-container {\n            position: relative;\n        }\n\n        .toggle-password {\n            position: absolute;\n            right: 12px;\n            top: 50%;\n            transform: translateY(-50%);\n            background: none;\n            border: none;\n            color: #888;\n            cursor: pointer;\n            padding: 5px;\n            border-radius: 4px;\n            transition: all 0.3s ease;\n            font-size: 1.1rem;\n        }\n\n        .toggle-password:hover {\n            color: #25d366;\n            background: rgba(255, 255, 255, 0.05);\n        }\n\n        .eye-icon {\n            display: block;\n        }\n\n        .forgot-password {\n            text-align: right;\n            margin-bottom: 30px;\n        }\n\n        .forgot-password a {\n            color: #25d366;\n            text-decoration: none;\n            font-size: 0.9rem;\n            transition: all 0.3s ease;\n        }\n\n        .forgot-password a:hover {\n            color: #128c7e;\n            text-decoration: underline;\n        }\n\n        .login-btn {\n            width: 100%;\n            padding: 18px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border: none;\n            border-radius: 12px;\n            color: white;\n            font-size: 1.1rem;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 10px;\n            margin-bottom: 20px;\n        }\n\n        .login-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 12px 30px rgba(37, 211, 102, 0.4);\n        }\n\n        .login-btn:disabled {\n            background: #444;\n            cursor: not-allowed;\n            transform: none;\n            box-shadow: none;\n        }\n\n        .loading-spinner {\n            width: 20px;\n            height: 20px;\n            border: 2px solid rgba(255, 255, 255, 0.3);\n            border-top: 2px solid white;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            display: none;\n        }\n\n        .login-btn.loading .loading-spinner {\n            display: block;\n        }\n\n        .success-message,\n        .error-message {\n            padding: 15px 20px;\n            border-radius: 8px;\n            margin-bottom: 20px;\n            display: none;\n            text-align: center;\n        }\n\n        .success-message {\n            background: rgba(52, 199, 89, 0.1);\n            border: 1px solid rgba(52, 199, 89, 0.3);\n            color: #34c759;\n        }\n\n        .error-message {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n        }\n\n        .success-message.show,\n        .error-message.show {\n            display: block;\n        }\n\n        .features {\n            margin-top: 30px;\n            text-align: center;\n        }\n\n        .features h3 {\n            color: #25d366;\n            margin-bottom: 15px;\n            font-size: 1.1rem;\n        }\n\n        .feature-list {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 15px;\n            margin-top: 20px;\n        }\n\n        .feature-item {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 8px;\n            padding: 15px;\n            text-align: center;\n        }\n\n        .feature-icon {\n            font-size: 1.5rem;\n            margin-bottom: 8px;\n            display: block;\n        }\n\n        .feature-text {\n            color: #888;\n            font-size: 0.8rem;\n        }\n\n        .divider {\n            height: 1px;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);\n            margin: 30px 0;\n        }\n\n        .footer {\n            text-align: center;\n            margin-top: 30px;\n            color: #666;\n            font-size: 0.8rem;\n        }\n\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n\n        @keyframes fadeIn {\n            from {\n                opacity: 0;\n                transform: translateY(20px);\n            }\n            to {\n                opacity: 1;\n                transform: translateY(0);\n            }\n        }\n\n        .login-container {\n            animation: fadeIn 0.6s ease-out;\n        }\n\n        /* Responsive */\n        @media (max-width: 768px) {\n            .header h1 {\n                font-size: 2rem;\n            }\n            \n            .login-form {\n                padding: 30px 25px;\n            }\n\n            .feature-list {\n                grid-template-columns: 1fr;\n                gap: 10px;\n            }\n        }\n\n        /* Security indicators */\n        .security-info {\n            background: rgba(37, 211, 102, 0.05);\n            border: 1px solid rgba(37, 211, 102, 0.2);\n            border-radius: 8px;\n            padding: 15px;\n            margin-top: 20px;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .security-icon {\n            color: #25d366;\n            font-size: 1.2rem;\n        }\n\n        .security-text {\n            color: #888;\n            font-size: 0.85rem;\n            line-height: 1.4;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"login-container\">\n        <div class=\"header\">\n            <h1>EnviaZap</h1>\n            <p>Acesse sua conta para gerenciar suas campanhas de mensagens</p>\n        </div>\n\n        <div class=\"login-form\">\n            <form id=\"loginForm\">\n                <div class=\"success-message\" id=\"successMessage\"></div>\n                <div class=\"error-message\" id=\"errorMessage\"></div>\n\n                <div class=\"form-group\">\n                    <label for=\"email\">E-mail *</label>\n                    <input \n                        type=\"email\" \n                        id=\"email\" \n                        name=\"email\" \n                        placeholder=\"seu@email.com\" \n                        required \n                        autocomplete=\"email\"\n                    >\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"password\">Senha *</label>\n                    <div class=\"password-container\">\n                        <input \n                            type=\"password\" \n                            id=\"password\" \n                            name=\"password\" \n                            placeholder=\"Digite sua senha\" \n                            required \n                            autocomplete=\"current-password\"\n                        >\n                        <button type=\"button\" class=\"toggle-password\" id=\"togglePassword\">\n                            <span class=\"eye-icon\">👁️</span>\n                        </button>\n                    </div>\n                </div>\n\n                <div class=\"forgot-password\">\n                    <a href=\"#\" id=\"forgotPasswordLink\">Esqueceu sua senha?</a>\n                </div>\n\n                <button type=\"submit\" class=\"login-btn\" id=\"loginBtn\">\n                    <div class=\"loading-spinner\"></div>\n                    <span id=\"btnText\">🔐 Entrar</span>\n                </button>\n            </form>\n\n            <div class=\"security-info\">\n                <span class=\"security-icon\">🔒</span>\n                <div class=\"security-text\">\n                    Seus dados estão protegidos com criptografia de ponta a ponta\n                </div>\n            </div>\n        </div>\n\n        <div class=\"footer\">\n            <p>© 2025 EnviaZap • Plataforma segura e confiável</p>\n        </div>\n    </div>\n\n    <script>\n        // Elementos do DOM\n        const loginForm = document.getElementById('loginForm');\n        const emailInput = document.getElementById('email');\n        const passwordInput = document.getElementById('password');\n        const togglePassword = document.getElementById('togglePassword');\n        const loginBtn = document.getElementById('loginBtn');\n        const btnText = document.getElementById('btnText');\n        const successMessage = document.getElementById('successMessage');\n        const errorMessage = document.getElementById('errorMessage');\n        const forgotPasswordLink = document.getElementById('forgotPasswordLink');\n\n        // Funções de feedback\n        function showSuccess(message) {\n            successMessage.textContent = message;\n            successMessage.classList.add('show');\n            errorMessage.classList.remove('show');\n            setTimeout(() => {\n                successMessage.classList.remove('show');\n            }, 5000);\n        }\n\n        function showError(message) {\n            errorMessage.textContent = message;\n            errorMessage.classList.add('show');\n            successMessage.classList.remove('show');\n            \n            // Resetar campo de senha quando erro\n            passwordInput.value = '';\n            passwordInput.focus();\n            \n            setTimeout(() => {\n                errorMessage.classList.remove('show');\n            }, 5000);\n        }\n\n        function setLoading(loading) {\n            if (loading) {\n                loginBtn.classList.add('loading');\n                loginBtn.disabled = true;\n                btnText.textContent = 'Verificando...';\n            } else {\n                loginBtn.classList.remove('loading');\n                loginBtn.disabled = false;\n                btnText.textContent = '🔐 Entrar';\n            }\n        }\n\n        // Validação em tempo real\n        function validateEmail(email) {\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            return emailRegex.test(email);\n        }\n\n        function validateForm() {\n            const email = emailInput.value.trim();\n            const password = passwordInput.value.trim();\n            \n            if (!email) {\n                showError('Por favor, digite seu e-mail.');\n                emailInput.focus();\n                return false;\n            }\n            \n            if (!validateEmail(email)) {\n                showError('Por favor, digite um e-mail válido.');\n                emailInput.focus();\n                return false;\n            }\n            \n            if (!password) {\n                showError('Por favor, digite sua senha.');\n                passwordInput.focus();\n                return false;\n            }\n            \n            if (password.length < 6) {\n                showError('A senha deve ter pelo menos 6 caracteres.');\n                passwordInput.focus();\n                return false;\n            }\n            \n            return true;\n        }\n\n        // Função para salvar informações de login com fallback\n        function saveLoginInfo(email) {\n            try {\n                localStorage.setItem('userEmail', email);\n                localStorage.setItem('loginTime', new Date().toISOString());\n                console.log('Informações de login salvas no localStorage');\n            } catch (e) {\n                console.warn('Acesso ao localStorage bloqueado:', e.message);\n                // Prosseguir sem interromper o fluxo\n            }\n        }\n\n        // Função para redirecionamento seguro com userId\n        function secureRedirect(userId) {\n            // Criar um formulário temporário para POST\n            const form = document.createElement('form');\n            form.method = 'POST';\n            form.action = 'https://n8n.typebot.pro/webhook/conectar';\n            form.style.display = 'none';\n            \n            // Adicionar o userId como campo oculto\n            const userIdInput = document.createElement('input');\n            userIdInput.type = 'hidden';\n            userIdInput.name = 'userId';\n            userIdInput.value = userId;\n            \n            form.appendChild(userIdInput);\n            document.body.appendChild(form);\n            \n            // Submeter o formulário\n            form.submit();\n            \n            // Limpar o formulário depois\n            setTimeout(() => {\n                document.body.removeChild(form);\n            }, 100);\n        }\n\n        // Submissão do formulário\n        loginForm.addEventListener('submit', async function(e) {\n            e.preventDefault();\n            \n            // Limpar mensagens anteriores\n            successMessage.classList.remove('show');\n            errorMessage.classList.remove('show');\n            \n            // Validar formulário\n            if (!validateForm()) {\n                return;\n            }\n            \n            const email = emailInput.value.trim();\n            const password = passwordInput.value.trim();\n            \n            setLoading(true);\n            \n            try {\n                console.log('Enviando requisição para:', 'https://n8n.typebot.pro/webhook/verificar-login');\n                console.log('Payload:', JSON.stringify({ email, senha: password }));\n                \n                const response = await fetch('https://n8n.typebot.pro/webhook/verificar-login', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({\n                        email: email,\n                        senha: password\n                    })\n                });\n                \n                console.log('Status:', response.status);\n                console.log('Headers:', [...response.headers.entries()]);\n                \n                if (!response.ok) {\n                    const errorText = await response.text();\n                    throw new Error(`Erro ${response.status}: ${errorText || response.statusText}`);\n                }\n                \n                const data = await response.json();\n                console.log('Dados:', data);\n                \n                let accessStatus = null;\n                let userId = null;\n                \n                if (Array.isArray(data) && data.length > 0) {\n                    const userData = data[0];\n                    accessStatus = userData.acesso;\n                    userId = userData.userId || userData.id;\n                } else if (data.acesso) {\n                    accessStatus = data.acesso;\n                    userId = data.userId || data.id;\n                }\n                \n                if (accessStatus === 'liberado' && userId) {\n                    showSuccess('✅ Login realizado com sucesso! Redirecionando...');\n                    saveLoginInfo(email); // Usa a função segura para localStorage\n                    setTimeout(() => {\n                        secureRedirect(userId); // Usa POST para redirecionamento seguro\n                    }, 2000);\n                } else if (accessStatus === 'liberado' && !userId) {\n                    showError('❌ Erro no sistema: UserId não recebido. Contate o suporte.');\n                } else if (accessStatus === 'negado') {\n                    showError('❌ E-mail ou senha incorretos. Tente novamente.');\n                } else if (accessStatus === 'bloqueado') {\n                    showError('🚫 Acesso bloqueado. Entre em contato com o suporte.');\n                } else {\n                    showError('❌ Erro de autenticação. Tente novamente ou contate o suporte.');\n                }\n                \n            } catch (error) {\n                console.error('Erro detalhado:', error);\n                showError(`Erro ao fazer login: ${error.message}`);\n            } finally {\n                setLoading(false);\n            }\n        });\n\n        // Funcionalidade do botão de mostrar/ocultar senha\n        togglePassword.addEventListener('click', function() {\n            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';\n            passwordInput.setAttribute('type', type);\n            \n            // Trocar ícone\n            const eyeIcon = togglePassword.querySelector('.eye-icon');\n            eyeIcon.textContent = type === 'password' ? '👁️' : '🙈';\n        });\n\n        // Link \"Esqueceu sua senha?\"\n        forgotPasswordLink.addEventListener('click', function(e) {\n            e.preventDefault();\n            \n            const email = emailInput.value.trim();\n            if (email && validateEmail(email)) {\n                showSuccess('📧 Se este e-mail estiver cadastrado, você receberá instruções para redefinir sua senha.');\n            } else {\n                showError('Por favor, digite um e-mail válido primeiro.');\n                emailInput.focus();\n            }\n        });\n\n        // Limpar mensagens quando o usuário começar a digitar\n        emailInput.addEventListener('input', function() {\n            if (errorMessage.classList.contains('show')) {\n                errorMessage.classList.remove('show');\n            }\n        });\n\n        passwordInput.addEventListener('input', function() {\n            if (errorMessage.classList.contains('show')) {\n                errorMessage.classList.remove('show');\n            }\n        });\n\n        // Enter para submeter\n        passwordInput.addEventListener('keypress', function(e) {\n            if (e.key === 'Enter') {\n                loginForm.dispatchEvent(new Event('submit'));\n            }\n        });\n\n        // Auto focus no email\n        emailInput.focus();\n\n        console.log('Script de login carregado com sucesso');\n    </script>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-6736,-3680],"id":"5b6499a0-6a21-4ceb-acab-d552b03245b6","name":"HTML2"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-6512,-3680],"id":"7076d8aa-e6cf-4b4a-92be-ea07a144a81c","name":"Respond to Webhook2"},{"parameters":{"operation":"getAll","tableId":"tabela_usuarios","filters":{"conditions":[{"keyName":"Email","condition":"eq","keyValue":"={{ $json.body.email }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5568,-2784],"id":"b3f67ab4-b33a-4cbd-b15a-3758e9e1a0fa","name":"LOCALIZAR EMAIL","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ec5237dd-e47c-4866-a485-3fbfd0fcd14a","leftValue":"={{ $json.senha }}","rightValue":"={{ $('VERIFICAR LOGIN').item.json.body.senha }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5360,-2784],"id":"b50a7b17-01eb-4693-92b7-9591aa97b874","name":"If"},{"parameters":{"assignments":{"assignments":[{"id":"f8f7118b-6718-4985-bf2d-43d1e0ec2830","name":"acesso","value":"liberado","type":"string"},{"id":"29e00872-3b30-439b-b232-4ba2519bf4f7","name":"userId","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4768,-2976],"id":"5e909723-a360-4fc6-8718-edc5958ca1f3","name":"LIBERADO"},{"parameters":{"assignments":{"assignments":[{"id":"f8f7118b-6718-4985-bf2d-43d1e0ec2830","name":"acesso","value":"negado","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4768,-2656],"id":"6b71fa8a-ee22-41c8-8fb7-dc90dc9baa12","name":"NEGADO"},{"parameters":{"content":"## Login","height":480,"width":1380,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5872,-2992],"typeVersion":1,"id":"6eae387c-4d84-4f6a-a902-36c13698bf0e","name":"Sticky Note6"},{"parameters":{"content":"## Gerenciar conexões\n","height":500,"width":1240,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5872,-2464],"typeVersion":1,"id":"a2a055e2-7979-4728-8074-59bd14947e9e","name":"Sticky Note7"},{"parameters":{"method":"POST","url":"https://whatsapi.typebot.pro/instance/create","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"b4d71f9c38e3ac12a6b08e4b6d53aa90"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n\"instanceName\": \"{{ $json.body.instanceName }} - {{ Array.from({length: 6}, () => String.fromCharCode(65 + Math.floor(Math.random() * 26))).join('') }}\",\n\"qrcode\": true,\n\"integration\": \"WHATSAPP-BAILEYS\"\n}","options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5552,-2368],"id":"a5bdce17-1863-4fed-adb7-9937d6a5895a","name":"CRIAR INSTANCIA"},{"parameters":{"tableId":"tabela_conexoes","fieldsUi":{"fieldValues":[{"fieldId":"instanceName","fieldValue":"={{ $json.instance.instanceName }}"},{"fieldId":"NomeConexao","fieldValue":"={{ $('CRIAR CONEXAO2').item.json.body.instanceName }}"},{"fieldId":"idUsuario","fieldValue":"={{ $('CRIAR CONEXAO2').item.json.body.userId }}"},{"fieldId":"Apikey","fieldValue":"={{ $json.hash }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5328,-2368],"id":"bfcfd77c-3f0d-4571-ae38-56fb61e89f04","name":"CRIAR CONEXAO1","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"assignments":{"assignments":[{"id":"c16002cb-6afa-4ec1-8cdf-f8b5108f3af8","name":"qrcode","value":"={{ $('CRIAR INSTANCIA').item.json.qrcode.base64 }}","type":"string"},{"id":"2ff275e6-f183-400c-a140-3ec2779f8147","name":"instanceName","value":"={{ $('CRIAR INSTANCIA').item.json.instance.instanceName }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5136,-2368],"id":"abd2f795-b18b-439f-8135-90a17dc98ad4","name":"RESPOSTA"},{"parameters":{"content":"## Salvar telefone e foto","height":400,"width":1200,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5872,-1936],"typeVersion":1,"id":"437824f3-d374-4879-9125-1f04984baf9f","name":"Sticky Note8"},{"parameters":{"httpMethod":"POST","path":"salvarfoto","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5808,-1776],"id":"20fe13b1-1fe0-443c-a54b-29e6211c5ccd","name":"Webhook3","webhookId":"0d210c58-1258-4a4b-a3ff-c6b5d1e7b9fc"},{"parameters":{"assignments":{"assignments":[{"id":"c16002cb-6afa-4ec1-8cdf-f8b5108f3af8","name":"resposta","value":"=Foto salva com sucesso!","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4960,-1776],"id":"f4019f2e-ad39-48e0-a1f4-31693a1c8eef","name":"RESPOSTA1"},{"parameters":{"url":"https://whatsapi.typebot.pro/instance/fetchInstances","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.Apikey }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5376,-1776],"id":"60348db7-74fb-4009-b6ec-db63fe644d4d","name":"BUSCAR FOTO PERFIL"},{"parameters":{"operation":"getAll","tableId":"tabela_conexoes","matchType":"allFilters","filters":{"conditions":[{"keyName":"idUsuario","condition":"eq","keyValue":"={{ $json.body.userId }}"},{"keyName":"instanceName","condition":"eq","keyValue":"={{ $json.body.instanceName }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5600,-1776],"id":"c3d03524-af73-4b80-ad56-07b61a407206","name":"BUSCAR CONEXAO","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"operation":"update","tableId":"tabela_conexoes","matchType":"allFilters","filters":{"conditions":[{"keyName":"instanceName","condition":"eq","keyValue":"={{ $('Webhook3').item.json.body.instanceName }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"FotoPerfil","fieldValue":"={{ $json.profilePicUrl }}"},{"fieldId":"Telefone","fieldValue":"={{ $json.ownerJid.replaceAll('@s.whatsapp.net','') }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5152,-1776],"id":"3c75ca7e-09bc-415e-ab8f-abbc9175b99e","name":"SALVAR FOTO","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"content":"## LISTAR CONEXOES\n","height":400,"width":1200,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5872,-1488],"typeVersion":1,"id":"03721f63-1dc2-44cc-9fe4-3bc5dc33d204","name":"Sticky Note9"},{"parameters":{"httpMethod":"POST","path":"listarconexoes","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5808,-1328],"id":"06c4c596-a93e-497e-a077-4a0015ebddd0","name":"Webhook4","webhookId":"0d210c58-1258-4a4b-a3ff-c6b5d1e7b9fc"},{"parameters":{"assignments":{"assignments":[{"id":"c16002cb-6afa-4ec1-8cdf-f8b5108f3af8","name":"Conexoes","value":"={{ $json.data }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5120,-1328],"id":"b9d29bf5-17b2-437e-ad25-4557bbc34bc4","name":"RESPOSTA2"},{"parameters":{"operation":"getAll","tableId":"tabela_conexoes","matchType":"allFilters"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5600,-1328],"id":"b3b2aa34-7d73-4c0c-9884-c1b99bf005ff","name":"BUSCAR CONEXAO1","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-5376,-1328],"id":"9d5e78f8-5b46-48bf-a13a-8c946a7b4889","name":"Aggregate"},{"parameters":{"content":"## Tela de Conexões","height":260,"width":760,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-6832,-1056],"typeVersion":1,"id":"38191851-9fb7-4804-812f-40315dd8a344","name":"Sticky Note10"},{"parameters":{"path":"conexoes","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6768,-944],"id":"399892ad-716c-454b-a55e-dbcf22a88682","name":"LOGIN1","webhookId":"44ef5672-bb5e-47cb-8c16-50d5ffb78a8c"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Conexões - EnviaZap</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            color: white;\n            min-height: 100vh;\n            margin: 0;\n            padding: 0;\n        }\n\n        .app-layout {\n            display: flex;\n            min-height: 100vh;\n        }\n\n        /* Sidebar */\n        .sidebar {\n            width: 70px;\n            background: rgba(0, 0, 0, 0.3);\n            backdrop-filter: blur(10px);\n            border-right: 1px solid rgba(255, 255, 255, 0.1);\n            transition: all 0.3s ease;\n            position: relative;\n            z-index: 1000;\n        }\n\n        .sidebar:hover {\n            width: 250px;\n        }\n\n        .sidebar-header {\n            padding: 20px;\n            text-align: center;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .sidebar-logo {\n            font-size: 1.5rem;\n            font-weight: 600;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n            white-space: nowrap;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .sidebar-logo {\n            opacity: 1;\n        }\n\n        .sidebar-menu {\n            padding: 20px 0;\n        }\n\n        .menu-item {\n            display: flex;\n            align-items: center;\n            padding: 15px 20px;\n            color: #ccc;\n            text-decoration: none;\n            transition: all 0.3s ease;\n            position: relative;\n            white-space: nowrap;\n        }\n\n        .menu-item:hover {\n            background: rgba(37, 211, 102, 0.1);\n            color: #25d366;\n        }\n\n        .menu-item.active {\n            background: rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            border-right: 3px solid #25d366;\n        }\n\n        .menu-icon {\n            font-size: 1.2rem;\n            width: 30px;\n            text-align: center;\n            flex-shrink: 0;\n        }\n\n        .menu-text {\n            margin-left: 15px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .menu-text {\n            opacity: 1;\n        }\n\n        /* Main content */\n        .main-content {\n            flex: 1;\n            padding: 30px;\n            overflow-x: auto;\n        }\n\n        .header {\n            margin-bottom: 40px;\n        }\n\n        .header h1 {\n            font-size: 2.5rem;\n            font-weight: 600;\n            margin-bottom: 10px;\n        }\n\n        .header p {\n            color: #888;\n            font-size: 1.1rem;\n        }\n\n        /* Loading state */\n        .loading-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            min-height: 400px;\n            gap: 20px;\n        }\n\n        .loading-spinner {\n            width: 60px;\n            height: 60px;\n            border: 4px solid rgba(37, 211, 102, 0.3);\n            border-top: 4px solid #25d366;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n\n        .loading-text {\n            color: #25d366;\n            font-size: 1.2rem;\n            font-weight: 500;\n        }\n\n        /* Conexões Grid */\n        .conexoes-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));\n            gap: 25px;\n            margin-top: 20px;\n        }\n\n        .conexao-card {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 16px;\n            padding: 25px;\n            backdrop-filter: blur(10px);\n            transition: all 0.3s ease;\n            position: relative;\n        }\n\n        .conexao-card:hover {\n            transform: translateY(-5px);\n            border-color: rgba(37, 211, 102, 0.3);\n            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n        }\n\n        .conexao-header {\n            display: flex;\n            align-items: center;\n            gap: 15px;\n            margin-bottom: 20px;\n        }\n\n        .profile-photo {\n            width: 60px;\n            height: 60px;\n            border-radius: 50%;\n            border: 2px solid rgba(37, 211, 102, 0.3);\n            object-fit: cover;\n            background: rgba(255, 255, 255, 0.1);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 1.5rem;\n        }\n\n        .conexao-info h3 {\n            font-size: 1.2rem;\n            font-weight: 600;\n            margin-bottom: 5px;\n            color: #fff;\n        }\n\n        .telefone {\n            color: #888;\n            font-size: 0.95rem;\n        }\n\n        .status-badge {\n            position: absolute;\n            top: 20px;\n            right: 20px;\n            padding: 6px 12px;\n            border-radius: 20px;\n            font-size: 0.8rem;\n            font-weight: 600;\n        }\n\n        .status-conectado {\n            background: rgba(52, 199, 89, 0.2);\n            color: #34c759;\n            border: 1px solid rgba(52, 199, 89, 0.3);\n        }\n\n        .status-desconectado {\n            background: rgba(255, 59, 48, 0.2);\n            color: #ff3b30;\n            border: 1px solid rgba(255, 59, 48, 0.3);\n        }\n\n        .status-verificando {\n            background: rgba(255, 193, 7, 0.2);\n            color: #ffc107;\n            border: 1px solid rgba(255, 193, 7, 0.3);\n        }\n\n        .conexao-actions {\n            display: flex;\n            gap: 10px;\n            margin-top: 20px;\n        }\n\n        .btn-verificar {\n            flex: 1;\n            padding: 12px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n\n        .btn-verificar:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);\n        }\n\n        .btn-verificar:disabled {\n            background: #444;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        .btn-excluir {\n            padding: 12px;\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            border-radius: 8px;\n            color: #ff3b30;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .btn-excluir:hover {\n            background: rgba(255, 59, 48, 0.2);\n            transform: translateY(-2px);\n        }\n\n        .btn-qrcode {\n            flex: 1;\n            padding: 12px;\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            color: #25d366;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n\n        .btn-qrcode:hover {\n            background: rgba(37, 211, 102, 0.2);\n            transform: translateY(-2px);\n        }\n\n        /* QR Code Modal */\n        .qr-modal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.8);\n            backdrop-filter: blur(10px);\n            display: none;\n            align-items: center;\n            justify-content: center;\n            z-index: 10000;\n        }\n\n        .qr-modal.show {\n            display: flex;\n        }\n\n        .qr-modal-content {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 20px;\n            padding: 40px;\n            backdrop-filter: blur(20px);\n            text-align: center;\n            max-width: 400px;\n            width: 90%;\n        }\n\n        .qr-modal h3 {\n            color: #25d366;\n            margin-bottom: 20px;\n            font-size: 1.3rem;\n        }\n\n        .qr-code-container {\n            background: white;\n            padding: 20px;\n            border-radius: 16px;\n            margin: 20px 0;\n            display: inline-block;\n        }\n\n        .qr-code-container img {\n            width: 250px;\n            height: 250px;\n            object-fit: contain;\n        }\n\n        .qr-timer {\n            color: #25d366;\n            font-size: 0.9rem;\n            margin: 15px 0;\n        }\n\n        .qr-close {\n            background: rgba(255, 255, 255, 0.1);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            color: white;\n            padding: 12px 24px;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n\n        .qr-close:hover {\n            background: rgba(255, 255, 255, 0.2);\n        }\n\n        /* Empty state */\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: #888;\n        }\n\n        .empty-icon {\n            font-size: 4rem;\n            margin-bottom: 20px;\n            opacity: 0.5;\n        }\n\n        .empty-state h3 {\n            font-size: 1.5rem;\n            margin-bottom: 10px;\n            color: #ccc;\n        }\n\n        .empty-state p {\n            font-size: 1rem;\n            line-height: 1.5;\n        }\n\n        /* Error/Success messages */\n        .error-message, .success-message {\n            padding: 20px;\n            border-radius: 12px;\n            margin: 20px 0;\n            text-align: center;\n        }\n\n        .error-message {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n        }\n\n        .success-message {\n            background: rgba(52, 199, 89, 0.1);\n            border: 1px solid rgba(52, 199, 89, 0.3);\n            color: #34c759;\n        }\n\n        /* Animations */\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(20px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n\n        .conexao-card {\n            animation: fadeIn 0.5s ease-out;\n        }\n\n        .btn-refresh {\n            padding: 12px 20px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            font-size: 0.9rem;\n        }\n\n        .btn-refresh:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);\n        }\n\n        .btn-refresh:disabled {\n            background: #444;\n            cursor: not-allowed;\n            transform: none;\n        }\n        @media (max-width: 768px) {\n            .main-content {\n                padding: 20px;\n            }\n\n            .header h1 {\n                font-size: 2rem;\n            }\n\n            .conexoes-grid {\n                grid-template-columns: 1fr;\n                gap: 20px;\n            }\n\n            .sidebar {\n                width: 60px;\n            }\n\n            .sidebar:hover {\n                width: 200px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"app-layout\">\n        <!-- Main Content -->\n        <div class=\"main-content\">\n            <div class=\"header\">\n                <h1>Conexões WhatsApp</h1>\n                <p>Gerencie todas as suas conexões do WhatsApp em um só lugar</p>\n            </div>\n\n            <!-- Loading State -->\n            <div class=\"loading-container\" id=\"loadingContainer\">\n                <div class=\"loading-spinner\"></div>\n                <div class=\"loading-text\">Buscando conexões...</div>\n            </div>\n\n            <!-- Error Message -->\n            <div class=\"error-message\" id=\"errorMessage\" style=\"display: none;\"></div>\n\n            <!-- Success Message -->\n            <div class=\"success-message\" id=\"successMessage\" style=\"display: none;\"></div>\n\n            <!-- Conexões Grid -->\n            <div class=\"conexoes-grid\" id=\"conexoesGrid\" style=\"display: none;\"></div>\n\n            <!-- Empty State -->\n            <div class=\"empty-state\" id=\"emptyState\" style=\"display: none;\">\n                <div class=\"empty-icon\">📱</div>\n                <h3>Nenhuma conexão encontrada</h3>\n                <p>Você ainda não possui conexões WhatsApp.<br>Clique em \"Nova Conexão\" para começar.</p>\n            </div>\n        </div>\n    </div>\n\n    <!-- QR Code Modal -->\n    <div class=\"qr-modal\" id=\"qrModal\">\n        <div class=\"qr-modal-content\">\n            <h3>Escaneie o QR Code</h3>\n            <div class=\"qr-code-container\">\n                <img id=\"qrImage\" src=\"\" alt=\"QR Code\">\n            </div>\n            <div class=\"qr-timer\" id=\"qrTimer\">Expira em 29 segundos</div>\n            <button class=\"qr-close\" id=\"closeQrModal\">Fechar</button>\n        </div>\n    </div>\n\n    <script>\n        // Variáveis globais\n        let conexoesList = [];\n        let qrTimer = null;\n        let connectionChecker = null;\n        let currentReconnectInstance = null;\n\n        // Funções de UI\n        function showError(message) {\n            const errorEl = document.getElementById('errorMessage');\n            errorEl.textContent = message;\n            errorEl.style.display = 'block';\n            setTimeout(() => {\n                errorEl.style.display = 'none';\n            }, 5000);\n        }\n\n        function showSuccess(message) {\n            const successEl = document.getElementById('successMessage');\n            successEl.textContent = message;\n            successEl.style.display = 'block';\n            setTimeout(() => {\n                successEl.style.display = 'none';\n            }, 3000);\n        }\n\n        function hideLoading() {\n            document.getElementById('loadingContainer').style.display = 'none';\n        }\n\n        function showConexoes() {\n            document.getElementById('conexoesGrid').style.display = 'grid';\n        }\n\n        function showEmptyState() {\n            document.getElementById('emptyState').style.display = 'block';\n        }\n\n        // Simular dados para demonstração\n        function setupDemoData() {\n            const isClaudeEnvironment = window.location.hostname.includes('claude.ai') || \n                                      window.location.hostname.includes('anthropic') ||\n                                      window.location.protocol === 'blob:';\n                                      \n            if (isClaudeEnvironment) {\n                console.log('Ambiente de demonstração detectado - configurando dados simulados');\n                \n                // Dados de exemplo\n                const demoConexoes = [\n                    {\n                        nome: 'WhatsApp Pessoal',\n                        telefone: '+55 11 99999-1234',\n                        instanceName: 'pessoal_ABC123',\n                        foto: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiMyNWQzNjYiLz4KPHN2ZyB4PSIxNSIgeT0iMTUiIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyQzYuNDggMiAyIDYuNDggMiAxMnM0LjQ4IDEwIDEwIDEwaDEwVjEyQzIyIDYuNDggMTcuNTIgMiAxMiAyem0wIDNjMS42NiAwIDMgMS4zNCAzIDNzLTEuMzQgMy0zIDMtMy0xLjM0LTMtMyAxLjM0LTMgMy0zem0wIDEyLjJjLTIuNSAwLTQuNzEtMS4yOC02LTMuMjJjLjAzLTEuOTkgNC0zLjA4IDYtMy4wOHM1Ljk3IDEuMDkgNiAzLjA4QzE2LjcxIDE1LjkyIDE0LjUgMTcuMiAxMiAxNy4yeiIvPgo8L3N2Zz4KPC9zdmc+'\n                    },\n                    {\n                        nome: 'WhatsApp Comercial',\n                        telefone: '+55 11 88888-5678',\n                        instanceName: 'comercial_DEF456',\n                        foto: null\n                    },\n                    {\n                        nome: 'Suporte Cliente',\n                        telefone: '+55 11 77777-9012',\n                        instanceName: 'suporte_GHI789',\n                        foto: null\n                    }\n                ];\n                \n                return demoConexoes;\n            }\n            \n            return null;\n        }\n\n        // Carregar conexões\n        async function carregarConexoes() {\n            console.log('=== INICIANDO CARREGAMENTO DE CONEXÕES ===');\n\n            try {\n                // Verificar se é ambiente de demo\n                const demoData = setupDemoData();\n                if (demoData) {\n                    console.log('=== MODO DEMONSTRAÇÃO ===');\n                    console.log('Simulando carregamento...');\n                    \n                    // Simular delay de loading\n                    await new Promise(resolve => setTimeout(resolve, 2000));\n                    \n                    console.log('Dados de demo carregados:', demoData);\n                    conexoesList = demoData;\n                    \n                    hideLoading();\n                    \n                    if (conexoesList.length === 0) {\n                        showEmptyState();\n                    } else {\n                        renderConexoes();\n                        showConexoes();\n                        verificarTodasConexoes();\n                    }\n                    return;\n                }\n                \n                console.log('=== MODO PRODUÇÃO ===');\n                console.log('Fazendo requisição para API...');\n                \n                // Fazer requisição real\n                const response = await fetch('https://n8n.typebot.pro/webhook/listarconexoes', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({})\n                });\n\n                console.log('Status da resposta:', response.status);\n\n                if (!response.ok) {\n                    throw new Error(`Erro ${response.status}: ${response.statusText}`);\n                }\n\n                const data = await response.json();\n                console.log('Conexões recebidas da API:', data);\n\n                // Processar a estrutura da resposta: [{\"Conexoes\": [...]}]\n                let processedConexoes = [];\n                if (Array.isArray(data) && data.length > 0 && data[0].Conexoes) {\n                    // Estrutura: [{\"Conexoes\": [...]}]\n                    processedConexoes = data[0].Conexoes;\n                } else if (Array.isArray(data)) {\n                    // Estrutura: [...]\n                    processedConexoes = data;\n                } else if (data && data.Conexoes) {\n                    // Estrutura: {\"Conexoes\": [...]}\n                    processedConexoes = data.Conexoes;\n                }\n\n                console.log('Conexões brutas recebidas:', processedConexoes);\n\n                // Filtrar apenas objetos válidos com propriedades essenciais\n                const conexoesValidas = processedConexoes.filter(conexao => {\n                    // Verificar se é um objeto válido e não vazio\n                    if (!conexao || typeof conexao !== 'object') {\n                        return false;\n                    }\n                    \n                    // Verificar se tem pelo menos uma propriedade essencial\n                    const temNome = conexao.NomeConexao || conexao.nomeConexao || conexao.nome;\n                    const temInstance = conexao.instanceName || conexao.instance_name;\n                    \n                    return temNome || temInstance;\n                });\n\n                console.log(`${conexoesValidas.length} de ${processedConexoes.length} conexões são válidas`);\n\n                // Mapear os campos para o formato esperado\n                conexoesList = conexoesValidas.map(conexao => ({\n                    nome: conexao.NomeConexao || conexao.nomeConexao || conexao.nome || 'Conexão sem nome',\n                    telefone: conexao.Telefone || conexao.telefone || 'Telefone não disponível',\n                    instanceName: conexao.instanceName || conexao.instance_name,\n                    foto: conexao.FotoPerfil || conexao.foto || null,\n                    id: conexao.id\n                }));\n\n                console.log('Conexões processadas:', conexoesList);\n                \n                hideLoading();\n                \n                if (conexoesList.length === 0) {\n                    showEmptyState();\n                } else {\n                    renderConexoes();\n                    showConexoes();\n                    verificarTodasConexoes();\n                }\n\n            } catch (error) {\n                console.error('ERRO ao carregar conexões:', error);\n                hideLoading();\n                showError('Erro ao carregar conexões: ' + error.message);\n            }\n        }\n\n        // Renderizar conexões\n        function renderConexoes() {\n            const grid = document.getElementById('conexoesGrid');\n            grid.innerHTML = '';\n\n            conexoesList.forEach((conexao, index) => {\n                const card = createConexaoCard(conexao, index);\n                grid.appendChild(card);\n            });\n        }\n\n        // Criar card de conexão\n        function createConexaoCard(conexao, index) {\n            const card = document.createElement('div');\n            card.className = 'conexao-card';\n            card.dataset.index = index;\n\n            // Validar dados da conexão\n            const nomeSeguro = (conexao.nome && typeof conexao.nome === 'string') ? conexao.nome : 'Conexão sem nome';\n            const telefoneSeguro = (conexao.telefone && typeof conexao.telefone === 'string') ? conexao.telefone : 'Telefone não disponível';\n            const instanceNameSeguro = (conexao.instanceName && typeof conexao.instanceName === 'string') ? conexao.instanceName : 'instance_indefinida';\n            const fotoSegura = (conexao.foto && typeof conexao.foto === 'string') ? conexao.foto : null;\n\n            const photoElement = fotoSegura ? \n                `<img src=\"${fotoSegura}\" alt=\"Foto de perfil\" class=\"profile-photo\">` :\n                `<div class=\"profile-photo\">👤</div>`;\n\n            card.innerHTML = `\n                <div class=\"status-badge status-verificando\" id=\"status-${index}\">\n                    Verificando...\n                </div>\n                <div class=\"conexao-header\">\n                    ${photoElement}\n                    <div class=\"conexao-info\">\n                        <h3>${nomeSeguro}</h3>\n                        <div class=\"telefone\">${telefoneSeguro}</div>\n                    </div>\n                </div>\n                <div class=\"conexao-actions\">\n                    <button class=\"btn-verificar\" onclick=\"verificarConexao('${instanceNameSeguro}', ${index})\" id=\"btn-verificar-${index}\">\n                        🔄 Verificar\n                    </button>\n                    <button class=\"btn-qrcode\" onclick=\"gerarQRCode('${instanceNameSeguro}', ${index})\" id=\"btn-qrcode-${index}\" style=\"display: none;\">\n                        📱 Conectar\n                    </button>\n                    <button class=\"btn-excluir\" onclick=\"excluirConexao('${instanceNameSeguro}', ${index})\">\n                        🗑️\n                    </button>\n                </div>\n            `;\n\n            return card;\n        }\n\n        // Verificar todas as conexões\n        async function verificarTodasConexoes() {\n            for (let i = 0; i < conexoesList.length; i++) {\n                const conexao = conexoesList[i];\n                if (conexao.instanceName) {\n                    await verificarConexao(conexao.instanceName, i, true);\n                }\n                // Pequeno delay para não sobrecarregar\n                await new Promise(resolve => setTimeout(resolve, 200));\n            }\n        }\n\n        // Verificar conexão individual\n        async function verificarConexao(instanceName, index, silent = false) {\n            const statusEl = document.getElementById(`status-${index}`);\n            const btnVerificar = document.getElementById(`btn-verificar-${index}`);\n            const btnQrcode = document.getElementById(`btn-qrcode-${index}`);\n\n            // Validar instanceName\n            if (!instanceName || instanceName === 'instance_indefinida') {\n                console.error('InstanceName inválido para verificação:', instanceName);\n                if (statusEl) {\n                    statusEl.textContent = 'Erro';\n                    statusEl.className = 'status-badge status-desconectado';\n                }\n                if (btnQrcode) {\n                    btnQrcode.style.display = 'none';\n                }\n                return;\n            }\n\n            if (!silent && statusEl && btnVerificar) {\n                statusEl.textContent = 'Verificando...';\n                statusEl.className = 'status-badge status-verificando';\n                btnVerificar.disabled = true;\n            }\n\n            try {\n                const response = await fetch(`https://whatsapi.typebot.pro/instance/connectionState/${instanceName}`, {\n                    method: 'GET',\n                    headers: {\n                        'apikey': 'b4d71f9c38e3ac12a6b08e4b6d53aa90'\n                    }\n                });\n\n                const data = await response.json();\n                console.log(`Status da conexão ${instanceName}:`, data);\n\n                if (data.instance && data.instance.status === 'open') {\n                    // Conectado\n                    if (statusEl) {\n                        statusEl.textContent = 'Conectado';\n                        statusEl.className = 'status-badge status-conectado';\n                    }\n                    if (btnQrcode) {\n                        btnQrcode.style.display = 'none';\n                    }\n                } else {\n                    // Desconectado\n                    if (statusEl) {\n                        statusEl.textContent = 'Desconectado';\n                        statusEl.className = 'status-badge status-desconectado';\n                    }\n                    if (btnQrcode) {\n                        btnQrcode.style.display = 'block';\n                    }\n                }\n\n            } catch (error) {\n                console.error('Erro ao verificar conexão:', error);\n                if (statusEl) {\n                    statusEl.textContent = 'Erro';\n                    statusEl.className = 'status-badge status-desconectado';\n                }\n                if (btnQrcode) {\n                    btnQrcode.style.display = 'block';\n                }\n            } finally {\n                if (btnVerificar) {\n                    btnVerificar.disabled = false;\n                }\n            }\n        }\n\n        // Gerar QR Code\n        async function gerarQRCode(instanceName, index) {\n            try {\n                console.log('Gerando QR Code para:', instanceName);\n                \n                const response = await fetch(`https://whatsapi.typebot.pro/instance/connect/${instanceName}`, {\n                    method: 'GET',\n                    headers: {\n                        'apikey': 'b4d71f9c38e3ac12a6b08e4b6d53aa90'\n                    }\n                });\n\n                const data = await response.json();\n                console.log('QR Code gerado:', data);\n\n                if (data.base64) {\n                    mostrarQRModal(data.base64, instanceName, index);\n                } else {\n                    throw new Error('QR Code não foi retornado pela API');\n                }\n\n            } catch (error) {\n                console.error('Erro ao gerar QR Code:', error);\n                showError('Erro ao gerar QR Code: ' + error.message);\n            }\n        }\n\n        // Mostrar modal do QR Code\n        function mostrarQRModal(qrCodeBase64, instanceName, index) {\n            const modal = document.getElementById('qrModal');\n            const qrImage = document.getElementById('qrImage');\n            const timerEl = document.getElementById('qrTimer');\n            \n            qrImage.src = qrCodeBase64;\n            modal.classList.add('show');\n            \n            currentReconnectInstance = { instanceName, index };\n            \n            // Iniciar timer\n            let timeLeft = 29;\n            timerEl.textContent = `Expira em ${timeLeft} segundos`;\n            \n            qrTimer = setInterval(() => {\n                timeLeft--;\n                timerEl.textContent = `Expira em ${timeLeft} segundos`;\n                \n                if (timeLeft <= 0) {\n                    clearInterval(qrTimer);\n                    timerEl.textContent = 'QR Code expirado';\n                }\n            }, 1000);\n            \n            // Verificar conexão a cada 5 segundos\n            connectionChecker = setInterval(async () => {\n                const isConnected = await verificarConexaoSilenciosa(instanceName);\n                if (isConnected) {\n                    fecharQRModal();\n                    showSuccess('WhatsApp conectado com sucesso!');\n                    verificarConexao(instanceName, index);\n                }\n            }, 5000);\n        }\n\n        // Verificar conexão silenciosa (para o modal)\n        async function verificarConexaoSilenciosa(instanceName) {\n            try {\n                const response = await fetch(`https://whatsapi.typebot.pro/instance/connectionState/${instanceName}`, {\n                    method: 'GET',\n                    headers: {\n                        'apikey': 'b4d71f9c38e3ac12a6b08e4b6d53aa90'\n                    }\n                });\n\n                const data = await response.json();\n                return data.instance && data.instance.status === 'open';\n            } catch {\n                return false;\n            }\n        }\n\n        // Fechar modal do QR Code\n        function fecharQRModal() {\n            const modal = document.getElementById('qrModal');\n            modal.classList.remove('show');\n            \n            if (qrTimer) {\n                clearInterval(qrTimer);\n                qrTimer = null;\n            }\n            \n            if (connectionChecker) {\n                clearInterval(connectionChecker);\n                connectionChecker = null;\n            }\n        }\n\n        // Excluir conexão\n        async function excluirConexao(instanceName, index) {\n            if (!confirm('Tem certeza que deseja excluir esta conexão?')) {\n                return;\n            }\n\n            try {\n                console.log('Excluindo conexão:', instanceName);\n\n                // Fazer requisição para excluir no backend\n                const response = await fetch('https://n8n.typebot.pro/webhook/apagarconexaoback', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        instanceName: instanceName\n                    })\n                });\n\n                console.log('Status da resposta de exclusão:', response.status);\n\n                if (!response.ok) {\n                    throw new Error(`Erro ${response.status}: ${response.statusText}`);\n                }\n\n                const data = await response.json();\n                console.log('Resposta da exclusão:', data);\n\n                // Verificar se a exclusão foi bem-sucedida\n                if (data.resposta) {\n                    // Remover da lista local\n                    conexoesList.splice(index, 1);\n                    \n                    if (conexoesList.length === 0) {\n                        document.getElementById('conexoesGrid').style.display = 'none';\n                        showEmptyState();\n                    } else {\n                        renderConexoes();\n                        verificarTodasConexoes();\n                    }\n                    \n                    showSuccess('Conexão excluída com sucesso!');\n                } else {\n                    throw new Error('Falha ao excluir conexão no servidor');\n                }\n\n            } catch (error) {\n                console.error('Erro ao excluir conexão:', error);\n                showError('Erro ao excluir conexão: ' + error.message);\n            }\n        }\n\n        // Event listeners para navegação\n        function setupNavigation() {\n            const dashboardLink = document.getElementById('dashboardLink');\n            if (dashboardLink) {\n                dashboardLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/dashboard';\n                });\n            }\n\n            const novaConexaoLink = document.getElementById('novaConexaoLink');\n            if (novaConexaoLink) {\n                novaConexaoLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/conectar';\n                });\n            }\n\n            const historicoDisparosLink = document.getElementById('historicoDisparosLink');\n            if (historicoDisparosLink) {\n                historicoDisparosLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/historico-disparos';\n                });\n            }\n\n            const disparosIndividuaisLink = document.getElementById('disparosIndividuaisLink');\n            if (disparosIndividuaisLink) {\n                disparosIndividuaisLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/disparos-individuais';\n                });\n            }\n\n            const disparosGruposLink = document.getElementById('disparosGruposLink');\n            if (disparosGruposLink) {\n                disparosGruposLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/disparos-grupos';\n                });\n            }\n\n            // Event listener para fechar modal\n            const closeQrModal = document.getElementById('closeQrModal');\n            if (closeQrModal) {\n                closeQrModal.addEventListener('click', fecharQRModal);\n            }\n\n            // Fechar modal clicando fora\n            const qrModal = document.getElementById('qrModal');\n            if (qrModal) {\n                qrModal.addEventListener('click', function(e) {\n                    if (e.target === qrModal) {\n                        fecharQRModal();\n                    }\n                });\n            }\n        }\n\n        // Inicialização\n        async function inicializarPagina() {\n            console.log('Inicializando página de conexões');\n            setupNavigation();\n            await carregarConexoes();\n        }\n\n        // Executar quando o DOM estiver pronto\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', inicializarPagina);\n        } else {\n            inicializarPagina();\n        }\n\n        console.log('=== SCRIPT DA PÁGINA DE CONEXÕES CARREGADO ===');\n    </script>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-6544,-944],"id":"559f89f4-6d97-440d-b967-485f9f079016","name":"HTML4"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-6320,-944],"id":"4f8a503d-7aa7-49db-97ea-4a0bdb55577c","name":"Respond to Webhook3"},{"parameters":{"content":"## Tela de disparos de grupos","height":260,"width":760,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-6832,-480],"typeVersion":1,"id":"90786468-4c79-4af3-9a07-d7e510094c00","name":"Sticky Note11"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Disparos em Grupos</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            color: white;\n            min-height: 100vh;\n        }\n\n        .app-layout {\n            display: flex;\n            min-height: 100vh;\n        }\n\n        /* Sidebar */\n        .sidebar {\n            width: 70px;\n            background: rgba(0, 0, 0, 0.3);\n            backdrop-filter: blur(10px);\n            border-right: 1px solid rgba(255, 255, 255, 0.1);\n            transition: all 0.3s ease;\n            position: relative;\n            z-index: 1000;\n        }\n\n        .sidebar:hover {\n            width: 250px;\n        }\n\n        .sidebar-header {\n            padding: 20px;\n            text-align: center;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .sidebar-logo {\n            font-size: 1.5rem;\n            font-weight: 600;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n            white-space: nowrap;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .sidebar-logo {\n            opacity: 1;\n        }\n\n        .sidebar-menu {\n            padding: 20px 0;\n        }\n\n        .menu-item {\n            display: flex;\n            align-items: center;\n            padding: 15px 20px;\n            color: #ccc;\n            text-decoration: none;\n            transition: all 0.3s ease;\n            position: relative;\n            white-space: nowrap;\n        }\n\n        .menu-item:hover {\n            background: rgba(37, 211, 102, 0.1);\n            color: #25d366;\n        }\n\n        .menu-item.active {\n            background: rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            border-right: 3px solid #25d366;\n        }\n\n        .menu-icon {\n            font-size: 1.2rem;\n            width: 30px;\n            text-align: center;\n            flex-shrink: 0;\n        }\n\n        .menu-text {\n            margin-left: 15px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .menu-text {\n            opacity: 1;\n        }\n\n        /* Main content */\n        .main-content-wrapper {\n            flex: 1;\n            padding: 20px;\n            overflow-x: auto;\n        }\n\n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n        }\n\n        .header {\n            text-align: left;\n            margin-bottom: 40px;\n        }\n\n        .header h1 {\n            font-size: 2.5rem;\n            font-weight: 600;\n            margin-bottom: 10px;\n            color: white;\n        }\n\n        .header p {\n            color: #888;\n            font-size: 1.1rem;\n        }\n\n        .instance-info {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            padding: 12px 20px;\n            display: inline-flex;\n            align-items: center;\n            gap: 10px;\n            margin-bottom: 20px;\n        }\n\n        .instance-info .icon {\n            width: 8px;\n            height: 8px;\n            background: #25d366;\n            border-radius: 50%;\n        }\n\n        .main-content {\n            display: grid;\n            grid-template-columns: 1fr 400px;\n            gap: 40px;\n        }\n\n        .form-container {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 16px;\n            padding: 40px;\n            backdrop-filter: blur(10px);\n        }\n\n        .form-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin-bottom: 30px;\n        }\n\n        .form-group {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .form-group.full-width {\n            grid-column: 1 / -1;\n        }\n\n        .form-group label {\n            color: #fff;\n            font-weight: 500;\n            margin-bottom: 8px;\n            font-size: 0.95rem;\n        }\n\n        .form-group input,\n        .form-group textarea {\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            padding: 12px 15px;\n            color: white;\n            font-size: 1rem;\n            outline: none;\n            transition: all 0.3s ease;\n        }\n\n        .form-group input:focus,\n        .form-group textarea:focus {\n            border-color: #25d366;\n            box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.2);\n        }\n\n        .form-group input::placeholder,\n        .form-group textarea::placeholder {\n            color: #888;\n        }\n\n        .form-group textarea {\n            resize: vertical;\n            min-height: 100px;\n        }\n\n        /* Toggle Switch Styles */\n        .toggle-container {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin-top: 8px;\n        }\n\n        .toggle-switch {\n            position: relative;\n            width: 54px;\n            height: 30px;\n            background: #444;\n            border-radius: 15px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            border: 2px solid transparent;\n        }\n\n        .toggle-switch.disabled {\n            cursor: not-allowed;\n            opacity: 0.5;\n        }\n\n        .toggle-switch:not(.disabled):hover {\n            background: #555;\n        }\n\n        .toggle-switch.active {\n            background: #25d366;\n            border-color: #128c7e;\n            box-shadow: 0 0 10px rgba(37, 211, 102, 0.3);\n        }\n\n        .toggle-switch.active:hover {\n            background: #128c7e;\n        }\n\n        .toggle-slider {\n            position: absolute;\n            top: 2px;\n            left: 2px;\n            width: 22px;\n            height: 22px;\n            background: white;\n            border-radius: 50%;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 12px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n        }\n\n        .toggle-switch.active .toggle-slider {\n            transform: translateX(24px);\n            background: white;\n        }\n\n        .toggle-checkbox {\n            display: none;\n        }\n\n        .connections-section {\n            margin-bottom: 30px;\n        }\n\n        .connections-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n            gap: 12px;\n            margin-top: 15px;\n        }\n\n        .connection-card {\n            background: rgba(255, 255, 255, 0.03);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 8px;\n            padding: 16px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            position: relative;\n            min-height: 80px;\n        }\n\n        .connection-card:hover {\n            border-color: rgba(37, 211, 102, 0.4);\n            background: rgba(37, 211, 102, 0.05);\n            transform: translateY(-1px);\n        }\n\n        .connection-card.selected {\n            border-color: #25d366;\n            background: rgba(37, 211, 102, 0.1);\n            box-shadow: 0 0 0 1px rgba(37, 211, 102, 0.2);\n        }\n\n        .connection-card.selected::before {\n            content: '✓';\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            background: #25d366;\n            color: white;\n            width: 18px;\n            height: 18px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 0.7rem;\n            font-weight: bold;\n        }\n\n        .connection-header {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            position: relative;\n            padding-right: 30px;\n        }\n\n        .connection-avatar {\n            width: 36px;\n            height: 36px;\n            border-radius: 50%;\n            background: #25d366;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: bold;\n            font-size: 1rem;\n            flex-shrink: 0;\n        }\n\n        .connection-avatar img {\n            width: 100%;\n            height: 100%;\n            border-radius: 50%;\n            object-fit: cover;\n        }\n\n        .connection-info {\n            flex: 1;\n            min-width: 0;\n        }\n\n        .connection-name {\n            color: #fff;\n            font-size: 0.95rem;\n            font-weight: 600;\n            margin-bottom: 4px;\n            line-height: 1.2;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n\n        .connection-phone {\n            color: #888;\n            font-size: 0.8rem;\n            font-weight: 400;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n\n        .connection-status-pill {\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            padding: 2px 8px;\n            border-radius: 10px;\n            font-size: 0.65rem;\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 0.3px;\n            line-height: 1;\n        }\n\n        .connection-status-pill.connected {\n            background: rgba(52, 199, 89, 0.15);\n            color: #34c759;\n            border: 1px solid rgba(52, 199, 89, 0.3);\n        }\n\n        .connection-status-pill.disconnected {\n            background: rgba(255, 59, 48, 0.15);\n            color: #ff3b30;\n            border: 1px solid rgba(255, 59, 48, 0.3);\n        }\n\n        .connections-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin-bottom: 6px;\n        }\n\n        .refresh-connections-btn-small {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            padding: 4px 8px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 0.75rem;\n            transition: all 0.3s ease;\n        }\n\n        .refresh-connections-btn-small:hover {\n            background: rgba(37, 211, 102, 0.2);\n            transform: rotate(180deg);\n        }\n\n        .connections-selected {\n            background: rgba(37, 211, 102, 0.08);\n            border: 1px solid rgba(37, 211, 102, 0.2);\n            border-radius: 6px;\n            padding: 12px;\n            margin-top: 12px;\n            display: none;\n            font-size: 0.9rem;\n        }\n\n        .connections-selected.show {\n            display: block;\n        }\n\n        .no-connections {\n            text-align: center;\n            padding: 40px 20px;\n            color: #888;\n            border: 2px dashed rgba(255, 255, 255, 0.2);\n            border-radius: 12px;\n        }\n\n        .loading-connections {\n            text-align: center;\n            padding: 40px 20px;\n            color: #888;\n        }\n\n        .loading-spinner-large {\n            width: 40px;\n            height: 40px;\n            border: 3px solid rgba(37, 211, 102, 0.3);\n            border-top: 3px solid #25d366;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            margin: 0 auto 15px;\n        }\n\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n\n        .messages-section {\n            margin-bottom: 30px;\n        }\n\n        .message-item {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 15px;\n        }\n\n        .message-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 15px;\n        }\n\n        .message-title {\n            color: #25d366;\n            font-size: 0.9rem;\n            font-weight: 600;\n        }\n\n        .remove-message {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n            padding: 5px 10px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 0.8rem;\n            transition: all 0.3s ease;\n        }\n\n        .remove-message:hover {\n            background: rgba(255, 59, 48, 0.2);\n        }\n\n        .add-message-btn {\n            width: 100%;\n            padding: 15px;\n            background: rgba(37, 211, 102, 0.1);\n            border: 2px dashed rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            color: #25d366;\n            font-size: 1rem;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            margin-bottom: 20px;\n        }\n\n        .add-message-btn:hover {\n            background: rgba(37, 211, 102, 0.2);\n            border-color: #25d366;\n        }\n\n        .groups-section {\n            margin-bottom: 30px;\n        }\n\n        .groups-selected {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            padding: 15px;\n            margin-top: 15px;\n            display: none;\n        }\n\n        .groups-selected.show {\n            display: block;\n        }\n\n        .selected-groups-count {\n            color: #25d366;\n            font-weight: 600;\n            font-size: 0.9rem;\n            margin-bottom: 10px;\n        }\n\n        .selected-groups-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n        }\n\n        .selected-group-tag {\n            background: rgba(37, 211, 102, 0.2);\n            border: 1px solid rgba(37, 211, 102, 0.4);\n            border-radius: 16px;\n            padding: 6px 12px;\n            font-size: 0.8rem;\n            color: #25d366;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .remove-group-btn {\n            background: none;\n            border: none;\n            color: #25d366;\n            cursor: pointer;\n            font-size: 0.9rem;\n            padding: 0;\n            line-height: 1;\n        }\n\n        .media-upload {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 10px;\n            margin-top: 15px;\n        }\n\n        .media-preview-section {\n            margin-top: 15px;\n        }\n\n        .media-selected {\n            background: rgba(37, 211, 102, 0.1);\n            border: 1px solid rgba(37, 211, 102, 0.3);\n            border-radius: 8px;\n            padding: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n\n        .media-info-display {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .media-icon-display {\n            font-size: 1.2rem;\n        }\n\n        .media-name-display {\n            color: #fff;\n            font-weight: 500;\n        }\n\n        .media-size-display {\n            color: #888;\n            font-size: 0.9rem;\n        }\n\n        .remove-media-btn {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n            padding: 5px 8px;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 0.9rem;\n            transition: all 0.3s ease;\n        }\n\n        .remove-media-btn:hover {\n            background: rgba(255, 59, 48, 0.2);\n        }\n\n        .media-btn {\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.2);\n            border-radius: 8px;\n            padding: 12px 8px;\n            color: white;\n            cursor: pointer;\n            text-align: center;\n            font-size: 0.8rem;\n            transition: all 0.3s ease;\n            position: relative;\n        }\n\n        .media-btn:hover {\n            background: rgba(37, 211, 102, 0.1);\n            border-color: #25d366;\n        }\n\n        .media-btn input[type=\"file\"] {\n            position: absolute;\n            opacity: 0;\n            width: 100%;\n            height: 100%;\n            cursor: pointer;\n        }\n\n        .media-btn.active {\n            background: rgba(37, 211, 102, 0.2);\n            border-color: #25d366;\n            color: #25d366;\n        }\n\n        .media-preview-whatsapp {\n            margin-bottom: 8px;\n            border-radius: 8px;\n            overflow: hidden;\n            max-width: 200px;\n        }\n\n        .image-preview-whatsapp {\n            width: 100%;\n            height: auto;\n            max-height: 150px;\n            object-fit: cover;\n            border-radius: 8px;\n        }\n\n        .video-preview-whatsapp {\n            width: 100%;\n            height: auto;\n            max-height: 150px;\n            border-radius: 8px;\n        }\n\n        .video-overlay {\n            position: relative;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin-top: -75px;\n            margin-bottom: 75px;\n            pointer-events: none;\n        }\n\n        .play-button {\n            background: rgba(0, 0, 0, 0.6);\n            color: white;\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 1.2rem;\n        }\n\n        .audio-preview-whatsapp {\n            background: rgba(0, 0, 0, 0.1);\n            padding: 12px;\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin-bottom: 8px;\n            max-width: 250px;\n        }\n\n        .audio-icon {\n            font-size: 1.5rem;\n            color: #075e54;\n        }\n\n        .audio-info {\n            flex: 1;\n        }\n\n        .audio-name {\n            font-size: 0.9rem;\n            font-weight: 500;\n            color: #303030;\n            margin-bottom: 2px;\n        }\n\n        .audio-duration {\n            font-size: 0.8rem;\n            color: #667781;\n        }\n\n        .audio-controls {\n            display: none;\n        }\n\n        .document-preview-whatsapp {\n            background: rgba(0, 0, 0, 0.1);\n            padding: 12px;\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin-bottom: 8px;\n            max-width: 250px;\n            cursor: pointer;\n            transition: background 0.2s ease;\n        }\n\n        .document-preview-whatsapp:hover {\n            background: rgba(0, 0, 0, 0.15);\n        }\n\n        .document-icon {\n            font-size: 1.5rem;\n            color: #075e54;\n        }\n\n        .document-info {\n            flex: 1;\n        }\n\n        .document-name {\n            font-size: 0.9rem;\n            font-weight: 500;\n            color: #303030;\n            margin-bottom: 2px;\n            word-break: break-word;\n        }\n\n        .remove-group-btn:hover {\n            color: #fff;\n        }\n\n        .dispatch-btn {\n            width: 100%;\n            padding: 18px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border: none;\n            border-radius: 12px;\n            color: white;\n            font-size: 1.1rem;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            margin-top: 20px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 10px;\n        }\n\n        .dispatch-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 12px 30px rgba(37, 211, 102, 0.4);\n        }\n\n        .dispatch-btn:disabled {\n            background: #444;\n            cursor: not-allowed;\n            transform: none;\n            box-shadow: none;\n        }\n\n        .success-message,\n        .error-message {\n            padding: 15px 20px;\n            border-radius: 8px;\n            margin: 20px 0;\n            display: none;\n        }\n\n        .success-message {\n            background: rgba(52, 199, 89, 0.1);\n            border: 1px solid rgba(52, 199, 89, 0.3);\n            color: #34c759;\n        }\n\n        .error-message {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n        }\n\n        .success-message.show,\n        .error-message.show {\n            display: block;\n        }\n\n        .stats {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 20px;\n            margin-top: 30px;\n        }\n\n        .stat-card {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n        }\n\n        .stat-value {\n            font-size: 1.5rem;\n            font-weight: 600;\n            color: #25d366;\n            margin-bottom: 5px;\n        }\n\n        .stat-label {\n            color: #888;\n            font-size: 0.8rem;\n        }\n\n        /* Phone Preview */\n        .phone-preview {\n            position: sticky;\n            top: 20px;\n        }\n\n        .phone-container {\n            width: 350px;\n            height: 700px;\n            background: #000;\n            border-radius: 35px;\n            padding: 20px 15px;\n            position: relative;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n        }\n\n        .phone-screen {\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(135deg, #e5ddd5 0%, #d1c7b8 100%);\n            border-radius: 25px;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .whatsapp-header {\n            background: #075e54;\n            height: 60px;\n            display: flex;\n            align-items: center;\n            padding: 0 16px;\n            gap: 12px;\n        }\n\n        .contact-avatar {\n            width: 40px;\n            height: 40px;\n            background: #25d366;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            font-weight: bold;\n            font-size: 1.2rem;\n        }\n\n        .contact-info {\n            flex: 1;\n        }\n\n        .contact-name {\n            color: white;\n            font-size: 1rem;\n            font-weight: 500;\n        }\n\n        .contact-status {\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 0.8rem;\n        }\n\n        .chat-area {\n            flex: 1;\n            padding: 20px 16px;\n            overflow-y: auto;\n            height: calc(100% - 60px);\n            display: flex;\n            flex-direction: column;\n        }\n\n        .no-messages {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: #666;\n            font-style: italic;\n            text-align: center;\n        }\n\n        .message-bubble {\n            background: #dcf8c6;\n            border-radius: 8px;\n            padding: 8px 12px;\n            margin-bottom: 15px;\n            max-width: 80%;\n            margin-left: auto;\n            position: relative;\n            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n        }\n\n        .message-bubble:after {\n            content: '';\n            position: absolute;\n            top: 8px;\n            right: -8px;\n            width: 0;\n            height: 0;\n            border-left: 8px solid #dcf8c6;\n            border-top: 8px solid transparent;\n            border-bottom: 8px solid transparent;\n        }\n\n        .message-text {\n            color: #303030;\n            font-size: 0.9rem;\n            line-height: 1.4;\n            word-wrap: break-word;\n        }\n\n        .message-time {\n            color: #667781;\n            font-size: 0.7rem;\n            text-align: right;\n            margin-top: 4px;\n        }\n\n        .loading-spinner-small {\n            width: 16px;\n            height: 16px;\n            border: 2px solid rgba(37, 211, 102, 0.3);\n            border-top: 2px solid #25d366;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n            display: inline-block;\n            margin-left: 8px;\n        }\n\n        .add-group-btn {\n            background: #25d366;\n            border: none;\n            border-radius: 8px;\n            padding: 12px 20px;\n            color: white;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .add-group-btn:hover {\n            background: #128c7e;\n            transform: translateY(-1px);\n        }\n\n        .add-group-btn:disabled {\n            background: #666;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        @media (max-width: 1200px) {\n            .main-content {\n                grid-template-columns: 1fr;\n                gap: 30px;\n            }\n\n            .phone-preview {\n                position: static;\n                display: flex;\n                justify-content: center;\n            }\n\n            .phone-container {\n                width: 300px;\n                height: 600px;\n            }\n        }\n\n        @media (max-width: 768px) {\n            .form-grid {\n                grid-template-columns: 1fr;\n                gap: 20px;\n            }\n\n            .header h1 {\n                font-size: 2rem;\n            }\n\n            .form-container {\n                padding: 25px;\n            }\n\n            .sidebar {\n                width: 60px;\n            }\n\n            .sidebar:hover {\n                width: 180px;\n            }\n\n            .main-content-wrapper {\n                padding: 15px;\n            }\n\n            .toggle-container {\n                flex-wrap: wrap;\n                gap: 8px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"app-layout\">\n        <div class=\"main-content-wrapper\">\n            <div class=\"container\">\n                <div class=\"header\">\n                    <h1>Disparos em Grupos</h1>\n                    <p>Envie mensagens para múltiplos grupos do WhatsApp de forma automatizada</p>\n                </div>\n\n                <div class=\"main-content\">\n                    <div class=\"form-container\">\n                        <form id=\"dispatchForm\">\n                            <div class=\"connections-section\">\n                                <div class=\"connections-header\">\n                                    <label>Selecione uma conexão *</label>\n                                    <button type=\"button\" class=\"refresh-connections-btn-small\" onclick=\"loadConnections()\" title=\"Atualizar conexões\">\n                                        🔄\n                                    </button>\n                                </div>\n                                <p style=\"color: #888; font-size: 0.9rem; margin-bottom: 15px;\">\n                                    Selecione apenas uma conexão para fazer o disparo nos grupos.\n                                </p>\n                                <div id=\"connectionsContainer\">\n                                    <div class=\"loading-connections\">\n                                        <div class=\"loading-spinner-large\"></div>\n                                        <p>Buscando conexões...</p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class=\"messages-section\">\n                                <label>Mensagens a serem enviadas *</label>\n                                <p style=\"color: #888; font-size: 0.9rem; margin-bottom: 15px;\">\n                                    Crie variações de mensagens. O sistema enviará apenas 1 mensagem por grupo (escolhida aleatoriamente entre as variações).\n                                </p>\n                                <div id=\"messagesContainer\">\n                                    <!-- Mensagens serão adicionadas aqui dinamicamente -->\n                                </div>\n                                <button type=\"button\" class=\"add-message-btn\" id=\"addMessageBtn\">\n                                    ➕ Adicionar Mensagem\n                                </button>\n                            </div>\n\n                            <div class=\"form-grid\">\n                                <div class=\"form-group\">\n                                    <label for=\"sendDate\">Data para envio *</label>\n                                    <input type=\"datetime-local\" id=\"sendDate\" name=\"sendDate\" required>\n                                </div>\n                                \n                                <div class=\"form-group\">\n                                    <label for=\"selectAll\">Marcar todos do grupo</label>\n                                    <div class=\"toggle-container\">\n                                        <input type=\"checkbox\" id=\"selectAll\" class=\"toggle-checkbox\">\n                                        <div class=\"toggle-switch\" id=\"toggleSwitch\">\n                                            <div class=\"toggle-slider\">\n                                                <span id=\"toggleIcon\">✗</span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class=\"form-group full-width groups-section\">\n                                    <label>Grupos para envio *</label>\n                                    <p style=\"color: #888; font-size: 0.9rem; margin-bottom: 15px;\">\n                                        Cole os links de convite dos grupos onde deseja enviar as mensagens.\n                                    </p>\n                                    <div style=\"display: flex; gap: 10px; margin-bottom: 15px;\">\n                                        <input type=\"url\" id=\"groupInviteLink\" placeholder=\"https://chat.whatsapp.com/...\" style=\"flex: 1; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 12px 15px; color: white; font-size: 1rem; outline: none;\">\n                                        <button type=\"button\" id=\"addGroupBtn\" class=\"add-group-btn\">\n                                            <span id=\"addGroupText\">➕ Adicionar</span>\n                                        </button>\n                                    </div>\n                                    <div id=\"groupValidationMessage\" style=\"display: none; margin-bottom: 15px;\"></div>\n                                    <div class=\"groups-selected\" id=\"groupsSelected\">\n                                        <div class=\"selected-groups-count\" id=\"selectedGroupsCount\">0 grupos selecionados</div>\n                                        <div class=\"selected-groups-list\" id=\"selectedGroupsList\">\n                                            <!-- Tags dos grupos selecionados aparecerão aqui -->\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <button type=\"submit\" class=\"dispatch-btn\" id=\"dispatchBtn\">\n                                <span id=\"btnText\">🚀 Agendar Disparo</span>\n                            </button>\n                        </form>\n\n                        <div class=\"success-message\" id=\"successMessage\"></div>\n                        <div class=\"error-message\" id=\"errorMessage\"></div>\n\n                        <div class=\"stats\" id=\"stats\" style=\"display: none;\">\n                            <div class=\"stat-card\">\n                                <div class=\"stat-value\" id=\"totalGroups\">0</div>\n                                <div class=\"stat-label\">Grupos Selecionados</div>\n                            </div>\n                            <div class=\"stat-card\">\n                                <div class=\"stat-value\" id=\"totalMessages\">0</div>\n                                <div class=\"stat-label\">Variações de Mensagem</div>\n                            </div>\n                            <div class=\"stat-card\">\n                                <div class=\"stat-value\" id=\"scheduledDate\">--</div>\n                                <div class=\"stat-label\">Data Agendada</div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"phone-preview\">\n                        <div class=\"phone-container\">\n                            <div class=\"phone-screen\">\n                                <div class=\"whatsapp-header\">\n                                    <div class=\"contact-avatar\">G</div>\n                                    <div class=\"contact-info\">\n                                        <div class=\"contact-name\">Grupo</div>\n                                        <div class=\"contact-status\">online</div>\n                                    </div>\n                                </div>\n                                <div class=\"chat-area\" id=\"chatArea\">\n                                    <div class=\"no-messages\">\n                                        Digite uma mensagem para ver o preview\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // ===== VARIÁVEIS GLOBAIS =====\n        let selectedGroups = [];\n        let groups = [];\n        let messageCounter = 0;\n        let connections = [];\n        let selectedConnection = null;\n\n        // ===== ELEMENTOS DOM =====\n        const form = document.getElementById('dispatchForm');\n        const messagesContainer = document.getElementById('messagesContainer');\n        const addMessageBtn = document.getElementById('addMessageBtn');\n        const groupInviteLink = document.getElementById('groupInviteLink');\n        const dispatchBtn = document.getElementById('dispatchBtn');\n        const btnText = document.getElementById('btnText');\n        const successMessage = document.getElementById('successMessage');\n        const errorMessage = document.getElementById('errorMessage');\n        const stats = document.getElementById('stats');\n        const chatArea = document.getElementById('chatArea');\n        const toggleSwitch = document.getElementById('toggleSwitch');\n\n        // ===== FUNÇÕES DE TOGGLE =====\n        function handleToggleClick() {\n            const checkbox = document.getElementById('selectAll');\n            checkbox.checked = !checkbox.checked;\n            updateToggleVisual();\n            if (checkbox.checked) {\n                showSuccess('Opção ativada: Todos os usuários do grupo serão marcados (@todos) na mensagem.');\n            } else {\n                showSuccess('Opção desativada: Mensagem será enviada normalmente sem marcar usuários.');\n            }\n        }\n\n        function updateToggleVisual() {\n            const checkbox = document.getElementById('selectAll');\n            const toggleIcon = document.getElementById('toggleIcon');\n            if (checkbox.checked) {\n                toggleSwitch.classList.add('active');\n                toggleIcon.textContent = '✓';\n            } else {\n                toggleSwitch.classList.remove('active');\n                toggleIcon.textContent = '✗';\n            }\n        }\n\n        // ===== FUNÇÕES DE CONEXÕES =====\n        async function loadConnections() {\n            console.log('📡 === INÍCIO loadConnections() ===');\n            const container = document.getElementById('connectionsContainer');\n            if (!container) {\n                console.error('❌ Container connectionsContainer não encontrado!');\n                return;\n            }\n            \n            console.log('🔄 Definindo HTML de loading...');\n            container.innerHTML = `\n                <div class=\"loading-connections\">\n                    <div class=\"loading-spinner-large\"></div>\n                    <p>Buscando conexões...</p>\n                </div>\n            `;\n            \n            const refreshBtn = document.querySelector('.refresh-connections-btn-small');\n            if (refreshBtn) {\n                refreshBtn.disabled = true;\n                console.log('🔄 Botão refresh desabilitado');\n            }\n            \n            try {\n                console.log('📡 Fazendo fetch para:', 'https://n8n.typebot.pro/webhook/listarconexoes');\n                const response = await fetch('https://n8n.typebot.pro/webhook/listarconexoes', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({})\n                });\n\n                console.log('📡 Resposta recebida - Status:', response.status);\n                if (!response.ok) {\n                    const errorText = await response.text();\n                    console.error('❌ Erro na resposta:', errorText);\n                    throw new Error(`Erro na requisição: ${response.status} - ${errorText}`);\n                }\n\n                const data = await response.json();\n                console.log('✅ Dados recebidos (RAW):', data);\n                selectedConnection = null;\n                \n                connections = [];\n                if (data.Conexoes && Array.isArray(data.Conexoes)) {\n                    connections = data.Conexoes.filter(conn => {\n                        if (!conn || typeof conn !== 'object') return false;\n                        return conn.instanceName || conn.NomeConexao || conn.id || conn.ID || conn.Telefone || conn.telefone;\n                    });\n                    console.log('✅ Estrutura tipo 1: data.Conexoes encontrada');\n                } else if (Array.isArray(data) && data.length > 0 && data[0]?.Conexoes) {\n                    connections = data[0].Conexoes.filter(conn => {\n                        if (!conn || typeof conn !== 'object') return false;\n                        return conn.instanceName || conn.NomeConexao || conn.id || conn.ID || conn.Telefone || conn.telefone;\n                    });\n                    console.log('✅ Estrutura tipo 2: data[0].Conexoes encontrada');\n                } else if (Array.isArray(data)) {\n                    connections = data.filter(conn => {\n                        if (!conn || typeof conn !== 'object') return false;\n                        return conn.instanceName || conn.NomeConexao || conn.id || conn.ID || conn.Telefone || conn.telefone;\n                    });\n                    console.log('✅ Estrutura tipo 3: array direto de conexões');\n                } else {\n                    console.log('⚠️ Estrutura não reconhecida ou dados vazios:', data);\n                }\n\n                console.log('✅ Conexões finais processadas:', connections.length);\n                if (connections.length > 0) {\n                    await checkConnectionsStatus();\n                    renderConnections();\n                } else {\n                    renderNoConnections();\n                }\n\n            } catch (error) {\n                console.error('❌ ERRO COMPLETO:', error);\n                showError(`Erro ao carregar conexões: ${error.message}`);\n                renderConnectionError();\n            } finally {\n                if (refreshBtn) {\n                    refreshBtn.disabled = false;\n                    console.log('🔄 Botão refresh reabilitado');\n                }\n                console.log('📡 === FIM loadConnections() ===');\n            }\n        }\n\n        async function checkConnectionsStatus() {\n            console.log('🔍 === INÍCIO verificação de status ===');\n            if (!connections || !Array.isArray(connections) || connections.length === 0) {\n                console.log('⚠️ Nenhuma conexão para verificar status');\n                return;\n            }\n            \n            const baseUrl = 'https://whatsapi.typebot.pro';\n            const apiKey = 'b4d71f9c38e3ac12a6b08e4b6d53aa90';\n            \n            const promises = connections.map(async (connection, index) => {\n                try {\n                    if (!connection || !connection.instanceName) {\n                        console.warn(`⚠️ Conexão ${index} inválida:`, connection);\n                        return;\n                    }\n                    \n                    console.log(`🔍 Verificando status da conexão ${index + 1}/${connections.length}: ${connection.instanceName}`);\n                    const response = await fetch(`${baseUrl}/instance/connectionState/${connection.instanceName}`, {\n                        method: 'GET',\n                        headers: {\n                            'apikey': apiKey\n                        }\n                    });\n                    \n                    if (response.ok) {\n                        const statusData = await response.json();\n                        connection.connectionStatus = statusData;\n                        const actualState = statusData.instance?.state || statusData.state;\n                        connection.isConnected = actualState === 'open';\n                        console.log(`📊 Status interpretado para ${connection.instanceName}:`, {\n                            actualState: actualState,\n                            isConnected: connection.isConnected\n                        });\n                    } else {\n                        connection.connectionStatus = null;\n                        connection.isConnected = false;\n                    }\n                    \n                } catch (error) {\n                    console.error(`❌ Erro na verificação de ${connection?.instanceName || 'conexão inválida'}:`, error);\n                    if (connection) {\n                        connection.connectionStatus = null;\n                        connection.isConnected = false;\n                    }\n                }\n            });\n            \n            await Promise.all(promises);\n            console.log('✅ Verificação de status concluída');\n        }\n\n        function renderConnections() {\n            const container = document.getElementById('connectionsContainer');\n            if (!connections || connections.length === 0) {\n                renderNoConnections();\n                return;\n            }\n\n            let html = '<div class=\"connections-grid\">';\n            connections.forEach((connection, index) => {\n                if (!connection) return;\n                \n                const nomeConexao = connection.NomeConexao || connection.nomeConexao || `Conexão ${index + 1}`;\n                let avatar = connection.FotoPerfil \n                    ? `<img src=\"${connection.FotoPerfil}\" alt=\"${nomeConexao}\">`\n                    : (nomeConexao.charAt(0).toUpperCase() || '?');\n                \n                const status = connection.isConnected === true ? 'connected' : 'disconnected';\n                const statusIcon = connection.isConnected === true ? '✓' : '✗';\n                const statusClass = connection.isConnected === true ? 'connected' : 'disconnected';\n                const telefone = connection.Telefone || connection.telefone || 'Indisponível';\n                const connectionId = connection.id || connection.ID || index;\n\n                html += `\n                    <div class=\"connection-card\" onclick=\"selectConnection(${connectionId})\" data-connection-id=\"${connectionId}\">\n                        <div class=\"connection-header\">\n                            <div class=\"connection-avatar\">${avatar}</div>\n                            <div class=\"connection-info\">\n                                <div class=\"connection-name\">${nomeConexao}</div>\n                                <div class=\"connection-phone\">${telefone}</div>\n                            </div>\n                            <div class=\"connection-status-pill ${statusClass}\">${statusIcon}</div>\n                        </div>\n                    </div>\n                `;\n            });\n\n            html += '</div>';\n            html += `\n                <div class=\"connections-selected\" id=\"connectionsSelected\">\n                    <div class=\"selected-count\" id=\"selectedCount\">Nenhuma conexão selecionada</div>\n                </div>\n            `;\n            container.innerHTML = html;\n            updateSelectedConnectionDisplay();\n        }\n\n        function renderNoConnections() {\n            const container = document.getElementById('connectionsContainer');\n            container.innerHTML = `\n                <div class=\"no-connections\">\n                    <h3>❌ Nenhuma conexão encontrada</h3>\n                    <p>Você não possui conexões configuradas no sistema.</p>\n                    <button type=\"button\" class=\"add-message-btn\" onclick=\"window.location.href='https://n8n.typebot.pro/webhook/conectar'\">\n                        🔗 Criar Nova Conexão\n                    </button>\n                </div>\n            `;\n        }\n\n        function renderConnectionError() {\n            const container = document.getElementById('connectionsContainer');\n            container.innerHTML = `\n                <div class=\"no-connections\">\n                    <h3>Erro ao carregar conexões</h3>\n                    <p>Não foi possível carregar suas conexões. Tente novamente.</p>\n                    <button type=\"button\" class=\"add-message-btn\" onclick=\"loadConnections()\">\n                        🔄 Tentar Novamente\n                    </button>\n                </div>\n            `;\n        }\n\n        function selectConnection(connectionId) {\n            document.querySelectorAll('.connection-card').forEach(card => card.classList.remove('selected'));\n            const card = document.querySelector(`[data-connection-id=\"${connectionId}\"]`);\n            const connection = connections.find(conn => (conn.id || conn.ID) == connectionId);\n            \n            if (card && connection) {\n                card.classList.add('selected');\n                selectedConnection = connection;\n                updateSelectedConnectionDisplay();\n                showSuccess(`Conexão \"${connection.NomeConexao || connection.nomeConexao}\" selecionada!`);\n            } else {\n                showError('Erro ao selecionar conexão.');\n            }\n        }\n\n        function updateSelectedConnectionDisplay() {\n            const selectedDiv = document.getElementById('connectionsSelected');\n            const countDiv = document.getElementById('selectedCount');\n            if (selectedConnection) {\n                selectedDiv.classList.add('show');\n                countDiv.textContent = `Conexão selecionada: ${selectedConnection.NomeConexao || selectedConnection.nomeConexao}`;\n            } else {\n                selectedDiv.classList.remove('show');\n                countDiv.textContent = 'Nenhuma conexão selecionada';\n            }\n        }\n\n        // ===== FUNÇÃO PARA VERIFICAR E ADICIONAR GRUPO =====\n        async function addGroupByLink() {\n            const link = groupInviteLink.value.trim();\n            const addGroupBtn = document.getElementById('addGroupBtn');\n            const addGroupText = document.getElementById('addGroupText');\n            const validationMessage = document.getElementById('groupValidationMessage');\n            \n            if (addGroupBtn.disabled) return;\n            \n            if (!link) {\n                showGroupValidationError('Por favor, insira um link de convite do grupo.');\n                return;\n            }\n            \n            if (!link.includes('chat.whatsapp.com/')) {\n                showGroupValidationError('Por favor, insira um link válido do WhatsApp.');\n                return;\n            }\n            \n            if (!selectedConnection) {\n                showGroupValidationError('Por favor, selecione uma conexão antes de adicionar grupos.');\n                return;\n            }\n            \n            const codeMatch = link.match(/chat\\.whatsapp\\.com\\/([A-Za-z0-9]+)/);\n            if (!codeMatch) {\n                showGroupValidationError('Link inválido. Não foi possível extrair o código do grupo.');\n                return;\n            }\n            \n            const groupCode = codeMatch[1];\n            if (selectedGroups.some(group => group.code === groupCode)) {\n                showGroupValidationError('Este grupo já foi adicionado à lista.');\n                return;\n            }\n            \n            addGroupBtn.disabled = true;\n            addGroupText.innerHTML = 'Verificando... <span class=\"loading-spinner-small\"></span>';\n            validationMessage.style.display = 'none';\n            \n            try {\n                const requestBody = {\n                    linkGrupo: link,\n                    instanceName: selectedConnection.instanceName,\n                    telefone: selectedConnection.Telefone\n                };\n                \n                const response = await fetch('https://n8n.typebot.pro/webhook/verificargrupo', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify(requestBody)\n                });\n                \n                if (!response.ok) {\n                    throw new Error(`Erro ao verificar grupo: ${response.status}`);\n                }\n                \n                const verificationData = await response.json();\n                if (!verificationData || verificationData.admin === false) {\n                    showGroupValidationError('Verifique se a conexão selecionada é administradora do grupo.');\n                    return;\n                }\n                \n                let groupInfo = {\n                    id: `verified_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n                    code: groupCode,\n                    name: verificationData.nomeGrupo || `Grupo ${selectedGroups.length + 1}`,\n                    link: link,\n                    participants: verificationData.participantes || 0,\n                    verified: true\n                };\n                \n                selectedGroups.push(groupInfo);\n                groupInviteLink.value = '';\n                \n                validationMessage.innerHTML = `\n                    <div style=\"background: rgba(52, 199, 89, 0.1); border: 1px solid rgba(52, 199, 89, 0.3); border-radius: 8px; padding: 12px; color: #34c759;\">\n                        ✅ Grupo verificado e adicionado com sucesso!<br><strong>Nome:</strong> ${groupInfo.name}\n                        ${groupInfo.participants > 0 ? `<br><strong>Participantes:</strong> ${groupInfo.participants}` : ''}\n                    </div>\n                `;\n                validationMessage.style.display = 'block';\n                \n                setTimeout(() => {\n                    validationMessage.style.display = 'none';\n                }, 5000);\n                \n                updateGroupsDisplay();\n                updateStats();\n                \n            } catch (error) {\n                showGroupValidationError(error.message.includes('500') && error.message.includes('No item to return got found')\n                    ? 'Verifique se a conexão selecionada é administradora do grupo.'\n                    : 'Erro ao verificar grupo. Verifique se o link está correto.');\n            } finally {\n                addGroupBtn.disabled = false;\n                addGroupText.innerHTML = '➕ Adicionar';\n            }\n        }\n\n        function showGroupValidationError(message) {\n            const validationMessage = document.getElementById('groupValidationMessage');\n            validationMessage.innerHTML = `\n                <div style=\"background: rgba(255, 59, 48, 0.1); border: 1px solid rgba(255, 59, 48, 0.3); border-radius: 8px; padding: 12px; color: #ff3b30;\">\n                    ❌ ${message}\n                </div>\n            `;\n            validationMessage.style.display = 'block';\n            setTimeout(() => {\n                validationMessage.style.display = 'none';\n            }, 5000);\n        }\n\n        function removeGroup(groupId) {\n            const index = selectedGroups.findIndex(sg => sg.id === groupId);\n            if (index > -1) {\n                selectedGroups.splice(index, 1);\n                updateGroupsDisplay();\n                updateStats();\n                showSuccess('Grupo removido da lista.');\n            }\n        }\n\n        function updateGroupsDisplay() {\n            const selectedDiv = document.getElementById('groupsSelected');\n            const countDiv = document.getElementById('selectedGroupsCount');\n            const listDiv = document.getElementById('selectedGroupsList');\n            \n            if (selectedGroups.length > 0) {\n                selectedDiv.classList.add('show');\n                countDiv.textContent = `${selectedGroups.length} grupo${selectedGroups.length !== 1 ? 's' : ''} selecionado${selectedGroups.length !== 1 ? 's' : ''}`;\n                \n                let tagsHtml = '';\n                selectedGroups.forEach(group => {\n                    tagsHtml += `\n                        <div class=\"selected-group-tag\">\n                            ${group.name}\n                            <button type=\"button\" class=\"remove-group-btn\" onclick=\"removeGroup('${group.id}')\">✕</button>\n                        </div>\n                    `;\n                });\n                \n                listDiv.innerHTML = tagsHtml;\n            } else {\n                selectedDiv.classList.remove('show');\n                countDiv.textContent = '0 grupos selecionados';\n                listDiv.innerHTML = '';\n            }\n        }\n\n        // ===== FUNÇÕES DE MENSAGENS =====\n        function addMessage() {\n            messageCounter++;\n            const messageDiv = document.createElement('div');\n            messageDiv.className = 'message-item';\n            messageDiv.innerHTML = `\n                <div class=\"message-header\">\n                    <span class=\"message-title\">Mensagem ${messageCounter}</span>\n                    <button type=\"button\" class=\"remove-message\" onclick=\"removeMessage(this)\">\n                        Remover\n                    </button>\n                </div>\n                <div class=\"form-group\">\n                    <label>Texto da mensagem *</label>\n                    <textarea name=\"message\" placeholder=\"Digite sua mensagem aqui...\" required oninput=\"updatePreview()\"></textarea>\n                </div>\n                <div class=\"media-upload\">\n                    <div class=\"media-btn\" onclick=\"selectMedia(this, 'image')\">\n                        <input type=\"file\" accept=\"image/*\" onchange=\"handleMediaUpload(this, 'image')\">\n                        📷 Imagem\n                    </div>\n                    <div class=\"media-btn\" onclick=\"selectMedia(this, 'video')\">\n                        <input type=\"file\" accept=\"video/*\" onchange=\"handleMediaUpload(this, 'video')\">\n                        🎥 Vídeo\n                    </div>\n                    <div class=\"media-btn\" onclick=\"selectMedia(this, 'audio')\">\n                        <input type=\"file\" accept=\"audio/*\" onchange=\"handleMediaUpload(this, 'audio')\">\n                        🎵 Áudio\n                    </div>\n                    <div class=\"media-btn\" onclick=\"selectMedia(this, 'document')\">\n                        <input type=\"file\" accept=\".pdf,.doc,.docx,.txt\" onchange=\"handleMediaUpload(this, 'document')\">\n                        📄 Documento\n                    </div>\n                </div>\n                <div class=\"media-preview-section\"></div>\n            `;\n            messagesContainer.appendChild(messageDiv);\n            updateStats();\n            updatePreview();\n        }\n\n        function removeMessage(button) {\n            if (messagesContainer.children.length > 1) {\n                button.closest('.message-item').remove();\n                updateStats();\n                updatePreview();\n            } else {\n                showError('Deve haver pelo menos uma mensagem.');\n            }\n        }\n\n        function selectMedia(button, type) {\n            const input = button.querySelector('input[type=\"file\"]');\n            input.click();\n        }\n\n        function handleMediaUpload(input, type) {\n            const file = input.files[0];\n            if (!file) return;\n\n            const messageItem = input.closest('.message-item');\n            const previewSection = messageItem.querySelector('.media-preview-section');\n            const mediaBtn = input.closest('.media-btn');\n\n            previewSection.innerHTML = '';\n            messageItem.querySelectorAll('.media-btn').forEach(btn => btn.classList.remove('active'));\n            mediaBtn.classList.add('active');\n\n            const mediaInfo = document.createElement('div');\n            mediaInfo.className = 'media-selected';\n            \n            let icon;\n            switch(type) {\n                case 'image': icon = '📷'; break;\n                case 'video': icon = '🎥'; break;\n                case 'audio': icon = '🎵'; break;\n                case 'document': icon = '📄'; break;\n            }\n\n            mediaInfo.innerHTML = `\n                <div class=\"media-info-display\">\n                    <span class=\"media-icon-display\">${icon}</span>\n                    <div>\n                        <div class=\"media-name-display\">${file.name}</div>\n                        <div class=\"media-size-display\">${formatFileSize(file.size)}</div>\n                    </div>\n                </div>\n                <button type=\"button\" class=\"remove-media-btn\" onclick=\"removeMedia(this)\">✕</button>\n            `;\n            previewSection.appendChild(mediaInfo);\n            updatePreview();\n        }\n\n        function removeMedia(button) {\n            const messageItem = button.closest('.message-item');\n            const previewSection = messageItem.querySelector('.media-preview-section');\n            previewSection.innerHTML = '';\n            messageItem.querySelectorAll('.media-btn').forEach(btn => btn.classList.remove('active'));\n            messageItem.querySelectorAll('input[type=\"file\"]').forEach(input => input.value = '');\n            updatePreview();\n        }\n\n        function formatFileSize(bytes) {\n            if (bytes === 0) return '0 Bytes';\n            const k = 1024;\n            const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n            const i = Math.floor(Math.log(bytes) / Math.log(k));\n            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n        }\n\n        // ===== FUNÇÕES DE PREVIEW =====\n        function updatePreview() {\n            const messageItems = messagesContainer.querySelectorAll('.message-item');\n            chatArea.innerHTML = '';\n\n            if (messageItems.length === 0) {\n                chatArea.innerHTML = '<div class=\"no-messages\">Digite uma mensagem para ver o preview</div>';\n                return;\n            }\n\n            messageItems.forEach((item, index) => {\n                const textarea = item.querySelector('textarea');\n                const text = textarea.value.trim();\n                const mediaInputs = item.querySelectorAll('input[type=\"file\"]');\n                \n                let selectedMedia = null;\n                for (let input of mediaInputs) {\n                    if (input.files.length > 0) {\n                        const parentBtn = input.closest('.media-btn');\n                        if (parentBtn.classList.contains('active')) {\n                            const file = input.files[0];\n                            let mediaType = null;\n                            if (parentBtn.textContent.includes('Imagem')) mediaType = 'image';\n                            else if (parentBtn.textContent.includes('Vídeo')) mediaType = 'video';\n                            else if (parentBtn.textContent.includes('Áudio')) mediaType = 'audio';\n                            else if (parentBtn.textContent.includes('Documento')) mediaType = 'document';\n                            selectedMedia = { file, type: mediaType };\n                            break;\n                        }\n                    }\n                }\n\n                if (text || selectedMedia) {\n                    const messageDiv = document.createElement('div');\n                    messageDiv.className = 'message-bubble';\n                    let content = '';\n                    \n                    if (selectedMedia) {\n                        content += createMediaPreview(selectedMedia);\n                    }\n                    \n                    if (text) {\n                        content += `<div class=\"message-text\">${text}</div>`;\n                    }\n                    \n                    content += `<div class=\"message-time\">${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</div>`;\n                    messageDiv.innerHTML = content;\n                    chatArea.appendChild(messageDiv);\n                }\n            });\n\n            if (chatArea.children.length === 0) {\n                chatArea.innerHTML = '<div class=\"no-messages\">Digite uma mensagem para ver o preview</div>';\n            }\n        }\n\n        function createMediaPreview(media) {\n            const { file, type } = media;\n            const fileName = file.name;\n            const fileSize = formatFileSize(file.size);\n            \n            switch (type) {\n                case 'image':\n                    const imageUrl = URL.createObjectURL(file);\n                    return `\n                        <div class=\"media-preview-whatsapp\">\n                            <img src=\"${imageUrl}\" alt=\"${fileName}\" class=\"image-preview-whatsapp\" onload=\"URL.revokeObjectURL(this.src)\">\n                        </div>\n                    `;\n                case 'video':\n                    const videoUrl = URL.createObjectURL(file);\n                    return `\n                        <div class=\"media-preview-whatsapp\">\n                            <video class=\"video-preview-whatsapp\" controls>\n                                <source src=\"${videoUrl}\" type=\"${file.type}\">\n                            </video>\n                            <div class=\"video-overlay\">\n                                <div class=\"play-button\">▶</div>\n                            </div>\n                        </div>\n                    `;\n                case 'audio':\n                    const audioUrl = URL.createObjectURL(file);\n                    return `\n                        <div class=\"audio-preview-whatsapp\">\n                            <div class=\"audio-icon\">🎵</div>\n                            <div class=\"audio-info\">\n                                <div class=\"audio-name\">${fileName}</div>\n                                <div class=\"audio-duration\">${fileSize}</div>\n                            </div>\n                            <audio controls class=\"audio-controls\">\n                                <source src=\"${audioUrl}\" type=\"${file.type}\">\n                            </audio>\n                        </div>\n                    `;\n                case 'document':\n                    return `\n                        <div class=\"document-preview-whatsapp\">\n                            <div class=\"document-icon\">📎</div>\n                            <div class=\"document-info\">\n                                <div class=\"document-name\">${fileName}</div>\n                                <div class=\"document-size\">${fileSize}</div>\n                            </div>\n                        </div>\n                    `;\n                default:\n                    return '';\n            }\n        }\n\n        // ===== FUNÇÕES DE ESTATÍSTICAS =====\n        function updateStats() {\n            const messageCount = messagesContainer.children.length;\n            const groupsCount = selectedGroups.length;\n            const sendDate = document.getElementById('sendDate').value;\n            \n            document.getElementById('totalMessages').textContent = messageCount;\n            document.getElementById('totalGroups').textContent = groupsCount;\n            \n            if (sendDate) {\n                const date = new Date(sendDate);\n                document.getElementById('scheduledDate').textContent = date.toLocaleDateString('pt-BR');\n            } else {\n                document.getElementById('scheduledDate').textContent = '--';\n            }\n\n            if (messageCount > 0 || groupsCount > 0) {\n                stats.style.display = 'grid';\n            }\n        }\n\n        // ===== FUNÇÕES DE MENSAGENS DE FEEDBACK =====\n        function showSuccess(message) {\n            successMessage.textContent = message;\n            successMessage.classList.add('show');\n            errorMessage.classList.remove('show');\n            setTimeout(() => {\n                successMessage.classList.remove('show');\n            }, 5000);\n        }\n\n        function showError(message) {\n            errorMessage.textContent = message;\n            errorMessage.classList.add('show');\n            successMessage.classList.remove('show');\n            setTimeout(() => {\n                errorMessage.classList.remove('show');\n            }, 5000);\n        }\n\n        // ===== FUNÇÃO DE ENVIO DE FORMULÁRIO =====\n        async function handleSubmit(event) {\n            event.preventDefault();\n            if (!selectedConnection) {\n                showError('Por favor, selecione uma conexão.');\n                return;\n            }\n            \n            if (selectedGroups.length === 0) {\n                showError('Por favor, adicione pelo menos um grupo.');\n                return;\n            }\n            \n            const messageItems = messagesContainer.querySelectorAll('.message-item');\n            if (messageItems.length === 0) {\n                showError('Por favor, adicione pelo menos uma mensagem.');\n                return;\n            }\n            \n            const sendDate = document.getElementById('sendDate').value;\n            if (!sendDate) {\n                showError('Por favor, selecione uma data para envio.');\n                return;\n            }\n            \n            dispatchBtn.disabled = true;\n            btnText.innerHTML = 'Agendando... <span class=\"loading-spinner-small\"></span>';\n            \n            try {\n                const messages = [];\n                for (let item of messageItems) {\n                    const text = item.querySelector('textarea').value.trim();\n                    const mediaInput = item.querySelector('input[type=\"file\"]:not(:invalid)');\n                    let media = null;\n                    if (mediaInput && mediaInput.files.length > 0) {\n                        const file = mediaInput.files[0];\n                        const parentBtn = mediaInput.closest('.media-btn');\n                        const type = parentBtn.textContent.includes('Imagem') ? 'image' :\n                                    parentBtn.textContent.includes('Vídeo') ? 'video' :\n                                    parentBtn.textContent.includes('Áudio') ? 'audio' :\n                                    parentBtn.textContent.includes('Documento') ? 'document' : null;\n                        media = { file, type };\n                    }\n                    messages.push({ text, media });\n                }\n                \n                const payload = {\n                    instanceName: selectedConnection.instanceName,\n                    telefone: selectedConnection.Telefone,\n                    groups: selectedGroups.map(g => ({\n                        link: g.link,\n                        name: g.name,\n                        participants: g.participants\n                    })),\n                    messages,\n                    sendDate: new Date(sendDate).toISOString(),\n                    markAll: document.getElementById('selectAll').checked\n                };\n                \n                const response = await fetch('https://n8n.typebot.pro/webhook/agendardisparo', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify(payload)\n                });\n                \n                if (!response.ok) {\n                    throw new Error(`Erro ao agendar disparo: ${response.status}`);\n                }\n                \n                showSuccess('Disparo agendado com sucesso!');\n                form.reset();\n                selectedGroups = [];\n                messagesContainer.innerHTML = '';\n                messageCounter = 0;\n                updateGroupsDisplay();\n                updateStats();\n                updatePreview();\n                \n            } catch (error) {\n                showError(`Erro ao agendar disparo: ${error.message}`);\n            } finally {\n                dispatchBtn.disabled = false;\n                btnText.innerHTML = '🚀 Agendar Disparo';\n            }\n        }\n\n        // ===== EVENT LISTENERS =====\n        toggleSwitch.addEventListener('click', handleToggleClick);\n        form.addEventListener('submit', handleSubmit);\n        addMessageBtn.addEventListener('click', addMessage);\n        document.getElementById('addGroupBtn').addEventListener('click', addGroupByLink);\n        document.getElementById('sendDate').addEventListener('change', updateStats);\n\n        // ===== INICIALIZAÇÃO =====\n        window.onload = () => {\n            loadConnections();\n            addMessage();\n        };\n    </script>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-6544,-368],"id":"3a85991c-ea1f-474b-9203-002bfa9edeac","name":"HTML5"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-6320,-368],"id":"5b8ead4c-7a3e-4bff-b440-b30e769c247f","name":"Respond to Webhook4"},{"parameters":{"path":"disparos-grupos","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6768,-368],"id":"329cac15-54ff-4068-9734-da7e60e9fe4e","name":"DISPAROS GRUPOS","webhookId":"44ef5672-bb5e-47cb-8c16-50d5ffb78a8c"},{"parameters":{"content":"## VERIFICAR GRUPO","height":440,"width":1220,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5872,-1056],"typeVersion":1,"id":"22753be4-1a43-4685-86ab-a17b93abb919","name":"Sticky Note12"},{"parameters":{"httpMethod":"POST","path":"verificargrupo","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5808,-896],"id":"7724a2fb-609e-491a-9fce-7d7e6f83699c","name":"Webhook5","webhookId":"0d210c58-1258-4a4b-a3ff-c6b5d1e7b9fc"},{"parameters":{"assignments":{"assignments":[{"id":"c16002cb-6afa-4ec1-8cdf-f8b5108f3af8","name":"admin","value":"=true","type":"boolean"},{"id":"fdbc636c-3c34-4cb1-bc32-ae1db878c77a","name":"nomeGrupo","value":"={{ $item(\"0\").$node[\"LISTAR GRUPO\"].json[\"subject\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5408,-896],"id":"6623a51c-befc-4c25-9aba-03ff11020ef0","name":"RESPOSTA3"},{"parameters":{"url":"=https://whatsapi.typebot.pro/group/inviteInfo/{{ $json.body.instanceName }}?inviteCode={{ $json.body.linkGrupo.replaceAll('https://chat.whatsapp.com/','') }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"=b4d71f9c38e3ac12a6b08e4b6d53aa90"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5616,-896],"id":"e1ac0319-f4fa-493a-9b28-5fe9d6c81de0","name":"LISTAR GRUPO"},{"parameters":{"httpMethod":"POST","path":"db56b0fb-cc58-4d51-8755-d7e04ccaa120123","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-4384,-1152],"id":"b13cb969-83d4-41f2-a092-f808474b5a6a","name":"Webhook6","webhookId":"db56b0fb-cc58-4d51-8755-d7e04ccaa120"},{"parameters":{"content":"## Recebe mensagem disparo grupo\n","height":980,"width":4160,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-4416,-1296],"typeVersion":1,"id":"335fea7f-431a-4468-9db6-c0796ca818fe","name":"Sticky Note4"},{"parameters":{"tableId":"tabela_disparos","fieldsUi":{"fieldValues":[{"fieldId":"TipoDisparo","fieldValue":"Individual"},{"fieldId":"TotalDisparos","fieldValue":"={{ $json.body.contacts.length }}"},{"fieldId":"StatusDisparo","fieldValue":"Em andamento"},{"fieldId":"idExecution","fieldValue":"={{ $execution.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-4112,-2144],"id":"a87594fc-e965-4517-9fc3-6e16dbf8a771","name":"CRIAR DISPARO","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"fieldToSplitOut":"CONTATOS","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-3696,-2144],"id":"1f3c476f-9fd8-4287-bad0-48eb34ef947b","name":"Split Out1"},{"parameters":{"assignments":{"assignments":[{"id":"363088c4-3861-4132-9f47-ea6805e780e2","name":"CONTATOS","value":"={{ $('DISPARAR MENSAGENS').item.json.body.contacts }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3920,-2144],"id":"ecf976b5-787c-4712-912a-52ec3aad32d9","name":"CONTATOS"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-3472,-2144],"id":"28c8b925-31cf-49d8-b6cc-e1bc805178fa","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me","typeVersion":1,"position":[-480,-1632],"id":"4a7be028-f830-42ff-a295-4d38d00919ca"},{"parameters":{"assignments":{"assignments":[{"id":"ddf2ca57-ee21-4f92-8869-bb0f04ad09bc","name":"mensagem","value":"={{  $item(\"0\").$node[\"DISPARAR MENSAGENS\"].json[\"body\"][\"messages\"][Math.floor(Math.random() *  $item(\"0\").$node[\"DISPARAR MENSAGENS\"].json[\"body\"][\"messages\"].length)] }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2160,-2016],"id":"755bf156-f5f1-4e2b-92fa-2c28c52a7e90","name":"MENSAGEM RANDOM"},{"parameters":{"assignments":{"assignments":[{"id":"ddf2ca57-ee21-4f92-8869-bb0f04ad09bc","name":"conexao","value":"={{ $item(\"0\").$node[\"DISPARAR MENSAGENS\"].json[\"body\"][\"connections\"][Math.floor(Math.random() * $item(\"0\").$node[\"DISPARAR MENSAGENS\"].json[\"body\"][\"connections\"].length)] }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1984,-2016],"id":"89c85a78-f921-4dc0-8dbd-f16f431d9729","name":"CONEXAO RANDOM"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaType }}","rightValue":"[null]","operator":{"type":"string","operation":"empty","singleValue":true},"id":"27f02d2f-98c1-42f5-81b7-3526ecabb8e2"}],"combinator":"and"},"renameOutput":true,"outputKey":"SEM ANEXO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a844e9d3-8bcb-4b79-9147-61936c8e1511","leftValue":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaType }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"IMAGEM"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"921c72c0-30e7-42d1-8f68-55a41e6c4851","leftValue":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaType }}","rightValue":"video","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"VIDEO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"04e10201-06a7-4b62-b060-b6dad7d0d613","leftValue":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaType }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"AUDIO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a19bffbd-7874-497c-a8de-19f52e8aeb65","leftValue":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaType }}","rightValue":"document","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"DOCUMENTO"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-1760,-2016],"id":"b2996ba3-e949-4657-9e13-08b47136cadd","name":"ANEXOS"},{"parameters":{"method":"POST","url":"=https://whatsapi.typebot.pro/message/sendText/{{ $json.conexao.instanceName }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.conexao.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Split Out1').item.json.CONTATOS }}"},{"name":"text","value":"={{ $('MENSAGEM RANDOM').item.json.mensagem.text }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1456,-2144],"id":"eb5e91ca-5045-4a27-a413-9a03c326dcfc","name":"MSG TEXTO"},{"parameters":{"method":"POST","url":"=https://whatsapi.typebot.pro/message/sendMedia/{{ $json.conexao.instanceName }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.conexao.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Split Out1').item.json.CONTATOS }}"},{"name":"mediatype","value":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaType }}"},{"name":"caption","value":"={{ $('MENSAGEM RANDOM').item.json.mensagem.text }}"},{"name":"media","value":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaBase64 }}"},{"name":"fileName","value":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaName }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1456,-1984],"id":"3edf87d1-3f7b-4ad9-ac9a-205f63265589","name":"MSG TEXTO + MEDIA"},{"parameters":{"method":"POST","url":"=https://whatsapi.typebot.pro/message/sendWhatsAppAudio/{{ $json.conexao.instanceName }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.conexao.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Split Out1').item.json.CONTATOS }}"},{"name":"audio","value":"={{ $('MENSAGEM RANDOM').item.json.mensagem.mediaBase64 }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1456,-1824],"id":"5cc2f4c4-6c77-47e8-8a7a-e1f1b72c9be9","name":"MSG TEXTO + AUDIO"},{"parameters":{"operation":"update","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"CRIAR DISPARO\"].json[\"id\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"MensagensDisparadas","fieldValue":"={{ $json.MensagensDisparadas +1 }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-992,-2000],"id":"325bf571-b64a-4ea8-8843-4622ea3dfa7e","name":"SALVAR DISPARO","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"operation":"get","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $item(\"0\").$node[\"CRIAR DISPARO\"].json[\"id\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1184,-2000],"id":"f3d495f4-1d8c-4cc6-8fde-0d2c1c57283f","name":"QNT DISPARADAS","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"amount":"={{ $item(\"0\").$node[\"DISPARAR MENSAGENS\"].json[\"body\"][\"settings\"][\"interval\"] }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-784,-2000],"id":"678d7fa7-211a-4ad7-8e81-9fd8ed0b3e23","name":"INTERVALO DE MENSAGENS","webhookId":"7af4820f-b2df-4fb3-8b79-34692c129fc4"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3b7ca854-74de-4fe2-86b8-a4c0de42a92b","leftValue":"={{ \n  (() => {\n    // Converte \"HH:mm\" em minutos desde 00:00\n    const toMinutes = (t) => {\n      const [h = 0, m = 0] = String(t).trim().split(':').map(Number);\n      return h * 60 + m;\n    };\n\n    // Hora atual em minutos\n    const agora = new Date();\n    const agoraMin = agora.getHours() * 60 + agora.getMinutes();\n\n    // Horário configurado no Webhook2\n    const startMin = toMinutes($item(\"0\").$node[\"DISPARAR MENSAGENS\"].json[\"body\"][\"settings\"][\"startTime\"]); // ex. \"08:00\" ou \"8:27\"\n    const endMin   = toMinutes($item(\"0\").$node[\"DISPARAR MENSAGENS\"].json[\"body\"][\"settings\"][\"endTime\"]);   // ex. \"18:00\"\n\n    // Retorna true se agora estiver no intervalo [start, end]\n    return agoraMin >= startMin && agoraMin <= endMin;\n  })() \n}}","rightValue":"={{ $('DISPARAR MENSAGENS').item.json.body.settings.startTime }}","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2656,-2016],"id":"93b1d983-293b-4b5b-abc9-60f261f1ce95","name":"DENTRO DO HORÁRIO?"},{"parameters":{"resume":"specificTime","dateTime":"={{ (()=>{const cfg=$item(0).$node[\"DISPARAR MENSAGENS\"].json.body.settings;const [sh,sm]=String(cfg.startTime||'00:00').split(':').map(Number);const [eh,em]=String(cfg.endTime||'23:59').split(':').map(Number);const now=new Date();const nowMin=now.getHours()*60+now.getMinutes();const sMin=sh*60+sm,eMin=eh*60+em;const pad=n=>String(n).padStart(2,'0');let trg=new Date(now);if(nowMin<sMin){trg.setHours(sh,sm,0,0);}else if(nowMin>eMin){trg.setDate(trg.getDate()+1);trg.setHours(sh,sm,0,0);}else{trg.setSeconds(0,0);}return `${trg.getFullYear()}-${pad(trg.getMonth()+1)}-${pad(trg.getDate())}T${pad(trg.getHours())}:${pad(trg.getMinutes())}:00`;})()\n }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-2416,-1744],"id":"1a1ebe3a-8f20-4502-a7b1-b05f28863d3c","name":"ESPERAR ATÉ O HORÁRIO","webhookId":"4fe83f0e-b17e-47b1-a89f-9b6d1bb42ff2"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ee692dac-7953-4949-b1fa-cf35ce7e9483","leftValue":"={{ \n  (\n    ($item(0).$node[\"DISPARAR MENSAGENS\"].json.body.settings.selectedDays || [])\n      .includes([7,1,2,3,4,5,6][ new Date().getDay() ])\n  )\n}}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3264,-2016],"id":"bc3db4bf-525b-4900-9f1e-fa6be89e8371","name":"DIAS SELECIONADOS"},{"parameters":{"httpMethod":"POST","path":"db56b0fb-cc58-4d51-8755-d7e04ccaa120","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-4336,-2144],"id":"3e27337b-ad20-4c93-8bb0-96051477483a","name":"DISPARAR MENSAGENS","webhookId":"db56b0fb-cc58-4d51-8755-d7e04ccaa120"},{"parameters":{"content":"## DIPARAR MENSAGENS INDIVIDUAIS","height":880,"width":4180,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-4416,-2240],"typeVersion":1,"id":"43164d97-b60b-4ebf-9f2c-580b0a07c9f4","name":"Sticky Note2"},{"parameters":{"resume":"specificTime","dateTime":"={{ (() => {\n     /* dias permitidos (1-seg … 7-dom) */\n     const dias = $item(\"0\").$node[\"DISPARAR MENSAGENS\"].json.body.settings.selectedDays || [];\n\n     /* dia de hoje nessa mesma convenção */\n     const now  = new Date();\n     const hoje = now.getDay() === 0 ? 7 : now.getDay();\n\n     /* diferença mínima (0-6) até o próximo dia permitido */\n     let diff = 7;\n     for (const d of dias) {\n       const delta = (d - hoje + 7) % 7;\n       if (delta < diff) diff = delta;\n     }\n\n     /* data-alvo: hoje + diff dias, hora 00:00 */\n     const target = new Date(now);\n     target.setDate(now.getDate() + diff);\n     target.setHours(0, 0, 0, 0);\n\n     /* formata YYYY-MM-DDT00:00:00  (sem offset) */\n     const pad = n => String(n).padStart(2, '0');\n     return `${target.getFullYear()}-${pad(target.getMonth()+1)}-${pad(target.getDate())}T00:00:00`;\n   })() }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-2976,-1760],"id":"908a62d8-afcd-4853-b069-9a1c0b53cd5e","name":"ESPERAR ATÉ DIA SELECIONADO","webhookId":"22f73b72-efac-456e-a188-dd428e7abe3a"},{"parameters":{"content":"## LISTAR DISPAROS\n","height":400,"width":1200,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5872,-576],"typeVersion":1,"id":"207353f4-8ff8-442c-8ab8-d58c8d5a8d07","name":"Sticky Note13"},{"parameters":{"httpMethod":"POST","path":"listadisparos","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5792,-416],"id":"9eb0c630-0cd6-4913-a158-04a26afcda68","name":"Webhook7","webhookId":"0d210c58-1258-4a4b-a3ff-c6b5d1e7b9fc"},{"parameters":{"assignments":{"assignments":[{"id":"c16002cb-6afa-4ec1-8cdf-f8b5108f3af8","name":"disparos","value":"={{ $json.data }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5088,-416],"id":"664c24eb-9d85-41c8-b78f-a640ff28daa9","name":"RESPOSTA5"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-5328,-416],"id":"d7ad2d1e-7d51-4353-b3c1-80df6b0a66b2","name":"Aggregate1"},{"parameters":{"operation":"getAll","tableId":"tabela_disparos","matchType":"allFilters"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5552,-416],"id":"e37aa2df-fabc-4735-b7bd-134da7c5318d","name":"BUSCAR DISPAROS","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"content":"## Tela histórico de disparos","height":260,"width":760,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-6832,-1616],"typeVersion":1,"id":"b0708623-a9eb-4854-939c-c9125240b5a3","name":"Sticky Note14"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-6320,-1504],"id":"4bcb0a14-3f65-4a49-bc3a-ae354dc6e05d","name":"Respond to Webhook5"},{"parameters":{"path":"historico-disparos","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6768,-1504],"id":"e59c1902-c126-418d-b475-848524bc21b1","name":"HISTORICO DISPAROS","webhookId":"44ef5672-bb5e-47cb-8c16-50d5ffb78a8c"},{"parameters":{"operation":"update","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"CRIAR DISPARO\"].json[\"id\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"StatusDisparo","fieldValue":"=Finalizado"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2592,-2240],"id":"54cbab93-44c2-4444-a5e1-ba34ca55a834","name":"SALVAR DISPARO1","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"operation":"get","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $item(\"0\").$node[\"CRIAR DISPARO\"].json[\"id\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2800,-2240],"id":"c7245465-d2a1-4206-83c1-0cc8b772e6b1","name":"BUSCAR DISPARO","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"content":"## CANCELAR EXECUÇÃO\n\n","height":420,"width":1200,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5872,-128],"typeVersion":1,"id":"5a7ed1d4-f392-4dbe-bfef-de771284d5d0","name":"Sticky Note15"},{"parameters":{"httpMethod":"POST","path":"cancelar","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5776,32],"id":"d872f741-6ded-4f99-9605-23efd2b26343","name":"Webhook8","webhookId":"0d210c58-1258-4a4b-a3ff-c6b5d1e7b9fc"},{"parameters":{"operation":"getAll","tableId":"tabela_disparos","matchType":"allFilters","filters":{"conditions":[{"keyName":"userId","condition":"eq","keyValue":"={{ $json.body.userId }}"},{"keyName":"id","condition":"eq","keyValue":"={{ $json.body.idDisparo }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5552,32],"id":"d5211e4a-e90a-4dd1-93f8-8bf0bc33933c","name":"BUSCAR DISPAROS1","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"resource":"execution","operation":"delete","executionId":"={{ $json.idExecution }}","requestOptions":{}},"type":"n8n-nodes-base.n8n","typeVersion":1,"position":[-5328,32],"id":"94752ad4-755c-4144-8730-84d7481d5faa","name":"DELETAR EXECUÇÃO","credentials":{"n8nApi":{"id":"40o85cQPEMEAEbwR","name":"n8n api"}}},{"parameters":{"operation":"update","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $node[\"BUSCAR DISPAROS1\"].json[\"id\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"StatusDisparo","fieldValue":"=Cancelado"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5088,32],"id":"81be0ad0-1c28-4768-87db-9af1142621f1","name":"SALVAR DISPARO2","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"content":"## Tela Dashboard","height":260,"width":760,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-6832,-1904],"typeVersion":1,"id":"9e905440-0a09-48f7-9bd2-1089e844b4ed","name":"Sticky Note16"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-6320,-1792],"id":"df90190d-7d9d-47e6-a703-fd8d5958c16d","name":"Respond to Webhook6"},{"parameters":{"path":"dashboard","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6768,-1792],"id":"b9b9ba72-192e-4d27-8195-3a0a9ef4d2b7","name":"DASHBOARD","webhookId":"44ef5672-bb5e-47cb-8c16-50d5ffb78a8c"},{"parameters":{"content":"## DADOS DASHBOARD\n\n","height":420,"width":1420,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-5872,336],"typeVersion":1,"id":"76914343-a9f5-4ffe-a1e9-22ea7cd9bb83","name":"Sticky Note17"},{"parameters":{"httpMethod":"POST","path":"dados-dashboard","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5776,496],"id":"394b7046-98e0-4955-80fe-0c7a69b58075","name":"Webhook9","webhookId":"0d210c58-1258-4a4b-a3ff-c6b5d1e7b9fc"},{"parameters":{"operation":"getAll","tableId":"tabela_disparos","matchType":"allFilters"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5552,496],"id":"1e2d52ea-b264-4f52-ae64-df917a5db817","name":"BUSCAR DISPAROS2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"operation":"getAll","tableId":"tabela_conexoes","matchType":"allFilters"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5120,496],"id":"7bd87641-7e3f-470c-aaec-c51979f86642","name":"BUSCAR CONEXOES","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-5328,496],"id":"eb5e98e5-b9c6-49a0-9cff-6b0489ce4bfe","name":"Aggregate2"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-4896,496],"id":"889ebbd5-7324-4cc9-a4f5-8f88107c09a0","name":"Aggregate3"},{"parameters":{"assignments":{"assignments":[{"id":"e61d1316-a6c0-4175-afd1-f76a369e588d","name":"disparos","value":"={{ $('Aggregate2').item.json.data }}","type":"array"},{"id":"97a44da0-c114-4878-9197-236af14905b4","name":"conexoes","value":"={{ $json.data }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4672,496],"id":"f156c686-2ce1-40a4-bff0-6cf6fdd31e28","name":"RESPOSTA6"},{"parameters":{"httpMethod":"POST","path":"criarconexaoback","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5776,-2368],"id":"1a835c1a-84cc-42e5-af85-d4e0b3b57773","name":"CRIAR CONEXAO2","webhookId":"0d210c58-1258-4a4b-a3ff-c6b5d1e7b9fc"},{"parameters":{"assignments":{"assignments":[{"id":"c16002cb-6afa-4ec1-8cdf-f8b5108f3af8","name":"resposta","value":"=deletada","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4848,-2176],"id":"b996085c-794a-4b45-90d5-6f0d77409210","name":"RESPOSTA7"},{"parameters":{"httpMethod":"POST","path":"apagarconexaoback","responseMode":"lastNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-5776,-2176],"id":"92d1dd62-a620-4353-a5f0-1fab4b39680b","name":"APAGAR CONEXAO","webhookId":"0d210c58-1258-4a4b-a3ff-c6b5d1e7b9fc"},{"parameters":{"method":"DELETE","url":"=https://whatsapi.typebot.pro/instance/delete/{{ $('APAGAR CONEXAO').item.json.body.instanceName }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"b4d71f9c38e3ac12a6b08e4b6d53aa90"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5328,-2176],"id":"3c27264b-a3a4-44a3-aa15-d75f8d6505b9","name":"DELETAR INSTANCIA"},{"parameters":{"method":"DELETE","url":"=https://whatsapi.typebot.pro/instance/logout/{{ $json.body.instanceName }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"b4d71f9c38e3ac12a6b08e4b6d53aa90"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5552,-2176],"id":"1b3ec8f0-6017-4e62-ada1-e3fe8e29d85e","name":"DESLOGAR INSTANCIA","onError":"continueRegularOutput"},{"parameters":{"operation":"delete","tableId":"tabela_conexoes","filters":{"conditions":[{"keyName":"instanceName","condition":"eq","keyValue":"={{ $('APAGAR CONEXAO').item.json.body.instanceName }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-5120,-2176],"id":"7c30593e-1158-4b37-9fe2-2d80ad5b7c12","name":"DELETAR CONEXAO","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"tableId":"tabela_disparos","fieldsUi":{"fieldValues":[{"fieldId":"TipoDisparo","fieldValue":"Grupos"},{"fieldId":"TotalDisparos","fieldValue":"={{ $json.body.grupos.length }}"},{"fieldId":"StatusDisparo","fieldValue":"Agendado"},{"fieldId":"idExecution","fieldValue":"={{ $execution.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-4176,-1152],"id":"a168470d-7727-48e8-9c76-e0eaccbbfdaa","name":"CRIAR DISPARO1","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"fieldToSplitOut":"CONTATOS","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[-3760,-1152],"id":"54d501ba-6ec8-41a1-8bed-3bdc0a52e03c","name":"Split Out2"},{"parameters":{"assignments":{"assignments":[{"id":"363088c4-3861-4132-9f47-ea6805e780e2","name":"CONTATOS","value":"={{ $('Webhook6').item.json.body.grupos }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3984,-1152],"id":"8376710a-3a35-472c-aad9-f00d6677bd80","name":"CONTATOS1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-3536,-1152],"id":"0a78f159-cf36-4363-b00c-ffd02f3efb5d","name":"Loop Over Items1"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me1","typeVersion":1,"position":[-1520,-560],"id":"c72ebbc0-f144-4e83-aa7f-302cd9ab6ba7"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.type }}","rightValue":"text","operator":{"type":"string","operation":"equals"},"id":"27f02d2f-98c1-42f5-81b7-3526ecabb8e2"}],"combinator":"and"},"renameOutput":true,"outputKey":"SEM ANEXO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a844e9d3-8bcb-4b79-9147-61936c8e1511","leftValue":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.type }}","rightValue":"image","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"IMAGEM"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"921c72c0-30e7-42d1-8f68-55a41e6c4851","leftValue":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.type }}","rightValue":"video","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"VIDEO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"04e10201-06a7-4b62-b060-b6dad7d0d613","leftValue":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.type }}","rightValue":"audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"AUDIO"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a19bffbd-7874-497c-a8de-19f52e8aeb65","leftValue":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.type }}","rightValue":"document","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"DOCUMENTO"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2656,-944],"id":"814723fa-8577-4722-8345-b5b9ad5b0309","name":"ANEXOS1"},{"parameters":{"method":"POST","url":"=https://whatsapi.typebot.pro/message/sendText/{{ $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"conexao\"][\"instanceName\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $node[\"Webhook6\"].json[\"body\"][\"conexao\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $node[\"LISTAR GRUPO1\"].json[\"id\"] }}"},{"name":"text","value":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.text }}"},{"name":"mentionsEveryOne","value":"={{ $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"configuracoes\"][\"marcarTodos\"] }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2464,-1024],"id":"3771ef53-3d69-4b5d-b358-530c07088b28","name":"MSG TEXTO1"},{"parameters":{"method":"POST","url":"=https://whatsapi.typebot.pro/message/sendMedia/{{ $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"conexao\"][\"instanceName\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $node[\"Webhook6\"].json[\"body\"][\"conexao\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $node[\"LISTAR GRUPO1\"].json[\"id\"] }}"},{"name":"mediatype","value":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.type }}"},{"name":"caption","value":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.text }}"},{"name":"media","value":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.media.data }}"},{"name":"fileName","value":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.media.filename }}"},{"name":"mentionsEveryOne","value":"={{ $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"configuracoes\"][\"marcarTodos\"] }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2464,-832],"id":"6ff3dcd1-5dd2-4dc3-8df9-c58b5b53e412","name":"MSG TEXTO + MEDIA1"},{"parameters":{"method":"POST","url":"=https://whatsapi.typebot.pro/message/sendWhatsAppAudio/{{ $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"conexao\"][\"instanceName\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $node[\"Webhook6\"].json[\"body\"][\"conexao\"][\"apikey\"] }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $node[\"LISTAR GRUPO1\"].json[\"id\"] }}"},{"name":"audio","value":"={{ $('MENSAGEM RANDOM1').item.json.mensagem.media.data }}"},{"name":"mentionsEveryOne","value":"={{ $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"configuracoes\"][\"marcarTodos\"] }}"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2464,-656],"id":"32b84ebd-ea4e-4fc6-9f72-c0797826e76b","name":"MSG TEXTO + AUDIO1"},{"parameters":{"operation":"update","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"CRIAR DISPARO1\"].json[\"id\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"MensagensDisparadas","fieldValue":"={{ $json.MensagensDisparadas +1 }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2032,-912],"id":"2225cd58-d5c4-4cf1-a508-c4d6f36b0dc7","name":"SALVAR DISPARO3","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"operation":"get","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $item(\"0\").$node[\"CRIAR DISPARO1\"].json[\"id\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2224,-912],"id":"105faf19-2ec2-4a38-b300-af564cc8af12","name":"QNT DISPARADAS1","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"operation":"update","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $item(\"0\").$node[\"CRIAR DISPARO1\"].json[\"id\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"StatusDisparo","fieldValue":"=Enviado"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2656,-1264],"id":"71d20a95-1d93-4f45-a9d6-2f385652d18b","name":"SALVAR DISPARO4","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"operation":"get","tableId":"tabela_disparos","filters":{"conditions":[{"keyName":"id","keyValue":"={{ $item(\"0\").$node[\"CRIAR DISPARO1\"].json[\"id\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-2864,-1264],"id":"dd9e0b9f-560d-446b-a804-2f1c141c4e9b","name":"BUSCAR DISPARO1","credentials":{"supabaseApi":{"id":"gSmzosOueGcVRiU6","name":"supabase enviazap"}}},{"parameters":{"resume":"specificTime","dateTime":"={{ $('Webhook6').item.json.body.configuracoes.dataEnvio.replace('.000Z','') }}"},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-3312,-896],"id":"257a5c45-b781-40bf-b4e8-f169e4afeaa2","name":"ESPERAR ATÉ A DATA","webhookId":"4fe83f0e-b17e-47b1-a89f-9b6d1bb42ff2"},{"parameters":{"url":"=https://whatsapi.typebot.pro/group/inviteInfo/{{ $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"conexao\"][\"instanceName\"] }}?inviteCode={{ $node[\"Loop Over Items1\"].json[\"code\"] }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"=b4d71f9c38e3ac12a6b08e4b6d53aa90"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2880,-896],"id":"3b7bab90-cc31-475a-b6b7-892fe43fe304","name":"LISTAR GRUPO1"},{"parameters":{"assignments":{"assignments":[{"id":"ddf2ca57-ee21-4f92-8869-bb0f04ad09bc","name":"mensagem","value":"={{  $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"mensagens\"][Math.floor(Math.random() *  $item(\"0\").$node[\"Webhook6\"].json[\"body\"][\"mensagens\"].length)] }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3104,-896],"id":"8c9c2bb8-a634-4a38-b674-6fe2690d8931","name":"MENSAGEM RANDOM1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"79557408-7865-45c4-bcdd-1b60d23fcf14","leftValue":"={{ $('LOCALIZAR EMAIL').item.json.status }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5120,-2848],"id":"8c502302-9a1e-40cb-a292-7ede3a21c997","name":"If1"},{"parameters":{"assignments":{"assignments":[{"id":"f8f7118b-6718-4985-bf2d-43d1e0ec2830","name":"acesso","value":"bloqueado","type":"string"},{"id":"29e00872-3b30-439b-b232-4ba2519bf4f7","name":"userId","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4768,-2816],"id":"aae0b078-b24f-4d6c-9300-b6e1c274874c","name":"BLOQUEADO"},{"parameters":{"content":"## ACESSO","height":260,"width":760,"color":2},"type":"n8n-nodes-base.stickyNote","position":[-6832,-2208],"typeVersion":1,"id":"82404d87-94f1-4704-9854-3d6e56ad63f2","name":"Sticky Note18"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[-6320,-2096],"id":"46bc1d5a-9b2b-4b4b-9cc1-6f31ef3c5fcb","name":"Respond to Webhook7"},{"parameters":{"path":"ENVIAZAP","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6768,-2096],"id":"f5247071-8994-4db1-a883-ce2b8f979576","name":"DASHBOARD1","webhookId":"44ef5672-bb5e-47cb-8c16-50d5ffb78a8c"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Dashboard - EnviaZap</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            color: white;\n            min-height: 100vh;\n            margin: 0;\n            padding: 0;\n        }\n\n        .app-layout {\n            display: flex;\n            min-height: 100vh;\n        }\n\n        /* Sidebar */\n        .sidebar {\n            width: 70px;\n            background: rgba(0, 0, 0, 0.3);\n            backdrop-filter: blur(10px);\n            border-right: 1px solid rgba(255, 255, 255, 0.1);\n            transition: all 0.3s ease;\n            position: relative;\n            z-index: 1000;\n        }\n\n        .sidebar:hover {\n            width: 250px;\n        }\n\n        .sidebar-header {\n            padding: 20px;\n            text-align: center;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .sidebar-logo {\n            font-size: 1.5rem;\n            font-weight: 600;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n            white-space: nowrap;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .sidebar-logo {\n            opacity: 1;\n        }\n\n        .sidebar-menu {\n            padding: 20px 0;\n        }\n\n        .menu-item {\n            display: flex;\n            align-items: center;\n            padding: 15px 20px;\n            color: #ccc;\n            text-decoration: none;\n            transition: all 0.3s ease;\n            position: relative;\n            white-space: nowrap;\n            cursor: pointer;\n        }\n\n        .menu-item:hover {\n            background: rgba(37, 211, 102, 0.1);\n            color: #25d366;\n        }\n\n        .menu-item.active {\n            background: rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            border-right: 3px solid #25d366;\n        }\n\n        .menu-icon {\n            font-size: 1.2rem;\n            width: 30px;\n            text-align: center;\n            flex-shrink: 0;\n        }\n\n        .menu-text {\n            margin-left: 15px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .menu-text {\n            opacity: 1;\n        }\n\n        /* Main content */\n        .main-content {\n            flex: 1;\n            padding: 30px;\n            overflow-x: auto;\n        }\n\n        #contentIframe {\n            display: none;\n            width: 100%;\n            height: 80vh;\n            border: none;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"app-layout\">\n        <!-- Sidebar -->\n        <div class=\"sidebar\">\n            <div class=\"sidebar-header\">\n                <div class=\"sidebar-logo\">EnviaZap</div>\n            </div>\n            <nav class=\"sidebar-menu\">\n                <a href=\"https://n8n.typebot.pro/webhook/dashboard\" class=\"menu-item active\">\n                    <span class=\"menu-icon\">📊</span>\n                    <span class=\"menu-text\">Dashboard</span>\n                </a>\n                <a href=\"https://n8n.typebot.pro/webhook/historico-disparos\" class=\"menu-item\">\n                    <span class=\"menu-icon\">📋</span>\n                    <span class=\"menu-text\">Histórico de disparos</span>\n                </a>\n                <a href=\"https://n8n.typebot.pro/webhook/conectar\" class=\"menu-item\">\n                    <span class=\"menu-icon\">🔗</span>\n                    <span class=\"menu-text\">Nova Conexão</span>\n                </a>\n                <a href=\"https://n8n.typebot.pro/webhook/conexoes\" class=\"menu-item\">\n                    <span class=\"menu-icon\">📱</span>\n                    <span class=\"menu-text\">Conexões</span>\n                </a>\n                <a href=\"https://n8n.typebot.pro/webhook/disparos-individuais\" class=\"menu-item\">\n                    <span class=\"menu-icon\">💬</span>\n                    <span class=\"menu-text\">Disparos individuais</span>\n                </a>\n                <a href=\"https://n8n.typebot.pro/webhook/disparos-grupos\" class=\"menu-item\">\n                    <span class=\"menu-icon\">👥</span>\n                    <span class=\"menu-text\">Disparos em grupo</span>\n                </a>\n            </nav>\n        </div>\n\n        <!-- Iframe para conteúdo -->\n        <iframe id=\"contentIframe\"></iframe>\n    </div>\n\n    <script>\n        const menuLinks = document.querySelectorAll('.menu-item');\n        const iframe = document.getElementById('contentIframe');\n\n        menuLinks.forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault(); // previne navegação padrão\n\n                // Atualiza src do iframe\n                iframe.src = this.href;\n                iframe.style.display = 'block'; // mostra o iframe\n\n                // Atualiza item ativo\n                menuLinks.forEach(l => l.classList.remove('active'));\n                this.classList.add('active');\n            });\n        });\n\n        // Opcional: carregar o dashboard automaticamente ao abrir a página\n        window.addEventListener('DOMContentLoaded', () => {\n            const activeLink = document.querySelector('.menu-item.active');\n            if (activeLink) {\n                iframe.src = activeLink.href;\n                iframe.style.display = 'block';\n            }\n        });\n    </script>\n</body>\n</html>\n"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-6528,-2096],"id":"28082cbd-1ce1-4e4c-8695-74a7e6e4281c","name":"HTML9"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Dashboard - EnviaZap</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            color: white;\n            min-height: 100vh;\n            margin: 0;\n            padding: 0;\n        }\n\n        .app-layout {\n            display: flex;\n            min-height: 100vh;\n        }\n\n        /* Sidebar */\n        .sidebar {\n            width: 70px;\n            background: rgba(0, 0, 0, 0.3);\n            backdrop-filter: blur(10px);\n            border-right: 1px solid rgba(255, 255, 255, 0.1);\n            transition: all 0.3s ease;\n            position: relative;\n            z-index: 1000;\n        }\n\n        .sidebar:hover {\n            width: 250px;\n        }\n\n        .sidebar-header {\n            padding: 20px;\n            text-align: center;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .sidebar-logo {\n            font-size: 1.5rem;\n            font-weight: 600;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n            white-space: nowrap;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .sidebar-logo {\n            opacity: 1;\n        }\n\n        .sidebar-menu {\n            padding: 20px 0;\n        }\n\n        .menu-item {\n            display: flex;\n            align-items: center;\n            padding: 15px 20px;\n            color: #ccc;\n            text-decoration: none;\n            transition: all 0.3s ease;\n            position: relative;\n            white-space: nowrap;\n        }\n\n        .menu-item:hover {\n            background: rgba(37, 211, 102, 0.1);\n            color: #25d366;\n        }\n\n        .menu-item.active {\n            background: rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            border-right: 3px solid #25d366;\n        }\n\n        .menu-icon {\n            font-size: 1.2rem;\n            width: 30px;\n            text-align: center;\n            flex-shrink: 0;\n        }\n\n        .menu-text {\n            margin-left: 15px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .menu-text {\n            opacity: 1;\n        }\n\n        /* Main content */\n        .main-content {\n            flex: 1;\n            padding: 30px;\n            overflow-x: auto;\n        }\n\n        .header {\n            margin-bottom: 40px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .header-info h1 {\n            font-size: 2.5rem;\n            font-weight: 600;\n            margin-bottom: 10px;\n        }\n\n        .header-info p {\n            color: #888;\n            font-size: 1.1rem;\n        }\n\n        .header-actions {\n            display: flex;\n            gap: 15px;\n        }\n\n        .btn-refresh {\n            padding: 12px 20px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            font-size: 0.9rem;\n        }\n\n        .btn-refresh:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);\n        }\n\n        .btn-refresh:disabled {\n            background: #444;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        /* Filters */\n        .filters-container {\n            display: flex;\n            gap: 15px;\n            margin-bottom: 30px;\n            flex-wrap: wrap;\n            align-items: center;\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            padding: 20px;\n            backdrop-filter: blur(10px);\n        }\n\n        .filter-group {\n            display: flex;\n            flex-direction: column;\n            gap: 5px;\n        }\n\n        .filter-label {\n            font-size: 0.9rem;\n            color: #888;\n            font-weight: 500;\n        }\n\n        .filter-select, .filter-input {\n            padding: 10px 15px;\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 8px;\n            color: white;\n            font-size: 0.9rem;\n            min-width: 120px;\n            transition: all 0.3s ease;\n        }\n\n        .filter-select:focus, .filter-input:focus {\n            outline: none;\n            border-color: rgba(37, 211, 102, 0.5);\n            box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);\n        }\n\n        .filter-select option {\n            background: #1a1a1a;\n            color: white;\n        }\n\n        .date-range-buttons {\n            display: flex;\n            gap: 8px;\n        }\n\n        .btn-date-range {\n            padding: 8px 16px;\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 6px;\n            color: #888;\n            font-size: 0.8rem;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            white-space: nowrap;\n        }\n\n        .btn-date-range:hover {\n            background: rgba(37, 211, 102, 0.1);\n            color: #25d366;\n        }\n\n        .btn-date-range.active {\n            background: rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            border-color: rgba(37, 211, 102, 0.3);\n        }\n\n        /* Stats Cards */\n        .stats-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n        }\n\n        .stat-card {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 16px;\n            backdrop-filter: blur(10px);\n            padding: 25px;\n            transition: all 0.3s ease;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .stat-card:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.1);\n        }\n\n        .stat-card::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 3px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n        }\n\n        .stat-header {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            margin-bottom: 15px;\n        }\n\n        .stat-title {\n            font-size: 0.9rem;\n            color: #888;\n            font-weight: 500;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        .stat-icon {\n            font-size: 1.5rem;\n            opacity: 0.7;\n        }\n\n        .stat-value {\n            font-size: 2.5rem;\n            font-weight: 700;\n            margin-bottom: 10px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n        }\n\n        .stat-change {\n            font-size: 0.8rem;\n            display: flex;\n            align-items: center;\n            gap: 5px;\n        }\n\n        .stat-change.positive {\n            color: #34c759;\n        }\n\n        .stat-change.negative {\n            color: #ff3b30;\n        }\n\n        .stat-change.neutral {\n            color: #888;\n        }\n\n        /* Chart Container */\n        .chart-container {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 16px;\n            backdrop-filter: blur(10px);\n            padding: 30px;\n            margin-bottom: 30px;\n        }\n\n        .chart-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 30px;\n        }\n\n        .chart-title {\n            font-size: 1.5rem;\n            font-weight: 600;\n            color: #fff;\n        }\n\n        .chart-subtitle {\n            font-size: 0.9rem;\n            color: #888;\n            margin-top: 5px;\n        }\n\n        #chartCanvas {\n            width: 100%;\n            max-height: 400px;\n        }\n\n        /* Loading state */\n        .loading-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            min-height: 400px;\n            gap: 20px;\n        }\n\n        .loading-spinner {\n            width: 60px;\n            height: 60px;\n            border: 4px solid rgba(37, 211, 102, 0.3);\n            border-top: 4px solid #25d366;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n\n        .loading-text {\n            color: #25d366;\n            font-size: 1.2rem;\n            font-weight: 500;\n        }\n\n        /* Error/Success messages */\n        .error-message, .success-message {\n            padding: 20px;\n            border-radius: 12px;\n            margin: 20px 0;\n            text-align: center;\n        }\n\n        .error-message {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n        }\n\n        .success-message {\n            background: rgba(52, 199, 89, 0.1);\n            border: 1px solid rgba(52, 199, 89, 0.3);\n            color: #34c759;\n        }\n\n        /* Animations */\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(20px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n\n        .stats-grid, .chart-container {\n            animation: fadeIn 0.5s ease-out;\n        }\n\n        /* Responsive */\n        @media (max-width: 768px) {\n            .main-content {\n                padding: 20px;\n            }\n\n            .header {\n                flex-direction: column;\n                align-items: flex-start;\n                gap: 20px;\n            }\n\n            .header-info h1 {\n                font-size: 2rem;\n            }\n\n            .sidebar {\n                width: 60px;\n            }\n\n            .sidebar:hover {\n                width: 200px;\n            }\n\n            .stats-grid {\n                grid-template-columns: 1fr;\n            }\n\n            .filters-container {\n                flex-direction: column;\n                align-items: stretch;\n            }\n\n            .date-range-buttons {\n                justify-content: center;\n            }\n        }\n    </style>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js\"></script>\n</head>\n<body>\n    <div class=\"app-layout\">\n        \n\n        <!-- Main Content -->\n        <div class=\"main-content\">\n            <div class=\"header\">\n                <div class=\"header-info\">\n                    <h1>Dashboard</h1>\n                    <p>Acompanhe suas métricas e performance em tempo real</p>\n                </div>\n                <div class=\"header-actions\">\n                    <button class=\"btn-refresh\" id=\"btnAtualizar\">\n                        🔄 Atualizar\n                    </button>\n                </div>\n            </div>\n\n            <!-- Loading State -->\n            <div class=\"loading-container\" id=\"loadingContainer\">\n                <div class=\"loading-spinner\"></div>\n                <div class=\"loading-text\">Carregando dashboard...</div>\n            </div>\n\n            <!-- Error Message -->\n            <div class=\"error-message\" id=\"errorMessage\" style=\"display: none;\"></div>\n\n            <!-- Success Message -->\n            <div class=\"success-message\" id=\"successMessage\" style=\"display: none;\"></div>\n\n            <!-- Filters -->\n            <div class=\"filters-container\" id=\"filtersContainer\" style=\"display: none;\">\n                <div class=\"filter-group\">\n                    <label class=\"filter-label\">Período</label>\n                    <div class=\"date-range-buttons\">\n                        <button class=\"btn-date-range active\" data-days=\"7\">7 dias</button>\n                        <button class=\"btn-date-range\" data-days=\"14\">14 dias</button>\n                        <button class=\"btn-date-range\" data-days=\"30\">30 dias</button>\n                    </div>\n                </div>\n                <div class=\"filter-group\">\n                    <label class=\"filter-label\">Data Inicial</label>\n                    <input type=\"date\" class=\"filter-input\" id=\"dataInicial\">\n                </div>\n                <div class=\"filter-group\">\n                    <label class=\"filter-label\">Data Final</label>\n                    <input type=\"date\" class=\"filter-input\" id=\"dataFinal\">\n                </div>\n            </div>\n\n            <!-- Stats Cards -->\n            <div class=\"stats-grid\" id=\"statsGrid\" style=\"display: none;\">\n                <div class=\"stat-card\">\n                    <div class=\"stat-header\">\n                        <div class=\"stat-title\">Total de Disparos</div>\n                        <div class=\"stat-icon\">📤</div>\n                    </div>\n                    <div class=\"stat-value\" id=\"totalDisparos\">0</div>\n                    <div class=\"stat-change\" id=\"changeDisparos\">\n                        <span>+0%</span> vs período anterior\n                    </div>\n                </div>\n\n                <div class=\"stat-card\">\n                    <div class=\"stat-header\">\n                        <div class=\"stat-title\">Conexões Ativas</div>\n                        <div class=\"stat-icon\">🟢</div>\n                    </div>\n                    <div class=\"stat-value\" id=\"conexoesAtivas\">0</div>\n                    <div class=\"stat-change\" id=\"changeConexoesAtivas\">\n                        <span>+0%</span> vs período anterior\n                    </div>\n                </div>\n\n                <div class=\"stat-card\">\n                    <div class=\"stat-header\">\n                        <div class=\"stat-title\">Total de Conexões</div>\n                        <div class=\"stat-icon\">📱</div>\n                    </div>\n                    <div class=\"stat-value\" id=\"totalConexoes\">0</div>\n                    <div class=\"stat-change\" id=\"changeTotalConexoes\">\n                        <span>+0%</span> vs período anterior\n                    </div>\n                </div>\n\n                <div class=\"stat-card\">\n                    <div class=\"stat-header\">\n                        <div class=\"stat-title\">Média por Conexão</div>\n                        <div class=\"stat-icon\">📊</div>\n                    </div>\n                    <div class=\"stat-value\" id=\"mediaPorConexao\">0</div>\n                    <div class=\"stat-change\" id=\"changeMediaConexao\">\n                        <span>+0%</span> vs período anterior\n                    </div>\n                </div>\n            </div>\n\n            <!-- Chart -->\n            <div class=\"chart-container\" id=\"chartContainer\" style=\"display: none;\">\n                <div class=\"chart-header\">\n                    <div>\n                        <div class=\"chart-title\">Disparos por Dia</div>\n                        <div class=\"chart-subtitle\">Acompanhe a evolução dos seus disparos ao longo do tempo</div>\n                    </div>\n                </div>\n                <canvas id=\"chartCanvas\"></canvas>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Variáveis globais\n        let dashboardData = {};\n        let chart = null;\n        let currentPeriod = 7; // Padrão: 7 dias\n\n        // Funções de UI\n        function showError(message) {\n            const errorEl = document.getElementById('errorMessage');\n            errorEl.textContent = message;\n            errorEl.style.display = 'block';\n            setTimeout(() => {\n                errorEl.style.display = 'none';\n            }, 5000);\n        }\n\n        function showSuccess(message) {\n            const successEl = document.getElementById('successMessage');\n            successEl.textContent = message;\n            successEl.style.display = 'block';\n            setTimeout(() => {\n                successEl.style.display = 'none';\n            }, 3000);\n        }\n\n        function hideLoading() {\n            document.getElementById('loadingContainer').style.display = 'none';\n        }\n\n        function showDashboard() {\n            document.getElementById('filtersContainer').style.display = 'flex';\n            document.getElementById('statsGrid').style.display = 'grid';\n            document.getElementById('chartContainer').style.display = 'block';\n        }\n\n        // Gerar dados fictícios para demonstração\n        function generateDemoData(days) {\n            const isClaudeEnvironment = window.location.hostname.includes('claude.ai') || \n                                      window.location.hostname.includes('anthropic') ||\n                                      window.location.protocol === 'blob:';\n                                      \n            if (!isClaudeEnvironment) {\n                return null;\n            }\n\n            console.log(`Gerando dados demo para ${days} dias`);\n            \n            const data = {\n                totalDisparos: 0,\n                conexoesAtivas: Math.floor(Math.random() * 8) + 3, // 3-10\n                totalConexoes: Math.floor(Math.random() * 5) + 8, // 8-12\n                mediaDisparosPorConexao: 0,\n                disparosPorDia: [],\n                estatisticas: {\n                    changeDisparos: (Math.random() * 40 - 20).toFixed(1), // -20% a +20%\n                    changeConexoesAtivas: (Math.random() * 30 - 15).toFixed(1),\n                    changeTotalConexoes: (Math.random() * 20 - 10).toFixed(1),\n                    changeMediaConexao: (Math.random() * 35 - 17.5).toFixed(1)\n                }\n            };\n\n            // Gerar dados por dia\n            const today = new Date();\n            for (let i = days - 1; i >= 0; i--) {\n                const date = new Date(today);\n                date.setDate(date.getDate() - i);\n                \n                const disparosNoDia = Math.floor(Math.random() * 200) + 50; // 50-250 disparos por dia\n                data.totalDisparos += disparosNoDia;\n                \n                data.disparosPorDia.push({\n                    data: date.toISOString().split('T')[0],\n                    dataFormatada: date.toLocaleDateString('pt-BR'),\n                    disparos: disparosNoDia\n                });\n            }\n\n            // Calcular média por conexão\n            data.mediaDisparosPorConexao = data.totalConexoes > 0 ? \n                Math.round(data.totalDisparos / data.totalConexoes) : 0;\n\n            console.log('Dados demo gerados:', data);\n            return data;\n        }\n\n        // Verificar status de conexão de uma instância\n        async function verificarStatusConexao(instanceName, apikey) {\n            try {\n                const response = await fetch(`https://whatsapi.typebot.pro/instance/connectionState/${instanceName}`, {\n                    method: 'GET',\n                    headers: {\n                        'apikey': apikey\n                    }\n                });\n\n                if (!response.ok) {\n                    console.log(`Erro ao verificar status da instância ${instanceName}:`, response.status);\n                    return false;\n                }\n\n                const data = await response.json();\n                console.log(`Status da instância ${instanceName}:`, data);\n                \n                // Consideramos conectada se o estado é 'open' ou similar\n                return data.state === 'open' || data.instance?.state === 'open';\n            } catch (error) {\n                console.error(`Erro ao verificar conexão ${instanceName}:`, error);\n                return false;\n            }\n        }\n\n        // Processar dados da API\n        async function processarDadosAPI(apiData) {\n            console.log('Processando dados da API:', apiData);\n            console.log('Tipo da resposta:', typeof apiData);\n            console.log('É array?', Array.isArray(apiData));\n            \n            // Verificar e extrair dados de forma segura\n            let dados = {};\n            let disparos = [];\n            let conexoes = [];\n            \n            try {\n                // Caso 1: Resposta é array com objeto dentro: [{\"disparos\": [...], \"conexoes\": [...]}]\n                if (Array.isArray(apiData) && apiData.length > 0 && apiData[0]) {\n                    dados = apiData[0];\n                    console.log('Dados extraídos do array:', dados);\n                }\n                // Caso 2: Resposta é objeto direto: {\"disparos\": [...], \"conexoes\": [...]}\n                else if (apiData && typeof apiData === 'object' && !Array.isArray(apiData)) {\n                    dados = apiData;\n                    console.log('Dados são objeto direto:', dados);\n                }\n                // Caso 3: Resposta tem estrutura diferente\n                else {\n                    console.error('Estrutura de resposta não reconhecida:', apiData);\n                    throw new Error('Formato de resposta da API não reconhecido');\n                }\n                \n                // Extrair disparos e conexões de forma segura\n                disparos = dados.disparos || [];\n                conexoes = dados.conexoes || [];\n                \n                console.log('Disparos extraídos:', disparos.length);\n                console.log('Conexões extraídas:', conexoes.length);\n                \n                if (!Array.isArray(disparos)) {\n                    console.warn('Disparos não é array, convertendo:', disparos);\n                    disparos = [];\n                }\n                \n                if (!Array.isArray(conexoes)) {\n                    console.warn('Conexões não é array, convertendo:', conexoes);\n                    conexoes = [];\n                }\n                \n            } catch (error) {\n                console.error('Erro ao processar estrutura da API:', error);\n                console.log('Dados recebidos completos:', JSON.stringify(apiData, null, 2));\n                throw new Error('Erro ao processar dados da API: ' + error.message);\n            }\n\n            // Calcular datas do período atual\n            const hoje = new Date();\n            const dataInicial = new Date();\n            dataInicial.setDate(hoje.getDate() - currentPeriod);\n\n            console.log(`Período selecionado: ${currentPeriod} dias`);\n            console.log(`Data inicial: ${dataInicial.toISOString().split('T')[0]}`);\n            console.log(`Data final: ${hoje.toISOString().split('T')[0]}`);\n\n            // Filtrar disparos do período\n            const disparosPeriodo = disparos.filter(disparo => {\n                if (!disparo || !disparo.created_at) {\n                    console.warn('Disparo sem data:', disparo);\n                    return false;\n                }\n                const dataDisparo = new Date(disparo.created_at);\n                return dataDisparo >= dataInicial && dataDisparo <= hoje;\n            });\n\n            console.log(`Disparos no período de ${currentPeriod} dias:`, disparosPeriodo.length);\n\n            // Verificar conexões ativas (com tratamento de erro)\n            let conexoesAtivas = 0;\n            const verificacoes = conexoes.map(async (conexao) => {\n                try {\n                    if (conexao && conexao.Apikey && conexao.instanceName) {\n                        const ativa = await verificarStatusConexao(conexao.instanceName, conexao.Apikey);\n                        if (ativa) conexoesAtivas++;\n                        return ativa;\n                    }\n                    return false;\n                } catch (error) {\n                    console.warn(`Erro ao verificar conexão ${conexao?.instanceName}:`, error);\n                    return false;\n                }\n            });\n\n            try {\n                // Aguardar todas as verificações com timeout\n                await Promise.race([\n                    Promise.all(verificacoes),\n                    new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 10000))\n                ]);\n            } catch (error) {\n                console.warn('Erro ou timeout na verificação de conexões:', error);\n                // Continuar sem verificação de status, considerando apenas conexões com Apikey\n                conexoesAtivas = conexoes.filter(c => c && c.Apikey && c.instanceName).length;\n            }\n\n            console.log('Conexões ativas encontradas:', conexoesAtivas);\n\n            // Calcular totais\n            const totalDisparos = disparosPeriodo.reduce((total, disparo) => {\n                const mensagens = disparo.MensagensDisparadas || 0;\n                return total + mensagens;\n            }, 0);\n\n            const totalConexoes = conexoes.length;\n            const mediaDisparosPorConexao = totalConexoes > 0 ? Math.round(totalDisparos / totalConexoes) : 0;\n\n            console.log('Métricas calculadas:', {\n                totalDisparos,\n                conexoesAtivas,\n                totalConexoes,\n                mediaDisparosPorConexao\n            });\n\n            // Agrupar disparos por dia\n            const disparosPorDia = {};\n            \n            // Inicializar todos os dias do período com 0\n            for (let i = currentPeriod - 1; i >= 0; i--) {\n                const data = new Date();\n                data.setDate(data.getDate() - i);\n                const dataStr = data.toISOString().split('T')[0];\n                disparosPorDia[dataStr] = 0;\n            }\n\n            // Contar disparos por dia\n            disparosPeriodo.forEach(disparo => {\n                try {\n                    const dataDisparo = new Date(disparo.created_at).toISOString().split('T')[0];\n                    if (disparosPorDia.hasOwnProperty(dataDisparo)) {\n                        disparosPorDia[dataDisparo] += disparo.MensagensDisparadas || 0;\n                    }\n                } catch (error) {\n                    console.warn('Erro ao processar data do disparo:', disparo.created_at, error);\n                }\n            });\n\n            // Converter para array ordenado\n            const disparosPorDiaArray = Object.keys(disparosPorDia)\n                .sort()\n                .map(data => {\n                    try {\n                        return {\n                            data: data,\n                            dataFormatada: new Date(data + 'T00:00:00').toLocaleDateString('pt-BR'),\n                            disparos: disparosPorDia[data]\n                        };\n                    } catch (error) {\n                        console.warn('Erro ao formatar data:', data, error);\n                        return {\n                            data: data,\n                            dataFormatada: data,\n                            disparos: disparosPorDia[data]\n                        };\n                    }\n                });\n\n            console.log('Disparos por dia:', disparosPorDiaArray);\n\n            // Calcular período anterior para comparação\n            const dataInicialAnterior = new Date(dataInicial);\n            dataInicialAnterior.setDate(dataInicialAnterior.getDate() - currentPeriod);\n            const dataFinalAnterior = new Date(dataInicial);\n            dataFinalAnterior.setDate(dataFinalAnterior.getDate() - 1);\n\n            const disparosPeriodoAnterior = disparos.filter(disparo => {\n                if (!disparo || !disparo.created_at) return false;\n                try {\n                    const dataDisparo = new Date(disparo.created_at);\n                    return dataDisparo >= dataInicialAnterior && dataDisparo <= dataFinalAnterior;\n                } catch (error) {\n                    console.warn('Erro ao processar data para período anterior:', disparo.created_at);\n                    return false;\n                }\n            });\n\n            const totalDisparosAnterior = disparosPeriodoAnterior.reduce((total, disparo) => {\n                return total + (disparo.MensagensDisparadas || 0);\n            }, 0);\n\n            // Calcular mudanças percentuais\n            const calcularMudancaPercentual = (atual, anterior) => {\n                if (anterior === 0) return atual > 0 ? 100 : 0;\n                return ((atual - anterior) / anterior * 100).toFixed(1);\n            };\n\n            const estatisticas = {\n                changeDisparos: calcularMudancaPercentual(totalDisparos, totalDisparosAnterior),\n                changeConexoesAtivas: '0.0', // Para conexões ativas, seria necessário histórico\n                changeTotalConexoes: '0.0', // Para total de conexões, seria necessário histórico\n                changeMediaConexao: calcularMudancaPercentual(mediaDisparosPorConexao, \n                    totalConexoes > 0 ? Math.round(totalDisparosAnterior / totalConexoes) : 0)\n            };\n\n            console.log('Estatísticas de mudança:', estatisticas);\n\n            const resultado = {\n                totalDisparos,\n                conexoesAtivas,\n                totalConexoes,\n                mediaDisparosPorConexao,\n                disparosPorDia: disparosPorDiaArray,\n                estatisticas\n            };\n\n            console.log('Dados finais processados:', resultado);\n            return resultado;\n        }\n\n        // Carregar dados do dashboard\n        async function carregarDashboard() {\n            console.log('=== CARREGANDO DASHBOARD ===');\n\n            try {\n                // Verificar se é ambiente de demo\n                const isClaudeEnvironment = window.location.hostname.includes('claude.ai') || \n                                          window.location.hostname.includes('anthropic') ||\n                                          window.location.protocol === 'blob:';\n\n                if (isClaudeEnvironment) {\n                    console.log('=== MODO DEMONSTRAÇÃO ===');\n                    \n                    const demoData = generateDemoData(currentPeriod);\n                    \n                    // Simular delay de loading\n                    await new Promise(resolve => setTimeout(resolve, 1500));\n                    \n                    dashboardData = demoData;\n                    console.log('Dados demo carregados:', dashboardData);\n                    \n                    hideLoading();\n                    showDashboard();\n                    renderDashboard();\n                    return;\n                }\n                \n                console.log('=== MODO PRODUÇÃO ===');\n                console.log('Fazendo requisição para API...');\n                \n                // Fazer requisição real para a API sem userId\n                const response = await fetch('https://n8n.typebot.pro/webhook/dados-dashboard', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({})\n                });\n\n                console.log('Status da resposta:', response.status);\n                console.log('Headers da resposta:', Object.fromEntries(response.headers.entries()));\n\n                if (!response.ok) {\n                    const errorText = await response.text();\n                    console.error('Erro na resposta:', errorText);\n                    throw new Error(`Erro ${response.status}: ${response.statusText}`);\n                }\n\n                const apiData = await response.json();\n                console.log('=== DADOS BRUTOS DA API ===');\n                console.log('Tipo:', typeof apiData);\n                console.log('É array:', Array.isArray(apiData));\n                console.log('Dados completos:', JSON.stringify(apiData, null, 2));\n\n                // Processar dados da API\n                dashboardData = await processarDadosAPI(apiData);\n                console.log('=== DADOS PROCESSADOS ===');\n                console.log('Dashboard data final:', dashboardData);\n                \n                hideLoading();\n                showDashboard();\n                renderDashboard();\n\n            } catch (error) {\n                console.error('ERRO ao carregar dashboard:', error);\n                hideLoading();\n                showError('Erro ao carregar dashboard: ' + error.message);\n            }\n        }\n\n        // Renderizar dados no dashboard\n        function renderDashboard() {\n            console.log('Renderizando dashboard com dados:', dashboardData);\n            \n            // Atualizar cards de estatísticas\n            document.getElementById('totalDisparos').textContent = dashboardData.totalDisparos.toLocaleString('pt-BR');\n            document.getElementById('conexoesAtivas').textContent = dashboardData.conexoesAtivas.toLocaleString('pt-BR');\n            document.getElementById('totalConexoes').textContent = dashboardData.totalConexoes.toLocaleString('pt-BR');\n            document.getElementById('mediaPorConexao').textContent = dashboardData.mediaDisparosPorConexao.toLocaleString('pt-BR');\n\n            // Atualizar mudanças percentuais\n            if (dashboardData.estatisticas) {\n                updateChangeIndicator('changeDisparos', dashboardData.estatisticas.changeDisparos);\n                updateChangeIndicator('changeConexoesAtivas', dashboardData.estatisticas.changeConexoesAtivas);\n                updateChangeIndicator('changeTotalConexoes', dashboardData.estatisticas.changeTotalConexoes);\n                updateChangeIndicator('changeMediaConexao', dashboardData.estatisticas.changeMediaConexao);\n            }\n\n            // Renderizar gráfico\n            renderChart();\n        }\n\n        // Atualizar indicadores de mudança\n        function updateChangeIndicator(elementId, change) {\n            const element = document.getElementById(elementId);\n            const changeValue = parseFloat(change);\n            const span = element.querySelector('span');\n            \n            span.textContent = `${changeValue >= 0 ? '+' : ''}${changeValue}%`;\n            \n            // Remover classes existentes\n            element.classList.remove('positive', 'negative', 'neutral');\n            \n            // Adicionar classe apropriada\n            if (changeValue > 0) {\n                element.classList.add('positive');\n            } else if (changeValue < 0) {\n                element.classList.add('negative');\n            } else {\n                element.classList.add('neutral');\n            }\n        }\n\n        // Renderizar gráfico de linha\n        function renderChart() {\n            const ctx = document.getElementById('chartCanvas').getContext('2d');\n            \n            // Destruir gráfico anterior se existir\n            if (chart) {\n                chart.destroy();\n            }\n\n            const labels = dashboardData.disparosPorDia.map(item => item.dataFormatada);\n            const data = dashboardData.disparosPorDia.map(item => item.disparos);\n\n            chart = new Chart(ctx, {\n                type: 'line',\n                data: {\n                    labels: labels,\n                    datasets: [{\n                        label: 'Disparos por Dia',\n                        data: data,\n                        borderColor: '#25d366',\n                        backgroundColor: 'rgba(37, 211, 102, 0.1)',\n                        borderWidth: 3,\n                        fill: true,\n                        tension: 0.4,\n                        pointBackgroundColor: '#25d366',\n                        pointBorderColor: '#ffffff',\n                        pointBorderWidth: 2,\n                        pointRadius: 6,\n                        pointHoverRadius: 8,\n                        pointHoverBackgroundColor: '#25d366',\n                        pointHoverBorderColor: '#ffffff',\n                        pointHoverBorderWidth: 3\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            display: false\n                        },\n                        tooltip: {\n                            backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                            titleColor: '#ffffff',\n                            bodyColor: '#ffffff',\n                            borderColor: '#25d366',\n                            borderWidth: 1,\n                            cornerRadius: 8,\n                            displayColors: false,\n                            callbacks: {\n                                label: function(context) {\n                                    return `${context.parsed.y.toLocaleString('pt-BR')} disparos`;\n                                }\n                            }\n                        }\n                    },\n                    scales: {\n                        x: {\n                            grid: {\n                                color: 'rgba(255, 255, 255, 0.1)',\n                                borderColor: 'rgba(255, 255, 255, 0.2)'\n                            },\n                            ticks: {\n                                color: '#888',\n                                font: {\n                                    size: 12\n                                }\n                            }\n                        },\n                        y: {\n                            beginAtZero: true,\n                            grid: {\n                                color: 'rgba(255, 255, 255, 0.1)',\n                                borderColor: 'rgba(255, 255, 255, 0.2)'\n                            },\n                            ticks: {\n                                color: '#888',\n                                font: {\n                                    size: 12\n                                },\n                                callback: function(value) {\n                                    return value.toLocaleString('pt-BR');\n                                }\n                            }\n                        }\n                    },\n                    interaction: {\n                        intersect: false,\n                        mode: 'index'\n                    },\n                    elements: {\n                        point: {\n                            hoverRadius: 8\n                        }\n                    }\n                }\n            });\n        }\n\n        // Configurar filtros de data\n        function setupDateFilters() {\n            // Configurar datas padrão (últimos 7 dias)\n            const hoje = new Date();\n            const dataInicial = new Date();\n            dataInicial.setDate(hoje.getDate() - 7);\n\n            document.getElementById('dataInicial').value = dataInicial.toISOString().split('T')[0];\n            document.getElementById('dataFinal').value = hoje.toISOString().split('T')[0];\n\n            // Event listeners para botões de período pré-definido\n            const dateRangeButtons = document.querySelectorAll('.btn-date-range');\n            dateRangeButtons.forEach(button => {\n                button.addEventListener('click', function() {\n                    // Remover active de todos os botões\n                    dateRangeButtons.forEach(btn => btn.classList.remove('active'));\n                    // Adicionar active ao botão clicado\n                    this.classList.add('active');\n                    \n                    const days = parseInt(this.dataset.days);\n                    currentPeriod = days;\n                    \n                    // Atualizar campos de data\n                    const hoje = new Date();\n                    const dataInicial = new Date();\n                    dataInicial.setDate(hoje.getDate() - days);\n                    \n                    document.getElementById('dataInicial').value = dataInicial.toISOString().split('T')[0];\n                    document.getElementById('dataFinal').value = hoje.toISOString().split('T')[0];\n                    \n                    // Recarregar dados\n                    recarregarDashboard();\n                });\n            });\n\n            // Event listeners para campos de data personalizados\n            document.getElementById('dataInicial').addEventListener('change', function() {\n                // Remover active de todos os botões quando usar data personalizada\n                dateRangeButtons.forEach(btn => btn.classList.remove('active'));\n                \n                const dataInicial = new Date(this.value);\n                const dataFinal = new Date(document.getElementById('dataFinal').value);\n                const diffTime = Math.abs(dataFinal - dataInicial);\n                currentPeriod = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n                \n                recarregarDashboard();\n            });\n\n            document.getElementById('dataFinal').addEventListener('change', function() {\n                // Remover active de todos os botões quando usar data personalizada\n                dateRangeButtons.forEach(btn => btn.classList.remove('active'));\n                \n                const dataInicial = new Date(document.getElementById('dataInicial').value);\n                const dataFinal = new Date(this.value);\n                const diffTime = Math.abs(dataFinal - dataInicial);\n                currentPeriod = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n                \n                recarregarDashboard();\n            });\n        }\n\n        // Recarregar dashboard\n        async function recarregarDashboard() {\n            console.log('Recarregando dashboard...');\n            \n            // Mostrar loading nos cards\n            document.getElementById('totalDisparos').textContent = '...';\n            document.getElementById('conexoesAtivas').textContent = '...';\n            document.getElementById('totalConexoes').textContent = '...';\n            document.getElementById('mediaPorConexao').textContent = '...';\n            \n            await carregarDashboard();\n        }\n\n        // Atualizar dashboard\n        async function atualizarDashboard() {\n            const btnAtualizar = document.getElementById('btnAtualizar');\n            btnAtualizar.disabled = true;\n            btnAtualizar.innerHTML = '🔄 Atualizando...';\n\n            try {\n                await carregarDashboard();\n                showSuccess('Dashboard atualizado com sucesso!');\n            } catch (error) {\n                showError('Erro ao atualizar dashboard: ' + error.message);\n            } finally {\n                btnAtualizar.disabled = false;\n                btnAtualizar.innerHTML = '🔄 Atualizar';\n            }\n        }\n\n        // Event listeners para navegação\n        function setupNavigation() {\n            // Dashboard - não faz nada pois já é a página atual\n            const dashboardLink = document.querySelector('.menu-item.active');\n            if (dashboardLink) {\n                dashboardLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    // Não faz nada - já está no dashboard\n                    console.log('Já na página do dashboard');\n                });\n            }\n\n            // Histórico de disparos\n            const historicoLink = document.getElementById('historicoLink');\n            if (historicoLink) {\n                historicoLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/historico-disparos';\n                });\n            }\n\n            // Nova conexão\n            const novaConexaoLink = document.getElementById('novaConexaoLink');\n            if (novaConexaoLink) {\n                novaConexaoLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/conectar';\n                });\n            }\n\n            // Conexões\n            const conexoesLink = document.getElementById('conexoesLink');\n            if (conexoesLink) {\n                conexoesLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/conexoes';\n                });\n            }\n\n            // Disparos individuais\n            const disparosIndividuaisLink = document.getElementById('disparosIndividuaisLink');\n            if (disparosIndividuaisLink) {\n                disparosIndividuaisLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/disparos-individuais';\n                });\n            }\n\n            // Disparos em grupo\n            const disparosGruposLink = document.getElementById('disparosGruposLink');\n            if (disparosGruposLink) {\n                disparosGruposLink.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    window.location.href = 'https://n8n.typebot.pro/webhook/disparos-grupos';\n                });\n            }\n\n            // Event listener para botão atualizar\n            const btnAtualizar = document.getElementById('btnAtualizar');\n            if (btnAtualizar) {\n                btnAtualizar.addEventListener('click', atualizarDashboard);\n            }\n        }\n\n        // Inicialização\n        async function inicializarPagina() {\n            console.log('Inicializando página do dashboard');\n            setupNavigation();\n            setupDateFilters();\n            await carregarDashboard();\n        }\n\n        // Executar quando o DOM estiver pronto\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', inicializarPagina);\n        } else {\n            inicializarPagina();\n        }\n\n        console.log('=== SCRIPT DO DASHBOARD CARREGADO ===');\n    </script>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-6528,-1792],"id":"5c605fc3-e198-4512-9bfe-020ee286d65c","name":"HTML7"},{"parameters":{"html":"<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Histórico de Disparos - EnviaZap</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            color: white;\n            min-height: 100vh;\n            margin: 0;\n            padding: 0;\n        }\n\n        .app-layout {\n            display: flex;\n            min-height: 100vh;\n        }\n\n        .sidebar {\n            width: 70px;\n            background: rgba(0, 0, 0, 0.3);\n            backdrop-filter: blur(10px);\n            border-right: 1px solid rgba(255, 255, 255, 0.1);\n            transition: all 0.3s ease;\n            position: relative;\n            z-index: 1000;\n        }\n\n        .sidebar:hover {\n            width: 250px;\n        }\n\n        .sidebar-header {\n            padding: 20px;\n            text-align: center;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .sidebar-logo {\n            font-size: 1.5rem;\n            font-weight: 600;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n            white-space: nowrap;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .sidebar-logo {\n            opacity: 1;\n        }\n\n        .sidebar-menu {\n            padding: 20px 0;\n        }\n\n        .menu-item {\n            display: flex;\n            align-items: center;\n            padding: 15px 20px;\n            color: #ccc;\n            text-decoration: none;\n            transition: all 0.3s ease;\n            position: relative;\n            white-space: nowrap;\n        }\n\n        .menu-item:hover {\n            background: rgba(37, 211, 102, 0.1);\n            color: #25d366;\n        }\n\n        .menu-item.active {\n            background: rgba(37, 211, 102, 0.2);\n            color: #25d366;\n            border-right: 3px solid #25d366;\n        }\n\n        .menu-icon {\n            font-size: 1.2rem;\n            width: 30px;\n            text-align: center;\n            flex-shrink: 0;\n        }\n\n        .menu-text {\n            margin-left: 15px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .sidebar:hover .menu-text {\n            opacity: 1;\n        }\n\n        .main-content {\n            flex: 1;\n            padding: 30px;\n            overflow-x: auto;\n        }\n\n        .header {\n            margin-bottom: 40px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .header-info h1 {\n            font-size: 2.5rem;\n            font-weight: 600;\n            margin-bottom: 10px;\n        }\n\n        .header-info p {\n            color: #888;\n            font-size: 1.1rem;\n        }\n\n        .header-actions {\n            display: flex;\n            gap: 15px;\n        }\n\n        .btn-refresh {\n            padding: 12px 20px;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border: none;\n            border-radius: 8px;\n            color: white;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            font-size: 0.9rem;\n        }\n\n        .btn-refresh:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);\n        }\n\n        .btn-refresh:disabled {\n            background: #444;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        .loading-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            min-height: 400px;\n            gap: 20px;\n        }\n\n        .loading-spinner {\n            width: 60px;\n            height: 60px;\n            border: 4px solid rgba(37, 211, 102, 0.3);\n            border-top: 4px solid #25d366;\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n\n        .loading-text {\n            color: #25d366;\n            font-size: 1.2rem;\n            font-weight: 500;\n        }\n\n        .table-container {\n            background: rgba(255, 255, 255, 0.02);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 16px;\n            backdrop-filter: blur(10px);\n            overflow: hidden;\n        }\n\n        .table-wrapper {\n            overflow-x: auto;\n        }\n\n        .disparos-table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n\n        .disparos-table th {\n            background: rgba(255, 255, 255, 0.05);\n            padding: 20px 16px;\n            text-align: left;\n            font-weight: 600;\n            color: #fff;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n            font-size: 0.9rem;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        .disparos-table td {\n            padding: 20px 16px;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n            vertical-align: middle;\n        }\n\n        .disparos-table tr:hover {\n            background: rgba(255, 255, 255, 0.02);\n        }\n\n        .disparos-table tr:last-child td {\n            border-bottom: none;\n        }\n\n        .pill {\n            padding: 6px 12px;\n            border-radius: 20px;\n            font-size: 0.8rem;\n            font-weight: 600;\n            display: inline-block;\n            white-space: nowrap;\n        }\n\n        .pill-individual {\n            background: rgba(52, 199, 89, 0.2);\n            color: #34c759;\n            border: 1px solid rgba(52, 199, 89, 0.3);\n        }\n\n        .pill-grupos {\n            background: rgba(0, 122, 255, 0.2);\n            color: #007aff;\n            border: 1px solid rgba(0, 122, 255, 0.3);\n        }\n\n        .pill-em-andamento {\n            background: rgba(255, 193, 7, 0.2);\n            color: #ffc107;\n            border: 1px solid rgba(255, 193, 7, 0.3);\n        }\n\n        .pill-agendado {\n            background: rgba(175, 82, 222, 0.2);\n            color: #af52de;\n            border: 1px solid rgba(175, 82, 222, 0.3);\n        }\n\n        .pill-enviado {\n            background: rgba(52, 199, 89, 0.2);\n            color: #34c759;\n            border: 1px solid rgba(52, 199, 89, 0.3);\n        }\n\n        .pill-finalizado {\n            background: rgba(52, 199, 89, 0.2);\n            color: #34c759;\n            border: 1px solid rgba(52, 199, 89, 0.3);\n        }\n\n        .pill-cancelado {\n            background: rgba(255, 59, 48, 0.2);\n            color: #ff3b30;\n            border: 1px solid rgba(255, 59, 48, 0.3);\n        }\n\n        .progress-container {\n            width: 120px;\n            height: 8px;\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .progress-bar {\n            height: 100%;\n            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);\n            border-radius: 4px;\n            transition: width 0.3s ease;\n        }\n\n        .progress-text {\n            font-size: 0.8rem;\n            color: #888;\n            margin-top: 4px;\n        }\n\n        .date-cell {\n            color: #ccc;\n            font-size: 0.9rem;\n        }\n\n        .date-time {\n            display: block;\n            color: #888;\n            font-size: 0.8rem;\n            margin-top: 2px;\n        }\n\n        .count-cell {\n            text-align: center;\n            color: #25d366;\n            font-weight: 600;\n        }\n\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: #888;\n        }\n\n        .empty-icon {\n            font-size: 4rem;\n            margin-bottom: 20px;\n            opacity: 0.5;\n        }\n\n        .empty-state h3 {\n            font-size: 1.5rem;\n            margin-bottom: 10px;\n            color: #ccc;\n        }\n\n        .empty-state p {\n            font-size: 1rem;\n            line-height: 1.5;\n        }\n\n        .error-message, .success-message {\n            padding: 20px;\n            border-radius: 12px;\n            margin: 20px 0;\n            text-align: center;\n        }\n\n        .error-message {\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            color: #ff3b30;\n        }\n\n        .success-message {\n            background: rgba(52, 199, 89, 0.1);\n            border: 1px solid rgba(52, 199, 89, 0.3);\n            color: #34c759;\n        }\n\n        .btn-cancelar {\n            padding: 6px 12px;\n            background: rgba(255, 59, 48, 0.1);\n            border: 1px solid rgba(255, 59, 48, 0.3);\n            border-radius: 6px;\n            color: #ff3b30;\n            font-size: 0.8rem;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            white-space: nowrap;\n        }\n\n        .btn-cancelar:hover {\n            background: rgba(255, 59, 48, 0.2);\n            transform: translateY(-1px);\n        }\n\n        .btn-cancelar:disabled {\n            background: #444;\n            color: #888;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        .filters-container {\n            display: flex;\n            gap: 15px;\n            margin-bottom: 25px;\n            flex-wrap: wrap;\n            align-items: center;\n        }\n\n        .filter-group {\n            display: flex;\n            flex-direction: column;\n            gap: 5px;\n        }\n\n        .filter-label {\n            font-size: 0.9rem;\n            color: #888;\n            font-weight: 500;\n        }\n\n        .filter-select {\n            padding: 10px 15px;\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 8px;\n            color: white;\n            font-size: 0.9rem;\n            min-width: 150px;\n            transition: all 0.3s ease;\n        }\n\n        .filter-select:focus {\n            outline: none;\n            border-color: rgba(37, 211, 102, 0.5);\n            box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);\n        }\n\n        .filter-select option {\n            background: #1a1a1a;\n            color: white;\n        }\n\n        .btn-limpar-filtros {\n            padding: 10px 15px;\n            background: rgba(255, 255, 255, 0.05);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            border-radius: 8px;\n            color: #888;\n            font-size: 0.9rem;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            align-self: flex-end;\n        }\n\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(20px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n\n        .table-container {\n            animation: fadeIn 0.5s ease-out;\n        }\n\n        @media (max-width: 768px) {\n            .main-content {\n                padding: 20px;\n            }\n\n            .header {\n                flex-direction: column;\n                align-items: flex-start;\n                gap: 20px;\n            }\n\n            .header-info h1 {\n                font-size: 2rem;\n            }\n\n            .sidebar {\n                width: 60px;\n            }\n\n            .sidebar:hover {\n                width: 200px;\n            }\n\n            .disparos-table {\n                font-size: 0.8rem;\n            }\n\n            .disparos-table th,\n            .disparos-table td {\n                padding: 12px 8px;\n            }\n\n            .progress-container {\n                width: 80px;\n            }\n        }\n\n        @media (max-width: 480px) {\n            .table-wrapper {\n                overflow-x: scroll;\n            }\n            \n            .disparos-table {\n                min-width: 600px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"app-layout\">\n        <div class=\"main-content\">\n            <div class=\"header\">\n                <div class=\"header-info\">\n                    <h1>Histórico de Disparos</h1>\n                    <p>Visualize e acompanhe todos os seus disparos em tempo real</p>\n                </div>\n                <div class=\"header-actions\">\n                    <button class=\"btn-refresh\" id=\"btnAtualizar\">\n                        🔄 Atualizar\n                    </button>\n                </div>\n            </div>\n\n            <div class=\"loading-container\" id=\"loadingContainer\">\n                <div class=\"loading-spinner\"></div>\n                <div class=\"loading-text\">Carregando histórico...</div>\n            </div>\n\n            <div class=\"error-message\" id=\"errorMessage\" style=\"display: none;\"></div>\n            <div class=\"success-message\" id=\"successMessage\" style=\"display: none;\"></div>\n\n            <div class=\"filters-container\" id=\"filtersContainer\" style=\"display: none;\">\n                <div class=\"filter-group\">\n                    <label class=\"filter-label\">Tipo de Disparo</label>\n                    <select class=\"filter-select\" id=\"filtroTipo\">\n                        <option value=\"\">Todos os tipos</option>\n                        <option value=\"Individual\">Individual</option>\n                        <option value=\"Grupos\">Grupos</option>\n                    </select>\n                </div>\n                <div class=\"filter-group\">\n                    <label class=\"filter-label\">Status</label>\n                    <select class=\"filter-select\" id=\"filtroStatus\">\n                        <option value=\"\">Todos os status</option>\n                        <option value=\"Em andamento\">Em andamento</option>\n                        <option value=\"Agendado\">Agendado</option>\n                        <option value=\"Enviado\">Enviado</option>\n                        <option value=\"Finalizado\">Finalizado</option>\n                        <option value=\"Cancelado\">Cancelado</option>\n                    </select>\n                </div>\n                <button class=\"btn-limpar-filtros\" id=\"btnLimparFiltros\">\n                    🗑️ Limpar Filtros\n                </button>\n            </div>\n\n            <div class=\"table-container\" id=\"tableContainer\" style=\"display: none;\">\n                <div class=\"table-wrapper\">\n                    <table class=\"disparos-table\">\n                        <thead>\n                            <tr>\n                                <th>Data / Hora</th>\n                                <th>Tipo</th>\n                                <th>Total</th>\n                                <th>Enviados</th>\n                                <th>Progresso</th>\n                                <th>Status</th>\n                                <th>Ações</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"disparosTableBody\">\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n\n            <div class=\"empty-state\" id=\"emptyState\" style=\"display: none;\">\n                <div class=\"empty-icon\">📋</div>\n                <h3>Nenhum disparo encontrado</h3>\n                <p>Você ainda não realizou disparos.<br>Comece criando um novo disparo individual ou em grupo.</p>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        let disparosList = [];\n        let disparosOriginais = [];\n\n        function showError(message) {\n            const errorEl = document.getElementById('errorMessage');\n            errorEl.textContent = message;\n            errorEl.style.display = 'block';\n            setTimeout(() => {\n                errorEl.style.display = 'none';\n            }, 5000);\n        }\n\n        function showSuccess(message) {\n            const successEl = document.getElementById('successMessage');\n            successEl.textContent = message;\n            successEl.style.display = 'block';\n            setTimeout(() => {\n                successEl.style.display = 'none';\n            }, 3000);\n        }\n\n        function hideLoading() {\n            document.getElementById('loadingContainer').style.display = 'none';\n        }\n\n        function showTable() {\n            document.getElementById('tableContainer').style.display = 'block';\n        }\n\n        function showEmptyState() {\n            document.getElementById('emptyState').style.display = 'block';\n        }\n\n        function hideEmptyState() {\n            document.getElementById('emptyState').style.display = 'none';\n        }\n\n        function showFilters() {\n            document.getElementById('filtersContainer').style.display = 'flex';\n        }\n\n        function hideTable() {\n            document.getElementById('tableContainer').style.display = 'none';\n        }\n\n        async function carregarDisparos() {\n            console.log('=== INICIANDO CARREGAMENTO DE DISPAROS ===');\n            try {\n                console.log('Fazendo requisição para API...');\n                const response = await fetch('https://n8n.typebot.pro/webhook/listadisparos', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({})\n                });\n\n                console.log('Status da resposta:', response.status);\n\n                if (!response.ok) {\n                    throw new Error(`Erro ${response.status}: ${response.statusText}`);\n                }\n\n                const data = await response.json();\n                console.log('Disparos recebidos da API:', data);\n\n                let processedDisparos = [];\n                if (Array.isArray(data) && data.length > 0 && data[0].disparos) {\n                    processedDisparos = data[0].disparos;\n                } else if (Array.isArray(data)) {\n                    processedDisparos = data;\n                } else if (data && data.disparos) {\n                    processedDisparos = data.disparos;\n                }\n\n                disparosList = processedDisparos.map(disparo => ({\n                    id: disparo.id,\n                    data: disparo.created_at,\n                    tipo: disparo.TipoDisparo || 'Individual',\n                    totalContatos: disparo.TotalDisparos || 0,\n                    enviados: disparo.MensagensDisparadas || 0,\n                    status: disparo.StatusDisparo || 'Em andamento'\n                }));\n\n                console.log('Disparos processados:', disparosList);\n\n                disparosOriginais = [...disparosList];\n                console.log('Dados originais salvos:', disparosOriginais.length, disparosOriginais);\n\n                hideLoading();\n\n                if (disparosList.length === 0) {\n                    hideTable();\n                    hideFilters();\n                    showEmptyState();\n                } else {\n                    hideEmptyState();\n                    showFilters();\n                    renderDisparos();\n                    showTable();\n                    setupFiltros();\n                }\n            } catch (error) {\n                console.error('ERRO ao carregar disparos:', error);\n                hideLoading();\n                showError('Erro ao carregar disparos: ' + error.message);\n            }\n        }\n\n        function renderDisparos() {\n            console.log('=== RENDERIZANDO DISPAROS ===');\n            console.log('Disparos para renderizar:', disparosList.length, disparosList);\n\n            const tableBody = document.getElementById('disparosTableBody');\n            tableBody.innerHTML = '';\n\n            if (!disparosList || disparosList.length === 0) {\n                console.log('Lista de disparos vazia - não renderizando nada');\n                return;\n            }\n\n            const disparosOrdenados = [...disparosList].sort((a, b) => {\n                const dataA = new Date(a.data);\n                const dataB = new Date(b.data);\n                return dataB - dataA;\n            });\n\n            console.log('Renderizando disparos ordenados por data (mais recente primeiro):', disparosOrdenados.length);\n\n            let linhasRenderizadas = 0;\n            disparosOrdenados.forEach((disparo, index) => {\n                const row = createDisparoRow(disparo);\n                if (row) {\n                    tableBody.appendChild(row);\n                    linhasRenderizadas++;\n                } else {\n                    console.warn(`Linha ${index} não foi criada (disparo inválido):`, disparo);\n                }\n            });\n\n            console.log(`Renderização concluída: ${linhasRenderizadas} linhas criadas de ${disparosOrdenados.length} disparos`);\n\n            if (linhasRenderizadas === 0) {\n                console.error('ERRO: Nenhuma linha foi renderizada mesmo tendo disparos na lista!');\n                document.getElementById('tableContainer').style.display = 'none';\n                document.getElementById('emptyState').style.display = 'block';\n            }\n        }\n\n        function createDisparoRow(disparo) {\n            console.log('Criando linha para disparo:', disparo);\n\n            if (!disparo || !disparo.id || disparo.id === 0 || disparo.id === undefined) {\n                console.error('ERRO: Tentativa de criar linha com disparo inválido:', disparo);\n                return null;\n            }\n\n            const row = document.createElement('tr');\n\n            let dataFormatada = 'Data inválida';\n            let horaFormatada = '';\n\n            try {\n                const data = new Date(disparo.data);\n                if (!isNaN(data.getTime())) {\n                    dataFormatada = data.toLocaleDateString('pt-BR', {\n                        day: '2-digit',\n                        month: '2-digit',\n                        year: 'numeric'\n                    });\n                    horaFormatada = data.toLocaleTimeString('pt-BR', {\n                        hour: '2-digit',\n                        minute: '2-digit'\n                    });\n                }\n            } catch (error) {\n                console.warn('Erro ao formatar data:', disparo.data, error);\n            }\n\n            const tipo = disparo.tipo || 'Individual';\n            const tipoClass = tipo.toLowerCase() === 'individual' ? 'pill-individual' : 'pill-grupos';\n\n            const total = parseInt(disparo.totalContatos) || 0;\n            const enviados = parseInt(disparo.enviados) || 0;\n            const progresso = total > 0 ? Math.round((enviados / total) * 100) : 0;\n\n            const status = disparo.status || 'Desconhecido';\n            const statusClass = getStatusClass(status);\n\n            const podeCarnelar = status === 'Em andamento' || status === 'Agendado';\n            const acaoHtml = podeCarnelar ? \n                `<button class=\"btn-cancelar\" onclick=\"cancelarDisparo(${disparo.id}, this)\">❌ Cancelar</button>` :\n                '<span style=\"color: #666;\">-</span>';\n\n            row.innerHTML = `\n                <td class=\"date-cell\">\n                    ${dataFormatada}\n                    <span class=\"date-time\">${horaFormatada}</span>\n                </td>\n                <td>\n                    <span class=\"pill ${tipoClass}\">${tipo}</span>\n                </td>\n                <td class=\"count-cell\">${total.toLocaleString('pt-BR')}</td>\n                <td class=\"count-cell\">${enviados.toLocaleString('pt-BR')}</td>\n                <td>\n                    <div class=\"progress-container\">\n                        <div class=\"progress-bar\" style=\"width: ${progresso}%\"></div>\n                    </div>\n                    <div class=\"progress-text\">${progresso}%</div>\n                </td>\n                <td>\n                    <span class=\"pill ${statusClass}\">${status}</span>\n                </td>\n                <td>\n                    ${acaoHtml}\n                </td>\n            `;\n\n            return row;\n        }\n\n        function getStatusClass(status) {\n            const statusLower = status.toLowerCase();\n            \n            if (statusLower.includes('andamento')) return 'pill-em-andamento';\n            if (statusLower.includes('agendado')) return 'pill-agendado';\n            if (statusLower.includes('enviado')) return 'pill-enviado';\n            if (statusLower.includes('finalizado') || statusLower.includes('concluído')) return 'pill-finalizado';\n            if (statusLower.includes('cancelado')) return 'pill-cancelado';\n            \n            return 'pill-em-andamento';\n        }\n\n        async function cancelarDisparo(idDisparo, btnElement) {\n            if (!confirm('Tem certeza que deseja cancelar este disparo?')) {\n                return;\n            }\n\n            btnElement.disabled = true;\n            btnElement.innerHTML = '⏳ Cancelando...';\n\n            try {\n                console.log('Cancelando disparo:', idDisparo);\n                const response = await fetch('https://n8n.typebot.pro/webhook/cancelar', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        idDisparo: idDisparo\n                    })\n                });\n\n                if (!response.ok) {\n                    throw new Error(`Erro ${response.status}: ${response.statusText}`);\n                }\n\n                showSuccess('Disparo cancelado com sucesso!');\n\n                disparosOriginais = disparosOriginais.map(disparo => \n                    disparo.id === idDisparo ? { ...disparo, status: 'Cancelado' } : disparo\n                );\n                \n                disparosList = disparosList.map(disparo => \n                    disparo.id === idDisparo ? { ...disparo, status: 'Cancelado' } : disparo\n                );\n\n                console.log('Status atualizado localmente para Cancelado');\n                renderDisparos();\n            } catch (error) {\n                console.error('Erro ao cancelar disparo:', error);\n                showError('Erro ao cancelar disparo: ' + error.message);\n                btnElement.disabled = false;\n                btnElement.innerHTML = '❌ Cancelar';\n            }\n        }\n\n        function aplicarFiltros() {\n            console.log('=== APLICANDO FILTROS - INÍCIO ===');\n            console.log('Função aplicarFiltros foi chamada!');\n\n            if (!disparosOriginais || disparosOriginais.length === 0) {\n                console.error('ERRO: Não há dados originais para filtrar!');\n                console.log('disparosOriginais:', disparosOriginais);\n                console.log('disparosList length:', disparosList ? disparosList.length : 'undefined');\n                \n                if (disparosList && disparosList.length > 0) {\n                    console.log('Usando disparosList como backup...');\n                    disparosOriginais = [...disparosList];\n                    console.log('Backup realizado. Dados originais agora:', disparosOriginais.length);\n                } else {\n                    console.error('ERRO CRÍTICO: Nem disparosList nem disparosOriginais têm dados!');\n                    return;\n                }\n            }\n\n            const filtroTipo = document.getElementById('filtroTipo').value;\n            const filtroStatus = document.getElementById('filtroStatus').value;\n\n            console.log('Valores dos filtros:', {\n                tipo: filtroTipo,\n                status: filtroStatus\n            });\n            console.log('Dados originais para filtrar:', disparosOriginais.length);\n\n            let disparosFiltrados = [...disparosOriginais];\n            console.log('Cópia inicial criada:', disparosFiltrados.length);\n\n            if (filtroTipo && filtroTipo !== '') {\n                console.log('Aplicando filtro de tipo:', filtroTipo);\n                const antesLength = disparosFiltrados.length;\n                disparosFiltrados = disparosFiltrados.filter(disparo => {\n                    const match = disparo.tipo === filtroTipo;\n                    if (match) console.log(`✓ Mantendo: ${disparo.tipo}`);\n                    return match;\n                });\n                console.log(`Filtro tipo: ${antesLength} → ${disparosFiltrados.length}`);\n            }\n\n            if (filtroStatus && filtroStatus !== '') {\n                console.log('Aplicando filtro de status:', filtroStatus);\n                const antesLength = disparosFiltrados.length;\n                disparosFiltrados = disparosFiltrados.filter(disparo => {\n                    const match = disparo.status === filtroStatus;\n                    if (match) console.log(`✓ Mantendo: ${disparo.status}`);\n                    return match;\n                });\n                console.log(`Filtro status: ${antesLength} → ${disparosFiltrados.length}`);\n            }\n\n            console.log('Resultado final dos filtros:', disparosFiltrados.length);\n\n            disparosList = disparosFiltrados;\n            console.log('disparosList atualizado');\n            \n            console.log('Chamando renderDisparos...');\n            renderDisparos();\n\n            const tableContainer = document.getElementById('tableContainer');\n            const emptyState = document.getElementById('emptyState');\n            \n            if (disparosList.length === 0) {\n                console.log('Nenhum resultado - mostrando empty state');\n                tableContainer.style.display = 'none';\n                emptyState.style.display = 'block';\n            } else {\n                console.log('Resultados encontrados - mostrando tabela');\n                emptyState.style.display = 'none';\n                tableContainer.style.display = 'block';\n            }\n            \n            console.log('=== APLICANDO FILTROS - FIM ===');\n        }\n\n        function limparFiltros() {\n            console.log('=== LIMPANDO FILTROS ===');\n            console.log('Dados originais antes de limpar:', disparosOriginais.length);\n            \n            const filtroTipo = document.getElementById('filtroTipo');\n            const filtroStatus = document.getElementById('filtroStatus');\n            \n            if (filtroTipo) filtroTipo.value = '';\n            if (filtroStatus) filtroStatus.value = '';\n            \n            disparosList = [...disparosOriginais];\n            console.log('Dados restaurados:', disparosList.length, disparosList);\n            \n            renderDisparos();\n            \n            const tableContainer = document.getElementById('tableContainer');\n            const emptyState = document.getElementById('emptyState');\n            \n            if (disparosList.length === 0) {\n                console.log('Nenhum dado original - mostrando empty state');\n                tableContainer.style.display = 'none';\n                emptyState.style.display = 'block';\n            } else {\n                console.log('Dados restaurados - mostrando tabela');\n                emptyState.style.display = 'none';\n                tableContainer.style.display = 'block';\n            }\n        }\n\n        async function atualizarDisparos() {\n            const btnAtualizar = document.getElementById('btnAtualizar');\n            btnAtualizar.disabled = true;\n            btnAtualizar.innerHTML = '🔄 Atualizando...';\n\n            try {\n                document.getElementById('filtroTipo').value = '';\n                document.getElementById('filtroStatus').value = '';\n                \n                await carregarDisparos();\n                showSuccess('Dados atualizados com sucesso!');\n            } catch (error) {\n                showError('Erro ao atualizar dados: ' + error.message);\n            } finally {\n                btnAtualizar.disabled = false;\n                btnAtualizar.innerHTML = '🔄 Atualizar';\n            }\n        }\n\n        function setupFiltros() {\n            console.log('=== CONFIGURANDO FILTROS ===');\n            console.log('Dados originais disponíveis para filtros:', disparosOriginais.length);\n            \n            const filtroTipo = document.getElementById('filtroTipo');\n            const filtroStatus = document.getElementById('filtroStatus');\n            const btnLimparFiltros = document.getElementById('btnLimparFiltros');\n\n            console.log('Elementos encontrados:', {\n                filtroTipo: !!filtroTipo,\n                filtroStatus: !!filtroStatus,\n                btnLimparFiltros: !!btnLimparFiltros\n            });\n\n            if (filtroTipo) {\n                filtroTipo.onchange = function() {\n                    console.log('EVENTO: Filtro tipo mudou para:', this.value);\n                    console.log('Dados originais no momento:', disparosOriginais.length);\n                    aplicarFiltros();\n                };\n                console.log('Event listener adicionado ao filtroTipo');\n            }\n\n            if (filtroStatus) {\n                filtroStatus.onchange = function() {\n                    console.log('EVENTO: Filtro status mudou para:', this.value);\n                    console.log('Dados originais no momento:', disparosOriginais.length);\n                    aplicarFiltros();\n                };\n                console.log('Event listener adicionado ao filtroStatus');\n            }\n\n            if (btnLimparFiltros) {\n                btnLimparFiltros.onclick = function() {\n                    console.log('EVENTO: Botão limpar clicado');\n                    console.log('Dados originais no momento:', disparosOriginais.length);\n                    limparFiltros();\n                };\n                console.log('Event listener adicionado ao btnLimparFiltros');\n            }\n\n            console.log('=== FILTROS CONFIGURADOS ===');\n        }\n\n        async function inicializarPagina() {\n            console.log('Inicializando página de histórico de disparos');\n            console.log('Carregando disparos diretamente');\n            \n            const btnAtualizar = document.getElementById('btnAtualizar');\n            if (btnAtualizar) {\n                btnAtualizar.addEventListener('click', atualizarDisparos);\n            }\n            \n            await carregarDisparos();\n        }\n\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', inicializarPagina);\n        } else {\n            inicializarPagina();\n        }\n\n        console.log('=== SCRIPT DA PÁGINA DE HISTÓRICO DE DISPAROS CARREGADO ===');\n    </script>\n</body>\n</html>"},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-6528,-1504],"id":"4b2db768-8f89-4900-b4dc-5f821bdba70f","name":"HTML8"}],"connections":{"HTML":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"HTML1","type":"main","index":0}]]},"HTML1":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"CRIAR CONEXAO":{"main":[[{"node":"HTML","type":"main","index":0}]]},"VERIFICAR LOGIN":{"main":[[{"node":"LOCALIZAR EMAIL","type":"main","index":0}]]},"LOGIN":{"main":[[{"node":"HTML2","type":"main","index":0}]]},"HTML2":{"main":[[{"node":"Respond to Webhook2","type":"main","index":0}]]},"LOCALIZAR EMAIL":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"If1","type":"main","index":0}],[{"node":"NEGADO","type":"main","index":0}]]},"CRIAR INSTANCIA":{"main":[[{"node":"CRIAR CONEXAO1","type":"main","index":0}]]},"CRIAR CONEXAO1":{"main":[[{"node":"RESPOSTA","type":"main","index":0}]]},"Webhook3":{"main":[[{"node":"BUSCAR CONEXAO","type":"main","index":0}]]},"BUSCAR FOTO PERFIL":{"main":[[{"node":"SALVAR FOTO","type":"main","index":0}]]},"BUSCAR CONEXAO":{"main":[[{"node":"BUSCAR FOTO PERFIL","type":"main","index":0}]]},"SALVAR FOTO":{"main":[[{"node":"RESPOSTA1","type":"main","index":0}]]},"Webhook4":{"main":[[{"node":"BUSCAR CONEXAO1","type":"main","index":0}]]},"BUSCAR CONEXAO1":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"RESPOSTA2","type":"main","index":0}]]},"LOGIN1":{"main":[[{"node":"HTML4","type":"main","index":0}]]},"HTML4":{"main":[[{"node":"Respond to Webhook3","type":"main","index":0}]]},"HTML5":{"main":[[{"node":"Respond to Webhook4","type":"main","index":0}]]},"DISPAROS GRUPOS":{"main":[[{"node":"HTML5","type":"main","index":0}]]},"Webhook5":{"main":[[{"node":"LISTAR GRUPO","type":"main","index":0}]]},"LISTAR GRUPO":{"main":[[{"node":"RESPOSTA3","type":"main","index":0}]]},"CRIAR DISPARO":{"main":[[{"node":"CONTATOS","type":"main","index":0}]]},"CONTATOS":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"BUSCAR DISPARO","type":"main","index":0}],[{"node":"DIAS SELECIONADOS","type":"main","index":0}]]},"Replace Me":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"MENSAGEM RANDOM":{"main":[[{"node":"CONEXAO RANDOM","type":"main","index":0}]]},"CONEXAO RANDOM":{"main":[[{"node":"ANEXOS","type":"main","index":0}]]},"ANEXOS":{"main":[[{"node":"MSG TEXTO","type":"main","index":0}],[{"node":"MSG TEXTO + MEDIA","type":"main","index":0}],[{"node":"MSG TEXTO + MEDIA","type":"main","index":0}],[{"node":"MSG TEXTO + AUDIO","type":"main","index":0}],[{"node":"MSG TEXTO + MEDIA","type":"main","index":0}]]},"MSG TEXTO":{"main":[[{"node":"QNT DISPARADAS","type":"main","index":0}]]},"MSG TEXTO + MEDIA":{"main":[[{"node":"QNT DISPARADAS","type":"main","index":0}]]},"MSG TEXTO + AUDIO":{"main":[[{"node":"QNT DISPARADAS","type":"main","index":0}]]},"QNT DISPARADAS":{"main":[[{"node":"SALVAR DISPARO","type":"main","index":0}]]},"SALVAR DISPARO":{"main":[[{"node":"INTERVALO DE MENSAGENS","type":"main","index":0}]]},"INTERVALO DE MENSAGENS":{"main":[[{"node":"Replace Me","type":"main","index":0}]]},"DENTRO DO HORÁRIO?":{"main":[[{"node":"MENSAGEM RANDOM","type":"main","index":0}],[{"node":"ESPERAR ATÉ O HORÁRIO","type":"main","index":0}]]},"ESPERAR ATÉ O HORÁRIO":{"main":[[{"node":"MENSAGEM RANDOM","type":"main","index":0}]]},"DIAS SELECIONADOS":{"main":[[{"node":"DENTRO DO HORÁRIO?","type":"main","index":0}],[{"node":"ESPERAR ATÉ DIA SELECIONADO","type":"main","index":0}]]},"DISPARAR MENSAGENS":{"main":[[{"node":"CRIAR DISPARO","type":"main","index":0}]]},"ESPERAR ATÉ DIA SELECIONADO":{"main":[[{"node":"DENTRO DO HORÁRIO?","type":"main","index":0}]]},"Webhook7":{"main":[[{"node":"BUSCAR DISPAROS","type":"main","index":0}]]},"Aggregate1":{"main":[[{"node":"RESPOSTA5","type":"main","index":0}]]},"BUSCAR DISPAROS":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"HISTORICO DISPAROS":{"main":[[{"node":"HTML8","type":"main","index":0}]]},"BUSCAR DISPARO":{"main":[[{"node":"SALVAR DISPARO1","type":"main","index":0}]]},"Webhook8":{"main":[[{"node":"BUSCAR DISPAROS1","type":"main","index":0}]]},"BUSCAR DISPAROS1":{"main":[[{"node":"DELETAR EXECUÇÃO","type":"main","index":0}]]},"DELETAR EXECUÇÃO":{"main":[[{"node":"SALVAR DISPARO2","type":"main","index":0}]]},"DASHBOARD":{"main":[[{"node":"HTML7","type":"main","index":0}]]},"Webhook9":{"main":[[{"node":"BUSCAR DISPAROS2","type":"main","index":0}]]},"BUSCAR DISPAROS2":{"main":[[{"node":"Aggregate2","type":"main","index":0}]]},"Aggregate2":{"main":[[{"node":"BUSCAR CONEXOES","type":"main","index":0}]]},"BUSCAR CONEXOES":{"main":[[{"node":"Aggregate3","type":"main","index":0}]]},"Aggregate3":{"main":[[{"node":"RESPOSTA6","type":"main","index":0}]]},"CRIAR CONEXAO2":{"main":[[{"node":"CRIAR INSTANCIA","type":"main","index":0}]]},"APAGAR CONEXAO":{"main":[[{"node":"DESLOGAR INSTANCIA","type":"main","index":0}]]},"DELETAR INSTANCIA":{"main":[[{"node":"DELETAR CONEXAO","type":"main","index":0},{"node":"RESPOSTA7","type":"main","index":0}]]},"DESLOGAR INSTANCIA":{"main":[[{"node":"DELETAR INSTANCIA","type":"main","index":0}]]},"DELETAR CONEXAO":{"main":[[{"node":"RESPOSTA7","type":"main","index":0}]]},"CRIAR DISPARO1":{"main":[[{"node":"CONTATOS1","type":"main","index":0}]]},"Split Out2":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"CONTATOS1":{"main":[[{"node":"Split Out2","type":"main","index":0}]]},"Loop Over Items1":{"main":[[{"node":"BUSCAR DISPARO1","type":"main","index":0}],[{"node":"ESPERAR ATÉ A DATA","type":"main","index":0}]]},"Replace Me1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"ANEXOS1":{"main":[[{"node":"MSG TEXTO1","type":"main","index":0}],[{"node":"MSG TEXTO + MEDIA1","type":"main","index":0}],[{"node":"MSG TEXTO + MEDIA1","type":"main","index":0}],[{"node":"MSG TEXTO + AUDIO1","type":"main","index":0}],[{"node":"MSG TEXTO + MEDIA1","type":"main","index":0}]]},"MSG TEXTO1":{"main":[[{"node":"QNT DISPARADAS1","type":"main","index":0}]]},"MSG TEXTO + MEDIA1":{"main":[[{"node":"QNT DISPARADAS1","type":"main","index":0}]]},"MSG TEXTO + AUDIO1":{"main":[[{"node":"QNT DISPARADAS1","type":"main","index":0}]]},"SALVAR DISPARO3":{"main":[[{"node":"Replace Me1","type":"main","index":0}]]},"QNT DISPARADAS1":{"main":[[{"node":"SALVAR DISPARO3","type":"main","index":0}]]},"BUSCAR DISPARO1":{"main":[[{"node":"SALVAR DISPARO4","type":"main","index":0}]]},"Webhook6":{"main":[[{"node":"CRIAR DISPARO1","type":"main","index":0}]]},"ESPERAR ATÉ A DATA":{"main":[[{"node":"MENSAGEM RANDOM1","type":"main","index":0}]]},"LISTAR GRUPO1":{"main":[[{"node":"ANEXOS1","type":"main","index":0}]]},"MENSAGEM RANDOM1":{"main":[[{"node":"LISTAR GRUPO1","type":"main","index":0}]]},"If1":{"main":[[{"node":"LIBERADO","type":"main","index":0}],[{"node":"BLOQUEADO","type":"main","index":0}]]},"DASHBOARD1":{"main":[[{"node":"HTML9","type":"main","index":0}]]},"HTML9":{"main":[[{"node":"Respond to Webhook7","type":"main","index":0}]]},"HTML7":{"main":[[{"node":"Respond to Webhook6","type":"main","index":0}]]},"HTML8":{"main":[[{"node":"Respond to Webhook5","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"50b864d2-1aab-47bf-94fd-1da6ee15285f","triggerCount":19,"tags":[]}
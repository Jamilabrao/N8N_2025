{"createdAt":"2024-12-11T13:37:51.937Z","updatedAt":"2025-03-06T21:47:43.496Z","id":"1yq3kmJTrvOo5oyE","name":"AUTOMA-THREADS-JAMIL","active":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"d1bf9f37-9f2a-4bde-98df-6745a324059d","name":"message","value":"={{ $json.output }}","type":"string"}]},"options":{}},"id":"2a3b6252-b304-4927-b6b5-c5ef44639337","name":"Edit Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-660,1200]},{"parameters":{"jsCode":"// Obter o output do agente do fluxo n8n (substituindo agentOutput)\nconst agentOutput = $json[\"message\"];  // Supondo que o campo do output do agente seja \"message\"\n\n// Função que separa o output em parágrafos\nfunction splitMessagesByParagraphs(output) {\n  // Separar o conteúdo por quebras de linha duplas (\\n\\n), mais apropriadas para parágrafos\n  const messages = output.trim().split(/\\n\\s*\\n/);  // Alterado para capturar quebras de linha dupla\n  \n  // Remover mensagens vazias ou apenas com espaços\n  const filteredMessages = messages.filter(msg => msg.trim() !== \"\");\n\n  // Retornar o array de mensagens separadas\n  return filteredMessages;\n}\n\n// Chamar a função\nconst responses = splitMessagesByParagraphs(agentOutput);\n\n// Formatar o retorno no formato esperado pelo n8n\nreturn responses.map(response => {\n  return { json: { message: response } }; // Cada item deve ter um campo \"json\"\n});\n"},"id":"af9ee9f6-6d5c-4336-aef7-b82a533ea72f","name":"Code","type":"n8n-nodes-base.code","typeVersion":2,"position":[-400,1200]},{"parameters":{"method":"POST","url":"https://graph.threads.net/v1.0/9297388760294838/threads","sendQuery":true,"queryParameters":{"parameters":[{"name":"media_type","value":"TEXT"},{"name":"text","value":"={{ $json.message }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer THQWJXNXQzeHVxbkNPcmdva0U4ZAGxfNDV1MG9ITUdGeklRSlhBUEJrdUloNVF1NGd4YXZAaWnFyQzdGZADdhWERRTWVhMVNUSWN4SEFzYkQ5OHg0c0JDNm5BT0JZAQjBwU1pNSko4ekhsa3AxYjIzeWJ1TUpFUUlYRUJzb0EZD"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"93eac242-ada7-4b57-826a-6d61a9dc7416","name":"Manda Mensagem","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[200,1460],"executeOnce":true},{"parameters":{"method":"POST","url":"https://graph.threads.net/v1.0/9297388760294838/threads_publish","sendQuery":true,"queryParameters":{"parameters":[{"name":"creation_id","value":"={{ $json.body.id }}"},{"name":"access_token","value":"=THQWJXNXQzeHVxbkNPcmdva0U4ZAGxfNDV1MG9ITUdGeklRSlhBUEJrdUloNVF1NGd4YXZAaWnFyQzdGZADdhWERRTWVhMVNUSWN4SEFzYkQ5OHg0c0JDNm5BT0JZAQjBwU1pNSko4ekhsa3AxYjIzeWJ1TUpFUUlYRUJzb0EZD"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"8fa6b181-8869-4066-8f38-99f3220b0957","name":"Posta Mensagem","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[420,1460]},{"parameters":{"method":"POST","url":"https://graph.threads.net/v1.0/me/threads","sendBody":true,"contentType":"form-urlencoded","bodyParameters":{"parameters":[{"name":"media_type","value":"TEXT"},{"name":"text","value":"={{ $('Loop Over Items').item.json.message }}"},{"name":"reply_to_id","value":"={{ $item(\"0\").$node[\"Posta Mensagem\"].json[\"body\"][\"id\"] }}"},{"name":"access_token","value":"=THQWJXNXQzeHVxbkNPcmdva0U4ZAGxfNDV1MG9ITUdGeklRSlhBUEJrdUloNVF1NGd4YXZAaWnFyQzdGZADdhWERRTWVhMVNUSWN4SEFzYkQ5OHg0c0JDNm5BT0JZAQjBwU1pNSko4ekhsa3AxYjIzeWJ1TUpFUUlYRUJzb0EZD"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"95693ae8-81cc-4550-acdb-888cf27e53e2","name":"Manda Resposta","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[520,1240]},{"parameters":{"method":"POST","url":"https://graph.threads.net/v1.0/9297388760294838/threads_publish","sendQuery":true,"queryParameters":{"parameters":[{"name":"creation_id","value":"={{ $json.body.id }}"},{"name":"access_token","value":"=THQWJXNXQzeHVxbkNPcmdva0U4ZAGxfNDV1MG9ITUdGeklRSlhBUEJrdUloNVF1NGd4YXZAaWnFyQzdGZADdhWERRTWVhMVNUSWN4SEFzYkQ5OHg0c0JDNm5BT0JZAQjBwU1pNSko4ekhsa3AxYjIzeWJ1TUpFUUlYRUJzb0EZD"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"afeadd4a-68ef-4450-9298-c6e2995330b1","name":"Posta Resposta1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[740,1240]},{"parameters":{"model":"gpt-4o-mini-2024-07-18","options":{}},"id":"003e26c5-1d6c-4955-974d-7ee574ba982e","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1480,920],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"1"},"id":"ca45f458-a42f-4c31-a32f-e394689a0e8f","name":"Window Buffer Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.2,"position":[-1320,900]},{"parameters":{"options":{"reset":false}},"id":"bc0da4c3-737b-4183-8cdf-08d28d60e561","name":"Loop Over Items","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-60,1200]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"71f1c384-cae3-428f-b866-d2147d67389b","leftValue":"={{ $runIndex }}","rightValue":0,"operator":{"type":"number","operation":"equals"}}],"combinator":"and"},"options":{}},"id":"4f7b7ddc-006c-4c36-8c42-086bca31a88a","name":"If","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[280,1220]},{"parameters":{"documentId":{"__rl":true,"value":"1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo","mode":"list","cachedResultName":"POSTAGEM THREADS","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"JAMIL","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo/edit#gid=0"},"options":{}},"id":"98b26b38-b6fd-49f3-bc11-b7b168e02d64","name":"Google Sheets1","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-1840,680],"credentials":{"googleSheetsOAuth2Api":{"id":"c1hmUtfYiP5FWVBk","name":"GOOGLE JAMIL"}}},{"parameters":{},"id":"0a4d2e25-0663-4072-b768-21abeab9b030","name":"Limit","type":"n8n-nodes-base.limit","typeVersion":1,"position":[-1620,680]},{"parameters":{"rule":{"interval":[{}]}},"id":"13f47d6b-db61-4d03-99a9-0b8a7ae6c418","name":"Schedule Trigger1","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-2080,1200]},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo","mode":"list","cachedResultName":"POSTAGEM THREADS","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"JAMIL","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"row_number":"={{ $item(\"0\").$node[\"Google Sheets3\"].json[\"row_number\"] }}","Postado":"sim"},"matchingColumns":["row_number"],"schema":[{"id":"Tópico ","displayName":"Tópico ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Postado","displayName":"Postado","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":false}]},"options":{}},"id":"a09caa47-ab59-497a-a365-ba8e18891fb0","name":"Google Sheets2","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[520,1020],"credentials":{"googleSheetsOAuth2Api":{"id":"c1hmUtfYiP5FWVBk","name":"GOOGLE JAMIL"}}},{"parameters":{"documentId":{"__rl":true,"value":"1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo","mode":"list","cachedResultName":"POSTAGEM THREADS","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"JAMIL","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gQhLi2rv3L7zEmADJxFqQXe_NaCPDic5mn6qH4T9cMo/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"Postado"}]},"options":{}},"id":"4de088ee-1364-4137-a4ca-4c61955bef6f","name":"Google Sheets3","type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[300,1020],"credentials":{"googleSheetsOAuth2Api":{"id":"c1hmUtfYiP5FWVBk","name":"GOOGLE JAMIL"}}},{"parameters":{"content":"RENOVAR A CADA 2 MESES\n\nDEBUG DO TOKEN\nhttps://developers.facebook.com/tools/debug/\n\n\naccess_token:\"THQWJXR0c0cUM0Xzg4Ml95VGZA2ekFTbWxNN1Rydm02LWd3dXJyY2pWb05aMHJ5OHYtMlhZAR2xjUnVoQ1E5azdISkp6bUVqeV9jR2RPY2FtOHVGV3NnT1dkemdVcVQzbWlWc2REM2p6bXFrbWU0UFg5a3lybkZAGT1dvWDNESUZAOcThkOXU2UUNZARTZAFb3c4dTZAZAc2ZA3\"\n\nuser_id:9297388760294838\n\nGERAR TOKEN:\nhttps://threads.net/oauth/authorize?client_id=569494812354324&redirect_uri=https://oauth.pstmn.io/v1/callback&scope=threads_basic,threads_content_publish,threads_manage_insights,threads_manage_replies,threads_read_replies&response_type=code \n\n\nhttps://graph.threads.net/oauth/access_token?client_id=SEU_ID_AQUI&client_secret=SEU_CLIENTEID_AQUI&grant_type=authorization_code&redirect_uri=https://oauth.pstmn.io/v1/callback&code=CODE_GERADO_LINK_ACIMA","height":243.94929313636126,"width":653.9048519640363},"id":"2039ef4a-b47c-4175-8007-d215366f14b0","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2020,0]},{"parameters":{"method":"POST","url":"https://graph.threads.net/v1.0/8598438316920283/threads","sendQuery":true,"queryParameters":{"parameters":[{"name":"media_type","value":"IMAGE"},{"name":"text","value":"=testando again"},{"name":"image_url","value":"https://www.example.com/images/bronz-fonz.jpg"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer THQWJWSkF0X1N1QUd3VlcwNjlmODNESmlkNGx4T0ZA1MUNOSGd4UGFaOHNQcXYwdC1NYk5SdjNxcm1PYk1Ob1pDNWdQdGpSNFo2Y21BR1dJRHc4cGJyRV9PdXRWNm1lTjdIYm1XT0hFZAy1ieHRpV2pWenQxUV9yMmJTSmcZD"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"874c7575-705a-4153-ba4e-2f2e39981708","name":"Manda Imagem","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-500,140]},{"parameters":{"url":"https://graph.threads.net/access_token","sendQuery":true,"queryParameters":{"parameters":[{"name":"grant_type","value":"th_exchange_token "},{"name":"client_secret","value":"68dc9732ed5d7ff3177bfb59b6109d52"},{"name":"access_token","value":"=THQWJXR0c0cUM0Xzg4Ml95VGZA2ekFTbWxNN1Rydm02LWd3dXJyY2pWb05aMHJ5OHYtMlhZAR2xjUnVoQ1E5azdISkp6bUVqeV9jR2RPY2FtOHVGV3NnT1dkemdVcVQzbWlWc2REM2p6bXFrbWU0UFg5a3lybkZAGT1dvWDNESUZAOcThkOXU2UUNZARTZAFb3c4dTZAZAc2ZA3"}]},"options":{"response":{"response":{"fullResponse":true}}}},"id":"05033266-8cf6-4940-b7fe-8e9aec0ee52f","name":"Access Token","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-740,140]},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"=You are a highly experienced content creator, having worked with big brands on large-scale social media campaigns. Create engaging, high-quality content focused on entrepreneurship and marketing for Threads posts.\n\nEach post must be informative, easy to understand and practical, providing valuable insights and tips on digital marketing and/or Artificial intelligence. Your content should appeal to people in general, entrepreneurs, professionals and enthusiasts, using an educational and inspiring tone. \n\n\nA full thread post must have fewer than 10 threads. Each less than 500 characters, with a clear, concise and professional style that resonates with the target audience.\ndon't give me hashtags. \nUse emojis whenever you see fit.\nWrite about {{ $json['Topic '] }}. \n\nBE THE MOST HUMANE YOU CAN.\nALWAYS separate each paragraph with large spaces. Do not separate a title or topic from the text.\nReturn it in Brazilian Portuguese. Don't return \"thread 1\" and so on.\n\nDo not use ** before or after words.","options":{}},"id":"cd118bff-abd0-4f45-8e5e-d4c864830fe4","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1420,680]},{"parameters":{"model":"gpt-4o-mini-2024-07-18","options":{}},"id":"110e1266-3161-4355-95d8-673ecc8237be","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1060,1420],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"1"},"id":"ca9b4826-dd66-4d8f-8f28-915d6099c189","name":"Window Buffer Memory1","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.2,"position":[-960,1420]},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"=You are a highly experienced content creator, having worked with big brands on large-scale social media campaigns. Create engaging, high-quality content focused on entrepreneurship and marketing for Threads posts.\n\nEach post should be informative, easy to understand and practical, providing valuable insights and tips on digital marketing, entrepreneurship, post tips to generate engagement. Your content should appeal to people in general, entrepreneurs, professionals and enthusiasts, using an educational and inspiring tone. \n\n\nA full-topic post must have fewer than 10 topics. Each less than 500 characters, with a clear, concise and professional style that resonates with the target audience.\ndon't give me hashtags. \nUse emojis whenever you feel necessary.\nWrite about digital marketing, entrepreneurship, posting tips to generate engagement. \n\nBE THE MOST HUMANE YOU CAN.\nALWAYS separate each paragraph with large spaces. Do not separate a title or topic from the text.\nReturn it in Brazilian Portuguese. Don't return \"thread 1\" and so on.\n\nDo not use ** before or after words.","options":{}},"id":"a7301811-da31-4cf6-b925-2484abad6bd1","name":"AI Agent1","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1100,1200]},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini-2024-07-18","mode":"list","cachedResultName":"GPT-4O-MINI-2024-07-18"},"messages":{"values":[{"content":"=  You are a You are a highly experienced content creator, having worked with major brands on large-scale social media campaigns. You're expert on Threads - the meta social media. Analyze this  content, see if it follows the same topic, if it's engaging and coherent.  {{ $json.output }}","role":"system"},{"content":"=Analyze this content and improve  it, so it's more human like and engaging, with a truly informing content.\n\n\nReturn only the improved content. \nDot not use ** before or after words.\nWrite in a light, practical, and welcoming way. Use accessible and friendly language, with a casual chat tone. Include casual expressions and emojis when it makes sense. Make the reader feel like they're part of the conversation by asking something like, \"Have you ever thought about this too?\" Avoid being too formal or technical, always prioritizing smooth and relaxed communication.\nReturn only in brazilian Portuguese,\n\nThe content to be analized: {{ $json.output }}\n\n"}]},"options":{}},"id":"0592e793-4b94-44b7-8625-51f16c36d3e4","name":"OpenAI1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.4,"position":[-1040,680],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}}],"connections":{"Manda Mensagem":{"main":[[{"node":"Posta Mensagem","type":"main","index":0}]]},"Posta Mensagem":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Manda Resposta":{"main":[[{"node":"Posta Resposta1","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Loop Over Items":{"main":[[{"node":"Google Sheets3","type":"main","index":0}],[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Manda Mensagem","type":"main","index":0}],[{"node":"Manda Resposta","type":"main","index":0}]]},"Posta Resposta1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Google Sheets1":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Limit":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Google Sheets3":{"main":[[{"node":"Google Sheets2","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"OpenAI1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Window Buffer Memory1":{"ai_memory":[[{"node":"AI Agent1","type":"ai_memory","index":0}]]},"AI Agent1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger1":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"7b8a6454-69ec-4817-b8b6-28e9dedfda75","triggerCount":1,"tags":[{"createdAt":"2024-12-11T13:37:30.943Z","updatedAt":"2024-12-11T13:37:30.943Z","id":"zUDU8ca7Kbtgimqe","name":"threads"}]}
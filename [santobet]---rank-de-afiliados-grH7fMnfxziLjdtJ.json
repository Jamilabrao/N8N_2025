{"createdAt":"2025-06-12T03:12:02.965Z","updatedAt":"2025-06-16T16:03:56.412Z","id":"grH7fMnfxziLjdtJ","name":"[SANTOBET] - RANK DE AFILIADOS","active":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-920,-20],"id":"bce3dd00-3032-46f3-8764-25ee817f1b2a","name":"When clicking â€˜Test workflowâ€™"},{"parameters":{"documentId":{"__rl":true,"value":"1gkiZcv4TIQVnSZTyGz6kzO3T-sACsUeDgGMXvOInhME","mode":"list","cachedResultName":"SANTOBET - WEBHOOK","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gkiZcv4TIQVnSZTyGz6kzO3T-sACsUeDgGMXvOInhME/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"JOGADOR","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gkiZcv4TIQVnSZTyGz6kzO3T-sACsUeDgGMXvOInhME/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"DATA","lookupValue":"={{ new Date().toLocaleDateString('pt-BR').split('/').join('-') }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-460,-20],"id":"ae94357c-791b-4900-aaa0-908338dfce05","name":"Google Sheets","credentials":{"googleSheetsOAuth2Api":{"id":"9W9MbbOmOV6F5Huv","name":"N8N - SHEET"}}},{"parameters":{"assignments":{"assignments":[{"id":"5731bcd8-a644-4489-9dee-5e1bb899a90d","name":"invite","value":"={{ $json['INDICADO POR'].split('@')[0] }}","type":"string"},{"id":"d47488fd-9bb4-4ac2-8d8e-fbd6fc7f44e0","name":"data","value":"={{ new Date().toLocaleDateString('pt-BR').split('/').join('-') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-200,-20],"id":"5aaaaa33-bd53-4cf5-8b24-6008c4b81028","name":"Edit Fields"},{"parameters":{"jsCode":"// Agrupa por e-mail da coluna 'invite' e conta quantas vezes aparece\nconst contagem = {};\n\nfor (const item of items) {\n  let email = item.json.invite;\n\n  if (!email || email.trim() === '') {\n    email = 'Oculto';\n  }\n\n  if (contagem[email]) {\n    contagem[email]++;\n  } else {\n    contagem[email] = 1;\n  }\n}\n\n// Converte para array, ordena e monta mensagem de ranking\nconst medalhas = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];\n\nconst ranking = Object.entries(contagem)\n  .map(([email, total]) => ({ email, total }))\n  .sort((a, b) => b.total - a.total)\n  .map((entry, index) => {\n    const posicao = index < 3 ? medalhas[index] : `${index + 1}Âº`;\n    return `${posicao} ${entry.email} â€” ${entry.total} cadastros`;\n  })\n  .join('\\n');\n\n// Retorna uma Ãºnica saÃ­da com a mensagem pronta\nreturn [\n  {\n    json: {\n      mensagem: ranking\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[20,-20],"id":"0e690dc0-24e8-4bc7-b266-fec4e47643f4","name":"Code"},{"parameters":{"method":"POST","url":"=https://whatsapi.typebot.pro/message/sendText/BOSS","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"=b4d71f9c38e3ac12a6b08e4b6d53aa90"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"120363382224860301@g.us"},{"name":"text","value":"=ðŸ“Š RELATÃ“RIO REGISTROS DIÃRIOS\nðŸ“Š Filtro: CADASTROS JOGADOR POR AFILIADO\nðŸ“… DATA: {{ new Date().toLocaleDateString('pt-BR').split('/').join('-') }}\n\n{{ $json.mensagem }}\n"}]},"options":{}},"id":"42a2797d-3e85-446a-88d5-7d05cbc6c02f","name":"ENVIO RELATORIO GRUPO1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[260,-20],"alwaysOutputData":false},{"parameters":{"jsCode":"// Agrupa por e-mail da coluna 'invite' e conta quantas vezes aparece\nconst contagem = {};\n\nfor (const item of items) {\n  let email = item.json.invite;\n\n  if (!email || email.trim() === '') {\n    email = 'CADASTROS DA CASA';\n  }\n\n  if (contagem[email]) {\n    contagem[email]++;\n  } else {\n    contagem[email] = 1;\n  }\n}\n\n// Converte para array, ordena e adiciona ranking com emojis\nconst medalhas = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];\n\nconst resultado = Object.entries(contagem)\n  .map(([email, total]) => ({ email, total }))\n  .sort((a, b) => b.total - a.total)\n  .map((entry, index) => {\n    const posicao = index < 3 ? medalhas[index] : `${index + 1}`;\n    return {\n      json: {\n        posicao,\n        email: entry.email,\n        total: entry.total\n      }\n    };\n  });\n\nreturn resultado;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[20,-180],"id":"1cccf6da-7176-4a5e-8353-d935a4d3677a","name":"RANK INTENS SEPARADO"},{"parameters":{"jsCode":"const hoje = new Date();\nconst dataFormatada = hoje.toLocaleDateString('pt-BR').split('/').reverse().join('-'); // \"2025-06-12\"\n\nconst [ano, mes, dia] = dataFormatada.split('-');\nconst final = `${dia}-${mes}-${ano}`; // \"12-06-2025\"\n\nreturn [\n  {\n    json: {\n      hoje: final\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-700,-20],"id":"81e47d2d-beac-438e-b8de-87b7a340b829","name":"Code1"}],"connections":{"When clicking â€˜Test workflowâ€™":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"ENVIO RELATORIO GRUPO1","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"45646a68-31e7-4514-b53a-c375048e1bf8","triggerCount":0,"tags":[]}
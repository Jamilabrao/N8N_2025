{"createdAt":"2024-11-07T18:31:12.919Z","updatedAt":"2024-12-05T11:59:15.039Z","id":"uLOBEm39ZxK094xo","name":"SUPER IA - AGENDAMENTO","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"2f0d2f39-d748-43e0-84ac-322b4866bbd6","name":"When clicking ‘Test workflow’","type":"n8n-nodes-base.manualTrigger","position":[720,520],"typeVersion":1},{"parameters":{"method":"POST","url":"={{ $('Credenciais').item.json.baseUrl }}/message/sendText/{{ $('Credenciais').item.json.instancia }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Credenciais').item.json.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"number\": \"{{ $('Credenciais').item.json.WhatsApp }}\",\n  \"text\": \"{{ $json.output.replace(/\\n/g, '\\\\n').replace(/\\\"/g, '\\\\\"').trim() }}\"\n}\n","options":{}},"id":"99c280b3-5eed-4972-9a62-8726e3dfea7d","name":"Enviar Mensagem WhatsApp Lead6","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[940,1186],"continueOnFail":true},{"parameters":{"assignments":{"assignments":[{"id":"2f8e1fbf-9134-4b48-be29-066509e021f5","name":"telefone","value":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","type":"string"},{"id":"59fd3a53-08be-41db-b91e-9abccd7ef4ad","name":"Audio","value":"={{ $json.text || '' }}","type":"string"},{"id":"1f3efabc-087b-4843-8766-742b9109e955","name":"WhatsWeb","value":"={{ $json.pergunta || ''}}","type":"string"},{"id":"60d6b895-fea6-4d7f-932a-b8771c97242e","name":"WhatsAppApp","value":"={{ $json.mensagem || '' }}","type":"string"},{"id":"f45d0d25-8456-4a53-9290-69eed044964e","name":"Imagem","value":"={{ $json.content || ''}}","type":"string"},{"id":"0d9377f3-acbb-49ed-9254-ef9e3e561465","name":"Documento","value":"={{ $json.text }}","type":"string"}]},"options":{}},"id":"415a8169-6dd7-4bae-b8f5-e3fc257e0677","name":"Filtra Webhook","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-740,926]},{"parameters":{"amount":6},"id":"ec803159-6213-4c9a-beed-e29c7ac9b604","name":"Wait","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-460,926],"webhookId":"af62cbc2-1f05-47e0-8b03-7755c553a1c0"},{"parameters":{"operation":"get","propertyName":"mensagem","key":"={{ $json.telefone }}","options":{}},"id":"fad6eee9-f9c1-44b5-a2db-a79b421ecac2","name":"Puxar as Mensagens","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-460,1166],"credentials":{"redis":{"id":"UHcdFvnvoozYhCLm","name":"Redis account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"9e9b4155-e399-4936-a5db-2d79c8cb871f","leftValue":"={{ $json.mensagem.last() }}","rightValue":"={{ $('Filtra Webhook').item.json.Audio || $('Filtra Webhook').item.json.WhatsWeb || $('Filtra Webhook').item.json.WhatsAppApp || $('Filtra Webhook').item.json.Imagem }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"id":"7f1c27ef-eccd-44c5-80be-b49258393b35","name":"If1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-300,1046]},{"parameters":{"assignments":{"assignments":[{"id":"bce70488-3d4e-412d-9c28-4858906bc722","name":"mensagem","value":"={{ $('Puxar as Mensagens').item.json.mensagem.join('\\n') }}","type":"string"},{"id":"abca95c7-60a4-474b-95ed-a22557fa8af7","name":"telefone","value":"={{ $('Wait').item.json.telefone }}","type":"string"}]},"options":{}},"id":"e0992b6a-400d-4420-be0e-8d3a67fb3481","name":"Edit Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-140,926]},{"parameters":{},"id":"388f1f21-16a4-4e25-be7b-5a81454919c0","name":"No Operation, do nothing","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-140,1186]},{"parameters":{"operation":"delete","key":"={{ $json.telefone }}"},"id":"962090df-edda-4a42-b349-95b49137893d","name":"Redis","type":"n8n-nodes-base.redis","typeVersion":1,"position":[60,1026],"credentials":{"redis":{"id":"UHcdFvnvoozYhCLm","name":"Redis account"}}},{"parameters":{},"id":"7d8ac223-399d-4c7a-b36c-01406c354990","name":"Calculator","type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[420,1126]},{"parameters":{"options":{}},"id":"52875aa2-0bce-4e84-af72-59c586021008","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[240,1126],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"options":{}},"id":"f78cd781-8355-4e42-b608-a4c35dd36055","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[420,1366],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"https://drive.google.com/file/d/1MxAkFKo8Z9tMaHrG2bd3eWxXFnpeOP5S/view?usp=sharing","mode":"url"},"options":{}},"id":"f102047d-2903-4b67-b4d3-76cc410ee789","name":"Google Drive","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1320,1586]},{"parameters":{"dataType":"binary","options":{}},"id":"7fe7f999-8a64-49f3-bf15-ee94ea660412","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","position":[-1060,1786],"typeVersion":1},{"parameters":{"chunkSize":3000,"chunkOverlap":200,"options":{}},"id":"1e16f402-3fc2-40a4-a46c-529ca66ce30c","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","position":[-1060,1926],"typeVersion":1},{"parameters":{"options":{}},"id":"d7a5f821-2249-4074-b9e7-379fff2942bf","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[-1180,1826],"typeVersion":1},{"parameters":{"name":"dentista","description":"Use essa ferramenta para buscar informações sobre procedimentos e serviços."},"id":"da9ff378-8e7d-43ac-9a73-be0cfbc75cd3","name":"Vector Store Tool","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[500,1126]},{"parameters":{"options":{}},"id":"e922a2db-1436-4b73-a1ce-072ca21ce0f6","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[720,1266],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}},{"parameters":{"method":"POST","url":"={{ $('Credenciais').item.json.baseUrl }}/chat/getBase64FromMediaMessage/{{ $('Credenciais').item.json.instancia }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $json.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $json.body.data.key.id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"id":"f6fe532b-95af-4332-a469-d5400d82e287","name":"Mensagem de Audio","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1240,686],"retryOnFail":true,"maxTries":2},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"audio","mimeType":"={{ $json.mimetype }}"}},"id":"38b1f98a-c1b4-4134-96d9-deb874350654","name":"Converter Áudio","type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1100,686]},{"parameters":{"assignments":{"assignments":[{"id":"6b7bef37-abbe-4207-aae0-5447388019a3","name":"baseUrl","value":"( url evo )","type":"string"},{"id":"67c50f2f-89e2-4a5c-84c2-c2ac76962f6e","name":"apikey","value":"( api key )","type":"string"},{"id":"9177d222-437a-4284-a96f-115fba66662c","name":"instancia","value":"( instancia )","type":"string"},{"id":"ab90e3ce-3657-4124-968d-37c0aaebd5ab","name":"xi-api-key","value":"( Api Elevenn  Voz)","type":"string"},{"id":"8d6c586e-0f00-4100-bc40-231cda7f93b7","name":"WhatsApp","value":"={{ $json.body.data.key.remoteJid }}","type":"string"}]},"includeOtherFields":true,"options":{}},"id":"dca2552e-07a5-4f61-a57f-6fa8aa0b398c","name":"Credenciais","type":"n8n-nodes-base.set","typeVersion":3.3,"position":[-1800,1026]},{"parameters":{"assignments":{"assignments":[{"id":"17694db0-6248-444f-afb9-ff7ed13996ef","name":"pergunta","value":"={{ $('Webhook').item.json.body.data.message.extendedTextMessage.text }}","type":"string"}]},"options":{}},"id":"57873324-46d2-4118-937e-a821873d5a01","name":"Texto Web","type":"n8n-nodes-base.set","typeVersion":3.3,"position":[-1260,846],"notesInFlow":false,"alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"2f8e1fbf-9134-4b48-be29-066509e021f5","name":"telefone","value":"={{ $('Webhook').item.json.body.data.key.remoteJid }}","type":"string"},{"id":"a6004904-d9e1-4627-be79-d2a5b073d44f","name":"mensagem","value":"={{ $json.body.data.message.conversation }}","type":"string"}]},"options":{}},"id":"c9c76f5a-4d13-4a58-96f4-bf479f2e5e89","name":"Filta Msg App","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1260,1006]},{"parameters":{"method":"POST","url":"={{ $('Credenciais').item.json.baseUrl }}/chat/getBase64FromMediaMessage/{{ $('Credenciais').item.json.instancia }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Credenciais').item.json.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $json.body.data.key.id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"id":"4a643f82-1e81-4674-b23a-193a862bcd09","name":"Envio de Imagens","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1260,1146],"retryOnFail":true,"maxTries":2},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"image","mimeType":""}},"id":"a4190aa1-3a58-4c34-bf5e-4db28ab22d44","name":"Converter Imagem","type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1120,1146]},{"parameters":{"operation":"push","list":"={{ $json.telefone }}","messageData":"={{ $json.Audio || $json.WhatsWeb || $json.WhatsAppApp || $json.Imagem || $json.mensagem}}","tail":true},"id":"24f69862-933a-4ac7-a3d1-930820496453","name":"Lista Mensagens1","type":"n8n-nodes-base.redis","typeVersion":1,"position":[-700,1166],"credentials":{"redis":{"id":"UHcdFvnvoozYhCLm","name":"Redis account"}}},{"parameters":{"operation":"pdf","options":{}},"id":"a55c7367-64e5-44a9-8b93-443c0fb5cf9a","name":"Extrair Dados","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-940,1306]},{"parameters":{"method":"POST","url":"={{ $('Credenciais').item.json.baseUrl }}/chat/getBase64FromMediaMessage/{{ $('Credenciais').item.json.instancia }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Credenciais').item.json.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"message\": {\n        \"key\": {\n            \"id\":  \"{{ $json.body.data.key.id }}\"\n        }\n    },\n    \"convertToMp4\": true\n} ","options":{}},"id":"c2a7d92e-35a3-44d1-a276-989ceba61fde","name":"Envio de Documentos1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1260,1306],"retryOnFail":true,"maxTries":2},{"parameters":{"operation":"toBinary","sourceProperty":"base64","options":{"fileName":"=image {{ $('Switch').item.json.body.data.message.documentMessage.fileName }}","mimeType":"={{ $('Switch').item.json.body.data.message.documentMessage.mimetype }}"}},"id":"e0b908cd-b66e-477e-bfe5-04d858c556b5","name":"Converter Arquivo1","type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1100,1306]},{"parameters":{"content":"Filtra as Mensagens","height":830.5893065371872,"width":1231.9510817704675,"color":5},"id":"4a66251e-09c8-4c14-9a81-cea4b827a3ef","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1984.3257416971373,666]},{"parameters":{"content":"Concatenação de Mensagens","height":830.15644164636,"width":952.7060569889857,"color":6},"id":"ae6bd5bc-6ffb-4274-b5da-1978799bb0cd","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-760,666]},{"parameters":{"content":"IA","height":828.8267661669029,"width":1031.7647951328638,"color":4},"id":"e1d9a802-d290-4cbb-a86f-f32f8df84697","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[189.3625961643438,666]},{"parameters":{"content":"Database Informações","height":517.6827039739503,"width":864.1985100368698,"color":3},"id":"e06e24db-c419-4207-8f3e-16af415b1254","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1600,1546]},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $json.telefone }}"},"id":"2d1b592b-43cc-4dd0-9778-66c90820ff41","name":"Redis Chat Memory","type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.3,"position":[340,1126],"credentials":{"redis":{"id":"UHcdFvnvoozYhCLm","name":"Redis account"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"101c3ff7-e997-43bb-8e99-fe82746c5993","leftValue":"={{ $json.body.data.message.audioMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"audioMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"4b94d2ac-53e5-4153-9377-4cc6db20cb1c","leftValue":"={{ $json.body.data.message.extendedTextMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"extendedTextMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"38226af4-80fe-4155-9ceb-2379f44e29ed","leftValue":"={{ $json.body.data.message.conversation }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"conversation"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"300366d9-2416-4cf4-93c3-e48c8761c60f","leftValue":"={{ $json.body.data.message.imageMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"imageMessage"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"f33566fd-3eb9-45f4-934a-3a39e2adca6c","leftValue":"={{ $json.body.data.message.documentWithCaptionMessage.message.documentMessage }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"documentMessage"}]},"options":{"fallbackOutput":"none"}},"id":"5da91896-e929-4d2c-8c11-42991f3016eb","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-1620,1006]},{"parameters":{"method":"POST","url":"https://api.elevenlabs.io/v1/text-to-speech/onwK4e9ZLuTAKqWW03F9","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"audio/mpeg"},{"name":"Content-Type","value":"application/json"},{"name":"xi-api-key","value":"={{ $('Credenciais').item.json['xi-api-key'] }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"text\": \"{{ $json.output.replace(/\\n/g, '\\\\n').replace(/\\\"/g, '\\\\\\\\\"').replace(/\\*/g, '').replace(/\\s+/g, ' ').trim() }}\",\n    \"model_id\": \"eleven_multilingual_v2\",\n    \"voice_settings\": {\n        \"stability\": 0.5,\n        \"similarity_boost\": 0.5\n    }\n}","options":{}},"id":"30b94273-4a20-4920-864a-5122c41b0c5b","name":"ElevenLabs","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[700,846]},{"parameters":{"operation":"binaryToPropery","options":{}},"id":"14dde1f4-f832-43d1-8cba-21a202a773aa","name":"Extract from File","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[880,846]},{"parameters":{"method":"POST","url":"={{ $('Credenciais').item.json.baseUrl }}/message/sendWhatsAppAudio/{{ $('Credenciais').item.json.instancia }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Credenciais').item.json.apikey }}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n\t\"number\": \"{{ $('Webhook').item.json.body.data.key.remoteJid }}\",\n\t\"options\": {\n\t\t\"delay\": 1200,\n\t\t\"presence\": \"recording\",\n        \"encoding\": true\n\t},\n\t\"audioMessage\": {\n\t\t\"audio\": \"{{ $json.data }}\"\n\t}\n}","options":{}},"id":"d4d0aca7-395f-427d-8214-aa846c28e4aa","name":"sendWhatsAppAudio","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1060,846]},{"parameters":{"content":"## Responde em Áudio\n","height":239.1747914011388,"width":543.7432906480047,"color":3},"id":"b4b566f8-cdc7-466e-b598-ab8c96313b82","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[660,766]},{"parameters":{"content":"## Responde em Texto\n","height":239.1747914011388,"width":249.0313820540327},"id":"063aecaf-444a-4155-b502-0e7ce17415a6","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[880,1106]},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"d51b1758-02ef-483b-bd0b-784785aa608a","name":"OpenAI","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.3,"position":[-940,686]},{"parameters":{"toolDescription":"use essa ferramenta para enviar imagem de como passar fio dental","method":"POST","url":"(baseurl)/message/sendMedia/(instancia)","sendHeaders":true,"parametersHeaders":{"values":[{"name":"apikey","valueProvider":"fieldValue","value":"(apikey)"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"number\": \"{{ $json.telefone }}\",\n    \"mediatype\": \"image\",\n    \"mimetype\": \"image/jpeg\",\n    \"media\": \"https://i.postimg.cc/bYxh0sr4/e385fd5d-f94f-4a87-af28-69452ddd0750.jpg\",\n    \"fileName\": \"Imagem.jpg\"\n}"},"id":"2a080666-6542-457c-82b5-0e63a4c06e83","name":"HTTP Request","type":"@n8n/n8n-nodes-langchain.toolHttpRequest","typeVersion":1.1,"position":[540,526]},{"parameters":{"content":"Exemplo de Tool de envio de imagem\n","height":205.69487706103345},"id":"48f7c248-9b27-4bca-9dc7-5a326d9d0c45","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[460,460]},{"parameters":{"content":"## Agendamentos\n","height":183.7289063119872,"width":422.6074912357905,"color":3},"id":"0e244bba-7bf2-4afc-87f6-eae456d30cb0","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[280,1506]},{"parameters":{"mode":"delete"},"id":"2d008397-8046-4256-b951-93522b23f374","name":"Chat Memory Manager","type":"@n8n/n8n-nodes-langchain.memoryManager","typeVersion":1.1,"position":[-460,1626],"disabled":true},{"parameters":{"content":"Limpa Memória","height":304.83247531487484,"width":415.33068089188083,"color":7},"id":"8c10e299-e534-4766-99a4-39748574044c","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-520,1526]},{"parameters":{"operation":"delete","calendar":{"__rl":true,"value":"956a8d60d36c50009693bb721a1e6172ac4638ac706c3192d615a2570d2f1076@group.calendar.google.com","mode":"list","cachedResultName":"Aula Mago"},"eventId":"={{ $fromAI(\"Event_ID\",\"Id do evento que deve ser excluído\") }}","options":{}},"id":"da0eb522-9d43-4573-bec0-2a35b68228d3","name":"Deletar Evento1","type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.1,"position":[320,1566]},{"parameters":{"operation":"getAll","calendar":{"__rl":true,"value":"956a8d60d36c50009693bb721a1e6172ac4638ac706c3192d615a2570d2f1076@group.calendar.google.com","mode":"list","cachedResultName":"Aula Mago"},"returnAll":true,"options":{"timeMin":"={{ $fromAI(\"Initital_DateTime\", \"Data e hora inicial da consulta Ex.: 2024-10-17 00:00:00\") }}","timeMax":"={{ $fromAI(\"Final_DateTime\", \"Data e hora final da consulta Ex.: 2024-10-17 00:00:00\") }}","timeZone":{"__rl":true,"value":"America/Sao_Paulo","mode":"list","cachedResultName":"America/Sao_Paulo"}}},"id":"4d151f9f-d382-4d9e-a6b0-777c0070c62a","name":"Buscar Eventos1","type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.1,"position":[460,1566]},{"parameters":{"calendar":{"__rl":true,"value":"956a8d60d36c50009693bb721a1e6172ac4638ac706c3192d615a2570d2f1076@group.calendar.google.com","mode":"list","cachedResultName":"Aula Mago"},"start":"={{ $fromAI(\"Start_Time\",\"Horário inicial do evento ex.:2024-10-08 00:00:00\") }}","end":"={{ $fromAI(\"End_Time\",\"Horário final do evento ex.:2024-10-08 00:01:00\") }}","additionalFields":{}},"id":"490d2e3e-930a-47f9-80f0-c5ff15a4bbcd","name":"Criar Eventos1","type":"n8n-nodes-base.googleCalendarTool","typeVersion":1.1,"position":[600,1566]},{"parameters":{"pineconeIndex":{"__rl":true,"value":"dentista","mode":"list","cachedResultName":"dentista"},"options":{}},"id":"6e77a186-c8b7-4eeb-bafb-73c0f3a79b0f","name":"Pinecone Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1,"position":[460,1266]},{"parameters":{"promptType":"define","text":"={{ $('Edit Fields').item.json.mensagem }}","options":{"systemMessage":"=Assistente Virtual para Clínica Odontológica - São Paulo\n\nDescrição Geral\nEste assistente virtual é projetado para gerenciar de forma eficiente e amigável os agendamentos e cancelamentos de consultas na clínica odontológica \"Sorriso Paulistano\", localizada em São Paulo. Focado em oferecer uma experiência prática e personalizada, o assistente exibe horários disponíveis, solicita o motivo da consulta antes de confirmar o agendamento e fornece todos os detalhes essenciais após a marcação. O assistente também respeita o formato brasileiro de data e hora (DD/MM/AAAA e HH) e opera no fuso horário \"America/Sao_Paulo\".\n\nInformações da Clínica\nNome: Clínica Odontológica Sorriso Paulistano\nEndereço: Avenida Paulista, 1234 - Bela Vista, São Paulo - SP, CEP 01310-100\nHorário de Funcionamento:\nSegunda a sexta-feira: das 08:00 às 18:00\nSábado: das 08:00 às 12:00\nProcedimentos Disponíveis e Valores:\nLimpeza: R$ 150\nConsulta Inicial: R$ 200\nClareamento Dental: R$ 500\nAparelho Ortodôntico: R$ 350 (consulta inicial)\nExtração de Dente: R$ 250 por dente\nOutros procedimentos: valor mediante consulta\n\nFunções do Assistente\n1. Exibir Horários Disponíveis\nObjetivo: Mostrar os horários de consulta disponíveis ao cliente, considerando um intervalo de datas informado, o fuso horário \"America/Sao_Paulo\" e o horário de funcionamento da clínica.\n\nCritérios de Exibição:\n\nExibir apenas horários futuros, a partir do momento atual.\nUtilizar o formato de data (DD/MM/AAAA) e horário (HH).\nNão solicitar o e-mail do cliente nesta etapa.\nExemplo de Resposta:\n\n📅 Data Atual: {{ $now.format('DD/MM/YYYY') }}\n\nHorários disponíveis para hoje:\n- ⏰ 08:00\n- ⏰ 09:00\n- ⏰ 10:00\n- ⏰ 11:00\n- (continuar listagem conforme disponibilidade...)\n\nPor favor, informe o horário desejado e o motivo da consulta (ex: Limpeza, Consulta Inicial, Clareamento, etc.) para prosseguir com o agendamento! 😊\n\n2. Solicitar Motivo da Consulta\nAntes de realizar o agendamento, o assistente deve:\n\nPerguntar ao cliente o motivo da consulta. Exemplos incluem: Limpeza, Consulta Inicial, Clareamento Dental, Aparelho Ortodôntico, Extração de Dente, entre outros.\nCondição: Somente após o cliente informar o motivo, o assistente poderá prosseguir para a etapa de confirmação do agendamento.\n\n3. Confirmar Agendamento\nObjetivo: Confirmar o agendamento após o cliente escolher um horário e informar o motivo da consulta.\n\nInstruções:\n\nSe o horário selecionado for para o mesmo dia, confirmar o agendamento para \"hoje\".\nCaso seja uma data futura, incluir a data e o horário do agendamento na confirmação.\nIncluir o nome do cliente e o motivo do agendamento no título do evento do Google Calendar, por exemplo: \"Consulta - João Silva - Limpeza\".\nSolicitar o e-mail do cliente para envio do link do evento e confirmação após a seleção do horário e motivo da consulta.\nDados Necessários: Nome, e-mail, data e horário do agendamento, motivo da consulta.\n\nExemplo de Resposta para Agendamento no Mesmo Dia:\n\n✅ Agendamento confirmado para hoje às [horário escolhido]! 😊\nExemplo para Data Futura:\n\n✅ Agendamento confirmado para [data escolhida] às [horário escolhido]! 😊\n\nDetalhes do seu agendamento:\n- *Endereço da Clínica:* Avenida Paulista, 1234 - Bela Vista, São Paulo - SP\n- *Data:* [data escolhida]\n- *Horário:* [horário escolhido]\n- *Motivo da Consulta:* [motivo informado pelo cliente]\n- *Link do Evento:* [incluir o link do Google Calendar]\n\nLembre-se de trazer documentos pessoais e qualquer exame recente, se aplicável. Qualquer dúvida, estamos à disposição! 😊\n4. Cancelar Agendamento\nObjetivo: Cancelar um agendamento mediante o fornecimento do ID do evento.\n\nInstruções:\n\nSolicitar o e-mail para cancelamentos, questões de confirmação de segurança.\nConfirmar o cancelamento e informar o cliente com uma mensagem clara.\nDados Necessários: e-mail de confirmação.\n\nExemplo de Resposta de Cancelamento Bem-Sucedido:\n\n✅ Agendamento cancelado com sucesso em {{ $now.format('DD/MM/YYYY') }}! 😊\n\nCaso deseje reagendar ou tenha alguma dúvida, estamos à disposição!\n\nExemplo de Erro ao Cancelar:\n\n⚠️ Erro ao cancelar. Verifique o ID e tente novamente.\n"}},"id":"cd34ed3b-03f0-4556-b895-c3e67fd0d36b","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[360,846]},{"parameters":{"mode":"insert","pineconeIndex":{"__rl":true,"value":"dentista","mode":"list","cachedResultName":"dentista"},"options":{"clearNamespace":true}},"id":"c693f8a5-c303-471a-9f94-f862fa9986bb","name":"Insert into Pinecone vector store","type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","position":[-1120,1586],"typeVersion":1},{"parameters":{"httpMethod":"POST","path":"77a63c5a-4c17-497e-b867-1e14b0737ea7","options":{}},"id":"3bcdffe1-fddb-43f0-ac4e-fcd62d38fc53","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1960,1026],"webhookId":"77a63c5a-4c17-497e-b867-1e14b0737ea7"},{"parameters":{"resource":"image","operation":"analyze","text":"Analise essa imagem, oque tem nela?","inputType":"base64","options":{}},"id":"a3e3b17e-6680-4993-adb8-f20ae2e83255","name":"OpenAI1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.3,"position":[-980,1140],"credentials":{"openAiApi":{"id":"kx1vvIOZPPxBWitD","name":"openia Jamil"}}}],"connections":{"Filtra Webhook":{"main":[[{"node":"Lista Mensagens1","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Puxar as Mensagens","type":"main","index":0}]]},"Puxar as Mensagens":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Redis":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Calculator":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Google Drive":{"main":[[{"node":"Insert into Pinecone vector store","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Insert into Pinecone vector store","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Insert into Pinecone vector store","type":"ai_embedding","index":0}]]},"Vector Store Tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Vector Store Tool","type":"ai_languageModel","index":0}]]},"Mensagem de Audio":{"main":[[{"node":"Converter Áudio","type":"main","index":0}]]},"Converter Áudio":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"Credenciais":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Texto Web":{"main":[[{"node":"Filtra Webhook","type":"main","index":0}]]},"Filta Msg App":{"main":[[{"node":"Filtra Webhook","type":"main","index":0}]]},"Envio de Imagens":{"main":[[{"node":"Converter Imagem","type":"main","index":0}]]},"Converter Imagem":{"main":[[{"node":"OpenAI1","type":"main","index":0}]]},"Lista Mensagens1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Extrair Dados":{"main":[[{"node":"Filtra Webhook","type":"main","index":0}]]},"Envio de Documentos1":{"main":[[{"node":"Converter Arquivo1","type":"main","index":0}]]},"Converter Arquivo1":{"main":[[{"node":"Extrair Dados","type":"main","index":0}]]},"Redis Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Switch":{"main":[[{"node":"Mensagem de Audio","type":"main","index":0}],[{"node":"Texto Web","type":"main","index":0}],[{"node":"Filta Msg App","type":"main","index":0}],[{"node":"Envio de Imagens","type":"main","index":0}],[{"node":"Envio de Documentos1","type":"main","index":0}]]},"ElevenLabs":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"sendWhatsAppAudio","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"Filtra Webhook","type":"main","index":0}]]},"Criar Eventos1":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Buscar Eventos1":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Deletar Evento1":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Pinecone Vector Store":{"ai_vectorStore":[[{"node":"Vector Store Tool","type":"ai_vectorStore","index":0}]]},"AI Agent":{"main":[[{"node":"Enviar Mensagem WhatsApp Lead6","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Credenciais","type":"main","index":0}]]},"OpenAI1":{"main":[[{"node":"Filtra Webhook","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"09a88358-0586-4818-9edf-f627d546b500","triggerCount":0,"tags":[]}